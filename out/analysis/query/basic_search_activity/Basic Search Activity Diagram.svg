<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="3625px" preserveAspectRatio="none" style="width:4577px;height:3625px;" version="1.1" viewBox="0 0 4577 3625" width="4577px" zoomAndPan="magnify"><defs><filter height="300%" id="f12nhd3b8ttdtd" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="561" x="2007.25" y="27.4023">GraphRAG Basic Search - Detailed Activity Flow (Traditional RAG)</text><rect fill="#FAEBD7" height="3574.7422" style="stroke:#FAEBD7;stroke-width:1.0;" width="505" x="15" y="33.4961"/><ellipse cx="265.5" cy="69.6953" fill="#000000" filter="url(#f12nhd3b8ttdtd)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="48.1016" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="489" x="21" y="99.6953"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="118" x="31" y="121.2969">User executes query</text><text fill="#000000" font-family="monospace" font-size="12" lengthAdjust="spacing" textLength="469" x="31" y="134.9668">graphrag query 'What does the document say about X?' --method basic</text><path d="M354.5,157.7969 L354.5,197.0732 L334.5,201.0732 L354.5,205.0732 L354.5,244.3496 A0,0 0 0 0 354.5,244.3496 L478.5,244.3496 A0,0 0 0 0 478.5,244.3496 L478.5,167.7969 L468.5,157.7969 L354.5,157.7969 A0,0 0 0 0 354.5,157.7969 " fill="#FBFB77" filter="url(#f12nhd3b8ttdtd)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M468.5,157.7969 L468.5,167.7969 L478.5,167.7969 L468.5,157.7969 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="360.5" y="175.3652">- query string</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="360.5" y="190.6758">- root directory</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="360.5" y="205.9863">- data directory</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="360.5" y="221.2969">- response_type</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="360.5" y="236.6074">- streaming flag</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="138" x="196.5" y="184.0068"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="118" x="206.5" y="205.6084">Parse CLI arguments</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="48.2656" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="126" x="202.5" y="264.3496"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="106" x="212.5" y="285.9512">Load configuration</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="83" x="212.5" y="300.084">(settings.yaml)</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="151" x="190" y="3307.4199"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="131" x="200" y="3329.0215">Display answer to user</text><polygon fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" points="229.5,3361.5527,301.5,3361.5527,313.5,3373.5527,301.5,3385.5527,229.5,3385.5527,217.5,3373.5527,229.5,3361.5527" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="72" x="229.5" y="3377.71">Verbose flag?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="199.5" y="3371.2324">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="313.5" y="3371.2324">no</text><path d="M165,3395.5527 L165,3434.8291 L145,3438.8291 L165,3442.8291 L165,3482.1055 A0,0 0 0 0 165,3482.1055 L375,3482.1055 A0,0 0 0 0 375,3482.1055 L375,3405.5527 L365,3395.5527 L165,3395.5527 A0,0 0 0 0 165,3395.5527 " fill="#FBFB77" filter="url(#f12nhd3b8ttdtd)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M365,3395.5527 L365,3405.5527 L375,3405.5527 L365,3395.5527 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="171" y="3413.1211">- LLM calls: 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="171" y="3428.4316">- Prompt tokens: X</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="171" y="3443.7422">- Output tokens: Y</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="171" y="3459.0527">- Total tokens: X + Y</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189" x="171" y="3474.3633">- Completion time: Z seconds</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="115" x="30" y="3421.7627"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="95" x="40" y="3443.3643">Display statistics</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="97" x="395" y="3395.5527"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="77" x="405" y="3417.1543">Skip statistics</text><polygon fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" points="265.5,3488.1055,277.5,3500.1055,265.5,3512.1055,253.5,3500.1055,265.5,3488.1055" style="stroke:#A80036;stroke-width:1.5;"/><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="116" x="207.5" y="3532.1055"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="96" x="217.5" y="3553.707">Exit with success</text><ellipse cx="265.5" cy="3597.2383" fill="#FFFFFF" filter="url(#f12nhd3b8ttdtd)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="265.5" cy="3597.2383" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:2.0;" x1="15" x2="15" y1="33.4961" y2="3608.2383"/><rect fill="#ADD8E6" height="3574.7422" style="stroke:#ADD8E6;stroke-width:1.0;" width="473" x="520" y="33.4961"/><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="204" x="526.5" y="332.6152"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="184" x="536.5" y="354.2168">Read Parquet files from output/</text><path d="M727,376.748 L727,408.3691 L707,412.3691 L727,416.3691 L727,447.9902 A0,0 0 0 0 727,447.9902 L935,447.9902 A0,0 0 0 0 935,447.9902 L935,386.748 L925,376.748 L727,376.748 A0,0 0 0 0 727,376.748 " fill="#FBFB77" filter="url(#f12nhd3b8ttdtd)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M925,376.748 L925,386.748 L935,386.748 L925,376.748 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="733" y="394.3164">Minimal data requirements:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="733" y="409.627">- Only text units needed</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187" x="733" y="424.9375">- No graph structure required</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="733" y="440.248">- Simplest search method</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="157" x="550" y="395.3027"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="137" x="560" y="416.9043">Load text_units.parquet</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="196" x="530.5" y="467.9902"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="176" x="540.5" y="489.5918">Load embedding vector stores</text><path d="M751,512.123 L751,536.0889 L731,540.0889 L751,544.0889 L751,568.0547 A0,0 0 0 0 751,568.0547 L988,568.0547 A0,0 0 0 0 988,568.0547 L988,522.123 L978,512.123 L751,512.123 A0,0 0 0 0 751,512.123 " fill="#FBFB77" filter="url(#f12nhd3b8ttdtd)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M978,512.123 L978,522.123 L988,522.123 L978,512.123 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="757" y="529.6914">Vector store contains:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="216" x="757" y="545.002">- Embeddings of text unit content</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="757" y="560.3125">- Used for similarity search</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="205" x="526" y="523.0225"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="185" x="536" y="544.624">Load text_unit_text embeddings</text><line style="stroke:#000000;stroke-width:2.0;" x1="520" x2="520" y1="33.4961" y2="3608.2383"/><rect fill="#90EE90" height="3574.7422" style="stroke:#90EE90;stroke-width:1.0;" width="523" x="993" y="33.4961"/><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="234" x="1001" y="588.0547"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="214" x="1011" y="609.6563">Create BasicSearch engine via factory</text><rect fill="#FFFFFF" filter="url(#f12nhd3b8ttdtd)" height="376.3262" style="stroke:#000000;stroke-width:2.0;" width="507" x="999" y="632.1875"/><path d="M1102,632.1875 L1102,641.6758 L1092,651.6758 L999,651.6758 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93" x="1002" y="646.7227">Factory Setup</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="48.2656" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="165" x="1035.5" y="668.6758"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="145" x="1045.5" y="690.2773">Create completion model</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="50" x="1045.5" y="704.4102">(LiteLLM)</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="48.2656" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="168" x="1034" y="736.9414"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="148" x="1044" y="758.543">Create embedding model</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="131" x="1044" y="772.6758">(for query embedding)</text><path d="M1223.5,801.9629 L1223.5,818.2734 L1203.5,822.2734 L1223.5,826.2734 L1223.5,842.584 A0,0 0 0 0 1223.5,842.584 L1450.5,842.584 A0,0 0 0 0 1450.5,842.584 L1450.5,811.9629 L1440.5,801.9629 L1223.5,801.9629 A0,0 0 0 0 1223.5,801.9629 " fill="#FBFB77" filter="url(#f12nhd3b8ttdtd)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1440.5,801.9629 L1440.5,811.9629 L1450.5,811.9629 L1440.5,801.9629 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="1229.5" y="819.5313">BASIC_SEARCH_SYSTEM_PROMPT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="1229.5" y="834.8418">Simple RAG instructions</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="171" x="1032.5" y="805.207"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="151" x="1042.5" y="826.8086">Load basic search prompt</text><path d="M1247,852.584 L1247,891.8604 L1227,895.8604 L1247,899.8604 L1247,939.1367 A0,0 0 0 0 1247,939.1367 L1496,939.1367 A0,0 0 0 0 1496,939.1367 L1496,862.584 L1486,852.584 L1247,852.584 A0,0 0 0 0 1247,852.584 " fill="#FBFB77" filter="url(#f12nhd3b8ttdtd)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1486,852.584 L1486,862.584 L1496,862.584 L1486,852.584 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="1253" y="870.1523">Configured with:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="1253" y="885.4629">- text_units DataFrame</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228" x="1253" y="900.7734">- text_unit_embeddings vectorstore</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="1253" y="916.084">- text_embedder model</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="1253" y="931.3945">- token encoder</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="218" x="1009" y="878.7939"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="198" x="1019" y="900.3955">Create BasicSearchContext builder</text><path d="M1217.5,955.8926 L1217.5,972.2031 L1197.5,976.2031 L1217.5,980.2031 L1217.5,996.5137 A0,0 0 0 0 1217.5,996.5137 L1478.5,996.5137 A0,0 0 0 0 1478.5,996.5137 L1478.5,965.8926 L1468.5,955.8926 L1217.5,955.8926 A0,0 0 0 0 1217.5,955.8926 " fill="#FBFB77" filter="url(#f12nhd3b8ttdtd)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1468.5,955.8926 L1468.5,965.8926 L1478.5,965.8926 L1468.5,955.8926 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240" x="1223.5" y="973.4609">- k: Number of text units (default: 10)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="1223.5" y="988.7715">- max_context_tokens: 4000</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="159" x="1038.5" y="959.1367"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="139" x="1048.5" y="980.7383">Set retrieval parameters</text><line style="stroke:#000000;stroke-width:2.0;" x1="993" x2="993" y1="33.4961" y2="3608.2383"/><rect fill="#FFFFE0" height="3574.7422" style="stroke:#FFFFE0;stroke-width:1.0;" width="216" x="1516" y="33.4961"/><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="200" x="1522" y="1028.5137"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="180" x="1532" y="1050.1152">Start BasicSearch.search(query)</text><line style="stroke:#000000;stroke-width:2.0;" x1="1516" x2="1516" y1="33.4961" y2="3608.2383"/><rect fill="#F08080" height="3574.7422" style="stroke:#F08080;stroke-width:1.0;" width="716.5" x="1732" y="33.4961"/><rect fill="#FFFFFF" filter="url(#f12nhd3b8ttdtd)" height="410.748" style="stroke:#000000;stroke-width:2.0;" width="700.5" x="1738" y="1072.6465"/><path d="M1874,1072.6465 L1874,1082.1348 L1864,1092.1348 L1738,1092.1348 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126" x="1741" y="1087.1816">Text Unit Retrieval</text><path d="M2066.5,1113.5459 L2066.5,1122.2012 L2046.5,1126.2012 L2066.5,1130.2012 L2066.5,1138.8564 A0,0 0 0 0 2066.5,1138.8564 L2428.5,1138.8564 A0,0 0 0 0 2428.5,1138.8564 L2428.5,1123.5459 L2418.5,1113.5459 L2066.5,1113.5459 A0,0 0 0 0 2066.5,1113.5459 " fill="#FBFB77" filter="url(#f12nhd3b8ttdtd)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2418.5,1113.5459 L2418.5,1123.5459 L2428.5,1123.5459 L2418.5,1113.5459 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="341" x="2072.5" y="1131.1143">query_embedding = text_embedder.embedding(query)</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="268" x="1778.5" y="1109.1348"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="248" x="1788.5" y="1130.7363">Embed query using text embedding model</text><path d="M2097,1153.2676 L2097,1184.8887 L2077,1188.8887 L2097,1192.8887 L2097,1224.5098 A0,0 0 0 0 2097,1224.5098 L2341,1224.5098 A0,0 0 0 0 2341,1224.5098 L2341,1163.2676 L2331,1153.2676 L2097,1153.2676 A0,0 0 0 0 2097,1153.2676 " fill="#FBFB77" filter="url(#f12nhd3b8ttdtd)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2331,1153.2676 L2331,1163.2676 L2341,1163.2676 L2331,1153.2676 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="2103" y="1170.8359">Search parameters:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="2103" y="1186.1465">- text: query string</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="2103" y="1201.457">- k: number of chunks (default: 10)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="2103" y="1216.7676">- metric: cosine similarity</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="329" x="1748" y="1171.8223"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="309" x="1758" y="1193.4238">Vector similarity search on text_unit_text embeddings</text><path d="M2034,1234.5098 L2034,1266.1309 L2014,1270.1309 L2034,1274.1309 L2034,1305.752 A0,0 0 0 0 2034,1305.752 L2272,1305.752 A0,0 0 0 0 2272,1305.752 L2272,1244.5098 L2262,1234.5098 L2034,1234.5098 A0,0 0 0 0 2034,1234.5098 " fill="#FBFB77" filter="url(#f12nhd3b8ttdtd)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2262,1234.5098 L2262,1244.5098 L2272,1244.5098 L2262,1234.5098 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="2040" y="1252.0781">Returns list of VectorSearchResult:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="2040" y="1267.3887">- document.id: text unit ID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="2040" y="1282.6992">- score: similarity score</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="2040" y="1298.0098">- metadata: additional info</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="203" x="1811" y="1253.0645"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="183" x="1821" y="1274.666">Retrieve top-k similar text units</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="248" x="1788.5" y="1325.752"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="228" x="1798.5" y="1347.3535">Extract text unit IDs from search results</text><path d="M2039.5,1376.6406 L2039.5,1392.9512 L2019.5,1396.9512 L2039.5,1400.9512 L2039.5,1417.2617 A0,0 0 0 0 2039.5,1417.2617 L2277.5,1417.2617 A0,0 0 0 0 2277.5,1417.2617 L2277.5,1386.6406 L2267.5,1376.6406 L2039.5,1376.6406 A0,0 0 0 0 2039.5,1376.6406 " fill="#FBFB77" filter="url(#f12nhd3b8ttdtd)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2267.5,1376.6406 L2267.5,1386.6406 L2277.5,1386.6406 L2267.5,1376.6406 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="2045.5" y="1394.209">Create filtered list:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="2045.5" y="1409.5195">[{id: "unit_1", text: "content..."}, ...]</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="214" x="1805.5" y="1379.8848"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="194" x="1815.5" y="1401.4863">Filter text_units DataFrame by IDs</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="253" x="1786" y="1437.2617"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="233" x="1796" y="1458.8633">Create DataFrame of retrieved text units</text><line style="stroke:#000000;stroke-width:2.0;" x1="1732" x2="1732" y1="33.4961" y2="3608.2383"/><rect fill="#B0C4DE" height="3574.7422" style="stroke:#B0C4DE;stroke-width:1.0;" width="781" x="2448.5" y="33.4961"/><rect fill="#FFFFFF" filter="url(#f12nhd3b8ttdtd)" height="878.1758" style="stroke:#000000;stroke-width:2.0;" width="765" x="2454.5" y="1493.3945"/><path d="M2657.5,1493.3945 L2657.5,1502.8828 L2647.5,1512.8828 L2454.5,1512.8828 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="193" x="2457.5" y="1507.9297">Apply Context Window Limit</text><path d="M2813.5,1522.8828 L2813.5,1546.8486 L2793.5,1550.8486 L2813.5,1554.8486 L2813.5,1578.8145 A0,0 0 0 0 2813.5,1578.8145 L3084.5,1578.8145 A0,0 0 0 0 3084.5,1578.8145 L3084.5,1532.8828 L3074.5,1522.8828 L2813.5,1522.8828 A0,0 0 0 0 2813.5,1522.8828 " fill="#FBFB77" filter="url(#f12nhd3b8ttdtd)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3074.5,1522.8828 L3074.5,1532.8828 L3084.5,1532.8828 L3074.5,1522.8828 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="2819.5" y="1540.4512">- current_tokens = 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="2819.5" y="1555.7617">- text_ids = []</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="250" x="2819.5" y="1571.0723">- max_context_tokens = 4000 (default)</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="163" x="2630.5" y="1533.7822"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="143" x="2640.5" y="1555.3838">Initialize context building</text><path d="M2802,1603.2256 L2802,1611.8809 L2782,1615.8809 L2802,1619.8809 L2802,1628.5361 A0,0 0 0 0 2802,1628.5361 L2988,1628.5361 A0,0 0 0 0 2988,1628.5361 L2988,1613.2256 L2978,1603.2256 L2802,1603.2256 A0,0 0 0 0 2802,1603.2256 " fill="#FBFB77" filter="url(#f12nhd3b8ttdtd)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2978,1603.2256 L2978,1613.2256 L2988,1613.2256 L2978,1603.2256 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="2808" y="1620.7939">Header format: "id|text\n"</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="140" x="2642" y="1598.8145"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="120" x="2652" y="1620.416">Count header tokens</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="240" x="2592" y="1696.9473"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="220" x="2602" y="1718.5488">Select next text unit from retrieved list</text><path d="M2796,1747.8359 L2796,1764.1465 L2776,1768.1465 L2796,1772.1465 L2796,1788.457 A0,0 0 0 0 2796,1788.457 L3023,1788.457 A0,0 0 0 0 3023,1788.457 L3023,1757.8359 L3013,1747.8359 L2796,1747.8359 A0,0 0 0 0 2796,1747.8359 " fill="#FBFB77" filter="url(#f12nhd3b8ttdtd)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3013,1747.8359 L3013,1757.8359 L3023,1757.8359 L3013,1747.8359 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="2802" y="1765.4043">Format: "unit_id|text_content\n"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="2802" y="1780.7148">Separator: | (pipe)</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="128" x="2648" y="1751.0801"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="108" x="2658" y="1772.6816">Format as CSV row</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="195" x="2614.5" y="1808.457"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="175" x="2624.5" y="1830.0586">Count tokens in formatted row</text><polygon fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" points="2566.5,1862.5898,2857.5,1862.5898,2869.5,1874.5898,2857.5,1886.5898,2566.5,1886.5898,2554.5,1874.5898,2566.5,1862.5898" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="291" x="2566.5" y="1878.7471">current_tokens + row_tokens ≤ max_context_tokens?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="2536.5" y="1872.2695">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="2869.5" y="1872.2695">no</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="156" x="2466.5" y="1896.5898"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="136" x="2476.5" y="1918.1914">Add text unit to context</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="144" x="2472.5" y="1950.7227"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="124" x="2482.5" y="1972.3242">Add index to text_ids</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="151" x="2469" y="2011.3438"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="131" x="2479" y="2032.9453">Update current_tokens</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="135" x="2812" y="1896.5898"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="115" x="2822" y="1918.1914">Token limit reached</text><path d="M2972.5,1950.7227 L2972.5,1967.0332 L2952.5,1971.0332 L2972.5,1975.0332 L2972.5,1991.3438 A0,0 0 0 0 2972.5,1991.3438 L3189.5,1991.3438 A0,0 0 0 0 3189.5,1991.3438 L3189.5,1960.7227 L3179.5,1950.7227 L2972.5,1950.7227 A0,0 0 0 0 2972.5,1950.7227 " fill="#FBFB77" filter="url(#f12nhd3b8ttdtd)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3179.5,1950.7227 L3179.5,1960.7227 L3189.5,1960.7227 L3179.5,1950.7227 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196" x="2978.5" y="1968.291">Remaining text units discarded</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="2978.5" y="1983.6016">Ensures we fit in LLM context</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="146" x="2806.5" y="1953.9668"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="126" x="2816.5" y="1975.5684">Stop adding text units</text><polygon fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" points="2712,1652.9473,2724,1664.9473,2712,1676.9473,2700,1664.9473,2712,1652.9473" style="stroke:#A80036;stroke-width:1.5;"/><polygon fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" points="2669,2065.4766,2755,2065.4766,2767,2077.4766,2755,2089.4766,2669,2089.4766,2657,2077.4766,2669,2065.4766" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="86" x="2669" y="2081.6338">More text units?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="2767" y="2075.1563">yes</text><polygon fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" points="2712,2109.4766,2724,2121.4766,2712,2133.4766,2700,2121.4766,2712,2109.4766" style="stroke:#A80036;stroke-width:1.5;"/><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="229" x="2597.5" y="2174.752"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="209" x="2607.5" y="2196.3535">Filter DataFrame by selected indices</text><path d="M2805.5,2218.8848 L2805.5,2258.1611 L2785.5,2262.1611 L2805.5,2266.1611 L2805.5,2305.4375 A0,0 0 0 0 2805.5,2305.4375 L3059.5,2305.4375 A0,0 0 0 0 3059.5,2305.4375 L3059.5,2228.8848 L3049.5,2218.8848 L2805.5,2218.8848 A0,0 0 0 0 2805.5,2218.8848 " fill="#FBFB77" filter="url(#f12nhd3b8ttdtd)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3049.5,2218.8848 L3049.5,2228.8848 L3059.5,2228.8848 L3049.5,2218.8848 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="2811.5" y="2236.4531">CSV format:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="42" x="2811.5" y="2251.7637">id|text</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="2811.5" y="2267.0742">unit_1|This is the content of unit 1...</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="2811.5" y="2282.3848">unit_2|Another text unit content...</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="2811.5" y="2297.6953">...</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="147" x="2638.5" y="2245.0947"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="127" x="2648.5" y="2266.6963">Convert to CSV format</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="158" x="2633" y="2325.4375"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="138" x="2643" y="2347.0391">Store as context_chunks</text><line style="stroke:#000000;stroke-width:2.0;" x1="2448.5" x2="2448.5" y1="33.4961" y2="3608.2383"/><rect fill="#E6E6FA" height="3574.7422" style="stroke:#E6E6FA;stroke-width:1.0;" width="692.5" x="3229.5" y="33.4961"/><rect fill="#FFFFFF" filter="url(#f12nhd3b8ttdtd)" height="621.8125" style="stroke:#000000;stroke-width:2.0;" width="676.5" x="3235.5" y="2381.5703"/><path d="M3351.5,2381.5703 L3351.5,2391.0586 L3341.5,2401.0586 L3235.5,2401.0586 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106" x="3238.5" y="2396.1055">LLM Generation</text><path d="M3608.5,2411.0586 L3608.5,2465.6455 L3588.5,2469.6455 L3608.5,2473.6455 L3608.5,2528.2324 A0,0 0 0 0 3608.5,2528.2324 L3858.5,2528.2324 A0,0 0 0 0 3858.5,2528.2324 L3858.5,2421.0586 L3848.5,2411.0586 L3608.5,2411.0586 A0,0 0 0 0 3608.5,2411.0586 " fill="#FBFB77" filter="url(#f12nhd3b8ttdtd)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3848.5,2411.0586 L3848.5,2421.0586 L3858.5,2421.0586 L3848.5,2411.0586 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="3614.5" y="2428.627">System Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218" x="3614.5" y="2443.9375">- BASIC_SEARCH_SYSTEM_PROMPT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229" x="3614.5" y="2459.248">- Formatted text units context (CSV)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="3614.5" y="2474.5586">- response_type parameter</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="3618.5" y="2489.8691"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="3614.5" y="2505.1797">User Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="3614.5" y="2520.4902">- User query</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="176" x="3412.5" y="2452.5791"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="156" x="3422.5" y="2474.1807">Build completion messages</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="155" x="3423" y="2548.2324"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="135" x="3433" y="2569.834">Call LLM with streaming</text><polygon fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" points="3448.5,2602.3652,3552.5,2602.3652,3564.5,2614.3652,3552.5,2626.3652,3448.5,2626.3652,3436.5,2614.3652,3448.5,2602.3652" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="3448.5" y="2618.5225">Streaming enabled?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="3418.5" y="2612.0449">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="3564.5" y="2612.0449">no</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="138" x="3259" y="2690.498"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="118" x="3269" y="2712.0996">Receive token chunk</text><path d="M3408,2741.3867 L3408,2757.6973 L3388,2761.6973 L3408,2765.6973 L3408,2782.0078 A0,0 0 0 0 3408,2782.0078 L3540,2782.0078 A0,0 0 0 0 3540,2782.0078 L3540,2751.3867 L3530,2741.3867 L3408,2741.3867 A0,0 0 0 0 3408,2741.3867 " fill="#FBFB77" filter="url(#f12nhd3b8ttdtd)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3530,2741.3867 L3530,2751.3867 L3540,2751.3867 L3530,2741.3867 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="3414" y="2758.9551">Real-time display</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68" x="3414" y="2774.2656">in terminal</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="120" x="3268" y="2744.6309"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="100" x="3278" y="2766.2324">Yield token to CLI</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="161" x="3247.5" y="2802.0078"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="141" x="3257.5" y="2823.6094">Append to full_response</text><polygon fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" points="3328,2636.3652,3340,2648.3652,3328,2660.3652,3316,2648.3652,3328,2636.3652" style="stroke:#A80036;stroke-width:1.5;"/><polygon fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" points="3292.5,2856.1406,3363.5,2856.1406,3375.5,2868.1406,3363.5,2880.1406,3292.5,2880.1406,3280.5,2868.1406,3292.5,2856.1406" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="71" x="3292.5" y="2872.2979">More tokens?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="3375.5" y="2865.8203">yes</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="178" x="3584" y="2636.3652"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="158" x="3594" y="2657.9668">Receive complete response</text><polygon fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" points="3500.5,2886.1406,3512.5,2898.1406,3500.5,2910.1406,3488.5,2898.1406,3500.5,2886.1406" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="3474.5" y="2895.8203">no</text><path d="M3601,2920.1406 L3601,2951.7617 L3581,2955.7617 L3601,2959.7617 L3601,2991.3828 A0,0 0 0 0 3601,2991.3828 L3902,2991.3828 A0,0 0 0 0 3902,2991.3828 L3902,2930.1406 L3892,2920.1406 L3601,2920.1406 A0,0 0 0 0 3601,2920.1406 " fill="#FBFB77" filter="url(#f12nhd3b8ttdtd)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3892,2920.1406 L3892,2930.1406 L3902,2930.1406 L3892,2920.1406 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="3607" y="2937.709">- llm_calls: 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="280" x="3607" y="2953.0195">- prompt_tokens: system + context + query</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="3607" y="2968.3301">- output_tokens: response length</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179" x="3607" y="2983.6406">- completion_time: duration</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="161" x="3420" y="2938.6953"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="141" x="3430" y="2960.2969">Track LLM call metadata</text><line style="stroke:#000000;stroke-width:2.0;" x1="3229.5" x2="3229.5" y1="33.4961" y2="3608.2383"/><rect fill="#98FB98" height="3574.7422" style="stroke:#98FB98;stroke-width:1.0;" width="635.5" x="3922" y="33.4961"/><rect fill="#FFFFFF" filter="url(#f12nhd3b8ttdtd)" height="274.0371" style="stroke:#000000;stroke-width:2.0;" width="619.5" x="3928" y="3013.3828"/><path d="M4075,3013.3828 L4075,3022.8711 L4065,3032.8711 L3928,3032.8711 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="137" x="3931" y="3027.918">Create SearchResult</text><path d="M4156.5,3042.8711 L4156.5,3128.0791 L4136.5,3132.0791 L4156.5,3136.0791 L4156.5,3221.2871 A0,0 0 0 0 4156.5,3221.2871 L4537.5,3221.2871 A0,0 0 0 0 4537.5,3221.2871 L4537.5,3052.8711 L4527.5,3042.8711 L4156.5,3042.8711 A0,0 0 0 0 4156.5,3042.8711 " fill="#FBFB77" filter="url(#f12nhd3b8ttdtd)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4527.5,3042.8711 L4527.5,3052.8711 L4537.5,3052.8711 L4527.5,3042.8711 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="4162.5" y="3060.4395">SearchResult contains:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237" x="4162.5" y="3075.75">- response: Generated answer (string)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="234" x="4162.5" y="3091.0605">- context_data: {sources: DataFrame}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244" x="4162.5" y="3106.3711">- context_text: Formatted CSV context</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="4162.5" y="3121.6816">- completion_time: duration (float)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="4162.5" y="3136.9922">- llm_calls: 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196" x="4162.5" y="3152.3027">- prompt_tokens: input tokens</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221" x="4162.5" y="3167.6133">- output_tokens: generated tokens</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="360" x="4162.5" y="3182.9238">- llm_calls_categories: {"build_context": 0, "response": 1}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="326" x="4162.5" y="3198.2344">- prompt_tokens_categories: per-phase breakdown</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="322" x="4162.5" y="3213.5449">- output_tokens_categories: per-phase breakdown</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="193" x="3943.5" y="3115.0127"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="173" x="3953.5" y="3136.6143">Assemble SearchResult object</text><rect fill="#FEFECE" filter="url(#f12nhd3b8ttdtd)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="204" x="3938" y="3241.2871"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="184" x="3948" y="3262.8887">Return SearchResult to API layer</text><line style="stroke:#000000;stroke-width:2.0;" x1="3922" x2="3922" y1="33.4961" y2="3608.2383"/><line style="stroke:#000000;stroke-width:2.0;" x1="4557.5" x2="4557.5" y1="33.4961" y2="3608.2383"/><line style="stroke:#A80036;stroke-width:1.5;" x1="265.5" x2="265.5" y1="79.6953" y2="99.6953"/><polygon fill="#A80036" points="261.5,89.6953,265.5,99.6953,269.5,89.6953,265.5,93.6953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="265.5" x2="265.5" y1="147.7969" y2="184.0068"/><polygon fill="#A80036" points="261.5,174.0068,265.5,184.0068,269.5,174.0068,265.5,178.0068" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="265.5" x2="265.5" y1="218.1396" y2="264.3496"/><polygon fill="#A80036" points="261.5,254.3496,265.5,264.3496,269.5,254.3496,265.5,258.3496" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="217.5" x2="87.5" y1="3373.5527" y2="3373.5527"/><line style="stroke:#A80036;stroke-width:1.5;" x1="87.5" x2="87.5" y1="3373.5527" y2="3421.7627"/><polygon fill="#A80036" points="83.5,3411.7627,87.5,3421.7627,91.5,3411.7627,87.5,3415.7627" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="313.5" x2="443.5" y1="3373.5527" y2="3373.5527"/><line style="stroke:#A80036;stroke-width:1.5;" x1="443.5" x2="443.5" y1="3373.5527" y2="3395.5527"/><polygon fill="#A80036" points="439.5,3385.5527,443.5,3395.5527,447.5,3385.5527,443.5,3389.5527" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="87.5" x2="87.5" y1="3455.8955" y2="3500.1055"/><line style="stroke:#A80036;stroke-width:1.5;" x1="87.5" x2="253.5" y1="3500.1055" y2="3500.1055"/><polygon fill="#A80036" points="243.5,3496.1055,253.5,3500.1055,243.5,3504.1055,247.5,3500.1055" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="443.5" x2="443.5" y1="3429.6855" y2="3500.1055"/><line style="stroke:#A80036;stroke-width:1.5;" x1="443.5" x2="277.5" y1="3500.1055" y2="3500.1055"/><polygon fill="#A80036" points="287.5,3496.1055,277.5,3500.1055,287.5,3504.1055,283.5,3500.1055" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="265.5" x2="265.5" y1="3341.5527" y2="3361.5527"/><polygon fill="#A80036" points="261.5,3351.5527,265.5,3361.5527,269.5,3351.5527,265.5,3355.5527" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="265.5" x2="265.5" y1="3512.1055" y2="3532.1055"/><polygon fill="#A80036" points="261.5,3522.1055,265.5,3532.1055,269.5,3522.1055,265.5,3526.1055" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="265.5" x2="265.5" y1="3566.2383" y2="3586.2383"/><polygon fill="#A80036" points="261.5,3576.2383,265.5,3586.2383,269.5,3576.2383,265.5,3580.2383" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="628.5" x2="628.5" y1="366.748" y2="395.3027"/><polygon fill="#A80036" points="624.5,385.3027,628.5,395.3027,632.5,385.3027,628.5,389.3027" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="628.5" x2="628.5" y1="429.4355" y2="467.9902"/><polygon fill="#A80036" points="624.5,457.9902,628.5,467.9902,632.5,457.9902,628.5,461.9902" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="628.5" x2="628.5" y1="502.123" y2="523.0225"/><polygon fill="#A80036" points="624.5,513.0225,628.5,523.0225,632.5,513.0225,628.5,517.0225" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1118" x2="1118" y1="716.9414" y2="736.9414"/><polygon fill="#A80036" points="1114,726.9414,1118,736.9414,1122,726.9414,1118,730.9414" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1118" x2="1118" y1="785.207" y2="805.207"/><polygon fill="#A80036" points="1114,795.207,1118,805.207,1122,795.207,1118,799.207" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1118" x2="1118" y1="839.3398" y2="878.7939"/><polygon fill="#A80036" points="1114,868.7939,1118,878.7939,1122,868.7939,1118,872.7939" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1118" x2="1118" y1="912.9268" y2="959.1367"/><polygon fill="#A80036" points="1114,949.1367,1118,959.1367,1122,949.1367,1118,953.1367" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1118" x2="1118" y1="622.1875" y2="668.6758"/><polygon fill="#A80036" points="1114,658.6758,1118,668.6758,1122,658.6758,1118,662.6758" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1912.5" x2="1912.5" y1="1143.2676" y2="1171.8223"/><polygon fill="#A80036" points="1908.5,1161.8223,1912.5,1171.8223,1916.5,1161.8223,1912.5,1165.8223" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1912.5" x2="1912.5" y1="1205.9551" y2="1253.0645"/><polygon fill="#A80036" points="1908.5,1243.0645,1912.5,1253.0645,1916.5,1243.0645,1912.5,1247.0645" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1912.5" x2="1912.5" y1="1287.1973" y2="1325.752"/><polygon fill="#A80036" points="1908.5,1315.752,1912.5,1325.752,1916.5,1315.752,1912.5,1319.752" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1912.5" x2="1912.5" y1="1359.8848" y2="1379.8848"/><polygon fill="#A80036" points="1908.5,1369.8848,1912.5,1379.8848,1916.5,1369.8848,1912.5,1373.8848" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1912.5" x2="1912.5" y1="1414.0176" y2="1437.2617"/><polygon fill="#A80036" points="1908.5,1427.2617,1912.5,1437.2617,1916.5,1427.2617,1912.5,1431.2617" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2712" x2="2712" y1="1567.915" y2="1598.8145"/><polygon fill="#A80036" points="2708,1588.8145,2712,1598.8145,2716,1588.8145,2712,1592.8145" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2712" x2="2712" y1="1731.0801" y2="1751.0801"/><polygon fill="#A80036" points="2708,1741.0801,2712,1751.0801,2716,1741.0801,2712,1745.0801" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2712" x2="2712" y1="1785.2129" y2="1808.457"/><polygon fill="#A80036" points="2708,1798.457,2712,1808.457,2716,1798.457,2712,1802.457" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2544.5" x2="2544.5" y1="1930.7227" y2="1950.7227"/><polygon fill="#A80036" points="2540.5,1940.7227,2544.5,1950.7227,2548.5,1940.7227,2544.5,1944.7227" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2544.5" x2="2544.5" y1="1984.8555" y2="2011.3438"/><polygon fill="#A80036" points="2540.5,2001.3438,2544.5,2011.3438,2548.5,2001.3438,2544.5,2005.3438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2879.5" x2="2879.5" y1="1930.7227" y2="1953.9668"/><polygon fill="#A80036" points="2875.5,1943.9668,2879.5,1953.9668,2883.5,1943.9668,2879.5,1947.9668" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2879.5" x2="2879.5" y1="1988.0996" y2="2017.832"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2879.5" x2="2461.5" y1="2017.832" y2="2017.832"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2461.5" x2="2461.5" y1="2017.832" y2="2121.4766"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2461.5" x2="2700" y1="2121.4766" y2="2121.4766"/><polygon fill="#A80036" points="2690,2117.4766,2700,2121.4766,2690,2125.4766,2694,2121.4766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2554.5" x2="2544.5" y1="1874.5898" y2="1874.5898"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2544.5" x2="2544.5" y1="1874.5898" y2="1896.5898"/><polygon fill="#A80036" points="2540.5,1886.5898,2544.5,1896.5898,2548.5,1886.5898,2544.5,1890.5898" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2869.5" x2="2879.5" y1="1874.5898" y2="1874.5898"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2879.5" x2="2879.5" y1="1874.5898" y2="1896.5898"/><polygon fill="#A80036" points="2875.5,1886.5898,2879.5,1896.5898,2883.5,1886.5898,2879.5,1890.5898" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2544.5" x2="2544.5" y1="2045.4766" y2="2050.4766"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2544.5" x2="2712" y1="2050.4766" y2="2050.4766"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2712" x2="2712" y1="2050.4766" y2="2065.4766"/><polygon fill="#A80036" points="2708,2055.4766,2712,2065.4766,2716,2055.4766,2712,2059.4766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2712" x2="2712" y1="1842.5898" y2="1862.5898"/><polygon fill="#A80036" points="2708,1852.5898,2712,1862.5898,2716,1852.5898,2712,1856.5898" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2712" x2="2712" y1="1676.9473" y2="1696.9473"/><polygon fill="#A80036" points="2708,1686.9473,2712,1696.9473,2716,1686.9473,2712,1690.9473" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2767" x2="3203.5" y1="2077.4766" y2="2077.4766"/><polygon fill="#A80036" points="3199.5,1871.8457,3203.5,1861.8457,3207.5,1871.8457,3203.5,1867.8457" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3203.5" x2="3203.5" y1="1664.9473" y2="2077.4766"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3203.5" x2="2724" y1="1664.9473" y2="1664.9473"/><polygon fill="#A80036" points="2734,1660.9473,2724,1664.9473,2734,1668.9473,2730,1664.9473" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2712" x2="2712" y1="2089.4766" y2="2109.4766"/><polygon fill="#A80036" points="2708,2099.4766,2712,2109.4766,2716,2099.4766,2712,2103.4766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2712" x2="2712" y1="1632.9473" y2="1652.9473"/><polygon fill="#A80036" points="2708,1642.9473,2712,1652.9473,2716,1642.9473,2712,1646.9473" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2712" x2="2712" y1="2133.4766" y2="2174.752"/><polygon fill="#A80036" points="2708,2164.752,2712,2174.752,2716,2164.752,2712,2168.752" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="2716" y="2154.9316">no</text><line style="stroke:#A80036;stroke-width:1.5;" x1="2712" x2="2712" y1="2208.8848" y2="2245.0947"/><polygon fill="#A80036" points="2708,2235.0947,2712,2245.0947,2716,2235.0947,2712,2239.0947" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2712" x2="2712" y1="2279.2275" y2="2325.4375"/><polygon fill="#A80036" points="2708,2315.4375,2712,2325.4375,2716,2315.4375,2712,2319.4375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3500.5" x2="3500.5" y1="2486.7119" y2="2548.2324"/><polygon fill="#A80036" points="3496.5,2538.2324,3500.5,2548.2324,3504.5,2538.2324,3500.5,2542.2324" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3328" x2="3328" y1="2724.6309" y2="2744.6309"/><polygon fill="#A80036" points="3324,2734.6309,3328,2744.6309,3332,2734.6309,3328,2738.6309" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3328" x2="3328" y1="2778.7637" y2="2802.0078"/><polygon fill="#A80036" points="3324,2792.0078,3328,2802.0078,3332,2792.0078,3328,2796.0078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3328" x2="3328" y1="2660.3652" y2="2690.498"/><polygon fill="#A80036" points="3324,2680.498,3328,2690.498,3332,2680.498,3328,2684.498" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3375.5" x2="3552" y1="2868.1406" y2="2868.1406"/><polygon fill="#A80036" points="3548,2771.6973,3552,2761.6973,3556,2771.6973,3552,2767.6973" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3552" x2="3552" y1="2648.3652" y2="2868.1406"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3552" x2="3340" y1="2648.3652" y2="2648.3652"/><polygon fill="#A80036" points="3350,2644.3652,3340,2648.3652,3350,2652.3652,3346,2648.3652" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3328" x2="3328" y1="2836.1406" y2="2856.1406"/><polygon fill="#A80036" points="3324,2846.1406,3328,2856.1406,3332,2846.1406,3328,2850.1406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3436.5" x2="3328" y1="2614.3652" y2="2614.3652"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3328" x2="3328" y1="2614.3652" y2="2636.3652"/><polygon fill="#A80036" points="3324,2626.3652,3328,2636.3652,3332,2626.3652,3328,2630.3652" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3564.5" x2="3673" y1="2614.3652" y2="2614.3652"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3673" x2="3673" y1="2614.3652" y2="2636.3652"/><polygon fill="#A80036" points="3669,2626.3652,3673,2636.3652,3677,2626.3652,3673,2630.3652" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3328" x2="3328" y1="2880.1406" y2="2898.1406"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3328" x2="3488.5" y1="2898.1406" y2="2898.1406"/><polygon fill="#A80036" points="3478.5,2894.1406,3488.5,2898.1406,3478.5,2902.1406,3482.5,2898.1406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3673" x2="3673" y1="2670.498" y2="2898.1406"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3673" x2="3512.5" y1="2898.1406" y2="2898.1406"/><polygon fill="#A80036" points="3522.5,2894.1406,3512.5,2898.1406,3522.5,2902.1406,3518.5,2898.1406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3500.5" x2="3500.5" y1="2582.3652" y2="2602.3652"/><polygon fill="#A80036" points="3496.5,2592.3652,3500.5,2602.3652,3504.5,2592.3652,3500.5,2596.3652" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3500.5" x2="3500.5" y1="2910.1406" y2="2938.6953"/><polygon fill="#A80036" points="3496.5,2928.6953,3500.5,2938.6953,3504.5,2928.6953,3500.5,2932.6953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4040" x2="4040" y1="3149.1455" y2="3241.2871"/><polygon fill="#A80036" points="4036,3231.2871,4040,3241.2871,4044,3231.2871,4040,3235.2871" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="265.5" x2="265.5" y1="312.6152" y2="317.6152"/><line style="stroke:#A80036;stroke-width:1.5;" x1="265.5" x2="628.5" y1="317.6152" y2="317.6152"/><line style="stroke:#A80036;stroke-width:1.5;" x1="628.5" x2="628.5" y1="317.6152" y2="332.6152"/><polygon fill="#A80036" points="624.5,322.6152,628.5,332.6152,632.5,322.6152,628.5,326.6152" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="628.5" x2="628.5" y1="557.1553" y2="573.0547"/><line style="stroke:#A80036;stroke-width:1.5;" x1="628.5" x2="1118" y1="573.0547" y2="573.0547"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1118" x2="1118" y1="573.0547" y2="588.0547"/><polygon fill="#A80036" points="1114,578.0547,1118,588.0547,1122,578.0547,1118,582.0547" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1118" x2="1118" y1="993.2695" y2="1013.5137"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1118" x2="1622" y1="1013.5137" y2="1013.5137"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1622" x2="1622" y1="1013.5137" y2="1028.5137"/><polygon fill="#A80036" points="1618,1018.5137,1622,1028.5137,1626,1018.5137,1622,1022.5137" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1622" x2="1622" y1="1062.6465" y2="1073.3906"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1622" x2="1912.5" y1="1073.3906" y2="1073.3906"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1912.5" x2="1912.5" y1="1073.3906" y2="1109.1348"/><polygon fill="#A80036" points="1908.5,1099.1348,1912.5,1109.1348,1916.5,1099.1348,1912.5,1103.1348" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1912.5" x2="1912.5" y1="1471.3945" y2="1489.5884"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1912.5" x2="2712" y1="1489.5884" y2="1489.5884"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2712" x2="2712" y1="1489.5884" y2="1533.7822"/><polygon fill="#A80036" points="2708,1523.7822,2712,1533.7822,2716,1523.7822,2712,1527.7822" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2712" x2="2712" y1="2359.5703" y2="2393.0747"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2712" x2="3500.5" y1="2393.0747" y2="2393.0747"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3500.5" x2="3500.5" y1="2393.0747" y2="2452.5791"/><polygon fill="#A80036" points="3496.5,2442.5791,3500.5,2452.5791,3504.5,2442.5791,3500.5,2446.5791" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3500.5" x2="3500.5" y1="2972.8281" y2="3030.9204"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3500.5" x2="4040" y1="3030.9204" y2="3030.9204"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4040" x2="4040" y1="3030.9204" y2="3115.0127"/><polygon fill="#A80036" points="4036,3105.0127,4040,3115.0127,4044,3105.0127,4040,3109.0127" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4040" x2="4040" y1="3275.4199" y2="3292.4199"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4040" x2="265.5" y1="3292.4199" y2="3292.4199"/><line style="stroke:#A80036;stroke-width:1.5;" x1="265.5" x2="265.5" y1="3292.4199" y2="3307.4199"/><polygon fill="#A80036" points="261.5,3297.4199,265.5,3307.4199,269.5,3297.4199,265.5,3301.4199" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="79" x="228" y="50.8984">CLI Layer</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="115" x="699" y="50.8984">Data Loading</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="107" x="1201" y="50.8984">Initialization</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="142" x="1553" y="50.8984">Query Execution</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="198" x="1991.25" y="50.8984">Phase 1: Vector Search</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="276" x="2701" y="50.8984">Phase 2: Token Budget Filtering</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="243" x="3454.25" y="50.8984">Phase 3: Answer Generation</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="220" x="4129.75" y="50.8984">Phase 4: Result Assembly</text><!--MD5=[4af67459f99fb554a18961dfc19d5462]
@startuml Basic Search Activity Diagram
title GraphRAG Basic Search - Detailed Activity Flow (Traditional RAG)

|#AntiqueWhite|CLI Layer|
start
:User executes query\n""graphrag query 'What does the document say about X?' - -method basic"";

:Parse CLI arguments;
note right
  - query string
  - root directory
  - data directory
  - response_type
  - streaming flag
end note

:Load configuration\n(settings.yaml);

|#LightBlue|Data Loading|
:Read Parquet files from output/;
:Load text_units.parquet;
note right
  Minimal data requirements:
  - Only text units needed
  - No graph structure required
  - Simplest search method
end note

:Load embedding vector stores;
:Load text_unit_text embeddings;
note right
  Vector store contains:
  - Embeddings of text unit content
  - Used for similarity search
end note

|#LightGreen|Initialization|
:Create BasicSearch engine via factory;

partition "Factory Setup" {
  :Create completion model\n(LiteLLM);
  :Create embedding model\n(for query embedding);
  :Load basic search prompt;
  note right
    BASIC_SEARCH_SYSTEM_PROMPT
    Simple RAG instructions
  end note
  :Create BasicSearchContext builder;
  note right
    Configured with:
    - text_units DataFrame
    - text_unit_embeddings vectorstore
    - text_embedder model
    - token encoder
  end note
  :Set retrieval parameters;
  note right
    - k: Number of text units (default: 10)
    - max_context_tokens: 4000
  end note
}

|#LightYellow|Query Execution|
:Start BasicSearch.search(query);

|#LightCoral|Phase 1: Vector Search|
partition "Text Unit Retrieval" {
  :Embed query using text embedding model;
  note right
    query_embedding = text_embedder.embedding(query)
  end note

  :Vector similarity search on text_unit_text embeddings;
  note right
    Search parameters:
    - text: query string
    - k: number of chunks (default: 10)
    - metric: cosine similarity
  end note

  :Retrieve top-k similar text units;
  note right
    Returns list of VectorSearchResult:
    - document.id: text unit ID
    - score: similarity score
    - metadata: additional info
  end note

  :Extract text unit IDs from search results;

  :Filter text_units DataFrame by IDs;
  note right
    Create filtered list:
    [{id: "unit_1", text: "content..."}, ...]
  end note

  :Create DataFrame of retrieved text units;
}

|#LightSteelBlue|Phase 2: Token Budget Filtering|
partition "Apply Context Window Limit" {
  :Initialize context building;
  note right
    - current_tokens = 0
    - text_ids = []
    - max_context_tokens = 4000 (default)
  end note

  :Count header tokens;
  note right
    Header format: "id|text\n"
  end note

  repeat
    :Select next text unit from retrieved list;

    :Format as CSV row;
    note right
      Format: "unit_id|text_content\n"
      Separator: | (pipe)
    end note

    :Count tokens in formatted row;

    if (current_tokens + row_tokens ≤ max_context_tokens?) then (yes)
      :Add text unit to context;
      :Add index to text_ids;
      :Update current_tokens;
    else (no)
      :Token limit reached;
      :Stop adding text units;
      note right
        Remaining text units discarded
        Ensures we fit in LLM context
      end note
      break
    endif

  repeat while (More text units?) is (yes)
  -> no;

  :Filter DataFrame by selected indices;

  :Convert to CSV format;
  note right
    CSV format:
    id|text
    unit_1|This is the content of unit 1...
    unit_2|Another text unit content...
    ...
  end note

  :Store as context_chunks;
}

|#Lavender|Phase 3: Answer Generation|
partition "LLM Generation" {
  :Build completion messages;
  note right
    System Message:
    - BASIC_SEARCH_SYSTEM_PROMPT
    - Formatted text units context (CSV)
    - response_type parameter

    User Message:
    - User query
  end note

  :Call LLM with streaming;

  if (Streaming enabled?) then (yes)
    repeat
      :Receive token chunk;
      :Yield token to CLI;
      note right
        Real-time display
        in terminal
      end note
      :Append to full_response;
    repeat while (More tokens?) is (yes)
    -> no;
  else (no)
    :Receive complete response;
  endif

  :Track LLM call metadata;
  note right
    - llm_calls: 1
    - prompt_tokens: system + context + query
    - output_tokens: response length
    - completion_time: duration
  end note
}

|#PaleGreen|Phase 4: Result Assembly|
partition "Create SearchResult" {
  :Assemble SearchResult object;
  note right
    SearchResult contains:
    - response: Generated answer (string)
    - context_data: {sources: DataFrame}
    - context_text: Formatted CSV context
    - completion_time: duration (float)
    - llm_calls: 1
    - prompt_tokens: input tokens
    - output_tokens: generated tokens
    - llm_calls_categories: {"build_context": 0, "response": 1}
    - prompt_tokens_categories: per-phase breakdown
    - output_tokens_categories: per-phase breakdown
  end note

  :Return SearchResult to API layer;
}

|#AntiqueWhite|CLI Layer|
:Display answer to user;

if (Verbose flag?) then (yes)
  :Display statistics;
  note right
    - LLM calls: 1
    - Prompt tokens: X
    - Output tokens: Y
    - Total tokens: X + Y
    - Completion time: Z seconds
  end note
else (no)
  :Skip statistics;
endif

:Exit with success;
stop







@enduml

PlantUML version 1.2021.00(Sun Jan 10 18:25:05 SGT 2021)
(MIT source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: SG
--></g></svg>