<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="8146px" preserveAspectRatio="none" style="width:9562px;height:8146px;" version="1.1" viewBox="0 0 9562 8146" width="9562px" zoomAndPan="magnify"><defs><filter height="300%" id="fvkkzmuj9lo31" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="554" x="4503.375" y="27.4023">GraphRAG Global Search - Detailed Activity Flow (MAP-REDUCE)</text><rect fill="#FAEBD7" height="8096.4287" style="stroke:#FAEBD7;stroke-width:1.0;" width="581.5" x="15" y="33.4961"/><ellipse cx="272.5" cy="69.6953" fill="#000000" filter="url(#fvkkzmuj9lo31)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="48.1016" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="426" x="59.5" y="99.6953"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="118" x="69.5" y="121.2969">User executes query</text><text fill="#000000" font-family="monospace" font-size="12" lengthAdjust="spacing" textLength="406" x="69.5" y="134.9668">graphrag query 'What are the main themes?' --method global</text><path d="M361.5,157.7969 L361.5,212.3838 L341.5,216.3838 L361.5,220.3838 L361.5,274.9707 A0,0 0 0 0 361.5,274.9707 L591.5,274.9707 A0,0 0 0 0 591.5,274.9707 L591.5,167.7969 L581.5,157.7969 L361.5,157.7969 A0,0 0 0 0 361.5,157.7969 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M581.5,157.7969 L581.5,167.7969 L591.5,167.7969 L581.5,157.7969 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="367.5" y="175.3652">- query string</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="367.5" y="190.6758">- root directory</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="367.5" y="205.9863">- data directory</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="367.5" y="221.2969">- community_level</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="367.5" y="236.6074">- response_type</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209" x="367.5" y="251.918">- dynamic-community-selection</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="367.5" y="267.2285">- streaming flag</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="138" x="203.5" y="199.3174"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="118" x="213.5" y="220.9189">Parse CLI arguments</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="48.2656" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="126" x="209.5" y="294.9707"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="106" x="219.5" y="316.5723">Load configuration</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="83" x="219.5" y="330.7051">(settings.yaml)</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="151" x="197" y="7783.1748"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="131" x="207" y="7804.7764">Display answer to user</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="236.5,7837.3076,308.5,7837.3076,320.5,7849.3076,308.5,7861.3076,236.5,7861.3076,224.5,7849.3076,236.5,7837.3076" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="72" x="236.5" y="7853.4648">Verbose flag?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="206.5" y="7846.9873">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="320.5" y="7846.9873">no</text><path d="M156,7871.3076 L156,7933.5498 L136,7937.5498 L156,7941.5498 L156,8003.792 A0,0 0 0 0 156,8003.792 L398,8003.792 A0,0 0 0 0 398,8003.792 L398,7881.3076 L388,7871.3076 L156,7871.3076 A0,0 0 0 0 156,7871.3076 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M388,7871.3076 L388,7881.3076 L398,7881.3076 L388,7871.3076 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221" x="162" y="7888.876">- LLM calls: N + 1 (MAP + REDUCE)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="170" y="7904.1865">- build_context: X calls</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="170" y="7919.4971">- map: N calls</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="170" y="7934.8076">- reduce: 1 call</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="162" y="7950.1182">- Prompt tokens: Y</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="162" y="7965.4287">- Output tokens: Z</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="162" y="7980.7393">- Total tokens: Y + Z</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189" x="162" y="7996.0498">- Completion time: T seconds</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="115" x="21" y="7920.4834"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="95" x="31" y="7942.085">Display statistics</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="97" x="418" y="7871.3076"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="77" x="428" y="7892.9092">Skip statistics</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="272.5,8009.792,284.5,8021.792,272.5,8033.792,260.5,8021.792,272.5,8009.792" style="stroke:#A80036;stroke-width:1.5;"/><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="116" x="214.5" y="8053.792"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="96" x="224.5" y="8075.3936">Exit with success</text><ellipse cx="272.5" cy="8118.9248" fill="#FFFFFF" filter="url(#fvkkzmuj9lo31)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="272.5" cy="8118.9248" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:2.0;" x1="15" x2="15" y1="33.4961" y2="8129.9248"/><rect fill="#ADD8E6" height="8096.4287" style="stroke:#ADD8E6;stroke-width:1.0;" width="682" x="596.5" y="33.4961"/><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="204" x="833.5" y="363.2363"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="184" x="843.5" y="384.8379">Read Parquet files from output/</text><rect fill="#000000" filter="url(#fvkkzmuj9lo31)" height="6" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="666" x="602.5" y="417.3691"/><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="48.2656" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="200" x="614.5" y="443.3691"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="123" x="624.5" y="464.9707">Load entities.parquet</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="180" x="624.5" y="479.1035">(optional for dynamic selection)</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="174" x="842.5" y="450.4355"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="154" x="852.5" y="472.0371">Load communities.parquet</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="212" x="1044.5" y="450.4355"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="192" x="1054.5" y="472.0371">Load community_reports.parquet</text><rect fill="#000000" filter="url(#fvkkzmuj9lo31)" height="6" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="666" x="602.5" y="511.6348"/><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="48.2656" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="196" x="837.5" y="537.6348"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="176" x="847.5" y="559.2363">Load embedding vector stores</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="172" x="847.5" y="573.3691">(if dynamic selection enabled)</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="862,605.9004,1009,605.9004,1021,617.9004,1009,629.9004,862,629.9004,850,617.9004,862,605.9004" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="147" x="862" y="622.0576">Dynamic selection enabled?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="832" y="615.5801">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="1021" y="615.5801">no</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="229" x="713.75" y="639.9004"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="209" x="723.75" y="661.502">Load entity_description embeddings</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="160" x="962.75" y="639.9004"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="140" x="972.75" y="661.502">Skip embedding loading</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="935.5,680.0332,947.5,692.0332,935.5,704.0332,923.5,692.0332,935.5,680.0332" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:2.0;" x1="596.5" x2="596.5" y1="33.4961" y2="8129.9248"/><rect fill="#90EE90" height="8096.4287" style="stroke:#90EE90;stroke-width:1.0;" width="543" x="1278.5" y="33.4961"/><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="242" x="1299.5" y="724.0332"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="222" x="1309.5" y="745.6348">Create GlobalSearch engine via factory</text><rect fill="#FFFFFF" filter="url(#fvkkzmuj9lo31)" height="371.1016" style="stroke:#000000;stroke-width:2.0;" width="527" x="1284.5" y="768.166"/><path d="M1387.5,768.166 L1387.5,777.6543 L1377.5,787.6543 L1284.5,787.6543 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93" x="1287.5" y="782.7012">Factory Setup</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="48.2656" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="165" x="1338" y="804.6543"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="145" x="1348" y="826.2559">Create completion model</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="50" x="1348" y="840.3887">(LiteLLM)</text><path d="M1531.5,862.9199 L1531.5,886.8857 L1511.5,890.8857 L1531.5,894.8857 L1531.5,918.8516 A0,0 0 0 0 1531.5,918.8516 L1801.5,918.8516 A0,0 0 0 0 1801.5,918.8516 L1801.5,872.9199 L1791.5,862.9199 L1531.5,862.9199 A0,0 0 0 0 1531.5,862.9199 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1791.5,862.9199 L1791.5,872.9199 L1801.5,872.9199 L1791.5,862.9199 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="1537.5" y="880.4883">- MAP_SYSTEM_PROMPT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="1537.5" y="895.7988">- REDUCE_SYSTEM_PROMPT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="1537.5" y="911.1094">- GENERAL_KNOWLEDGE_INSTRUCTION</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="182" x="1329.5" y="873.8193"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="162" x="1339.5" y="895.4209">Load global search prompts</text><path d="M1566.5,928.8516 L1566.5,975.7832 L1546.5,979.7832 L1566.5,983.7832 L1566.5,1030.7148 A0,0 0 0 0 1566.5,1030.7148 L1793.5,1030.7148 A0,0 0 0 0 1793.5,1030.7148 L1793.5,938.8516 L1783.5,928.8516 L1566.5,928.8516 A0,0 0 0 0 1566.5,928.8516 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1783.5,928.8516 L1783.5,938.8516 L1793.5,938.8516 L1783.5,928.8516 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="1572.5" y="946.4199">Configured with:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="1572.5" y="961.7305">- community_reports DataFrame</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="1572.5" y="977.041">- communities DataFrame</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="1572.5" y="992.3516">- entities DataFrame (optional)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="1572.5" y="1007.6621">- token encoder</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="1572.5" y="1022.9727">- dynamic selection settings</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="252" x="1294.5" y="962.7168"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="232" x="1304.5" y="984.3184">Create GlobalCommunityContext builder</text><path d="M1536,1040.7148 L1536,1079.9912 L1516,1083.9912 L1536,1087.9912 L1536,1127.2676 A0,0 0 0 0 1536,1127.2676 L1774,1127.2676 A0,0 0 0 0 1774,1127.2676 L1774,1050.7148 L1764,1040.7148 L1536,1040.7148 A0,0 0 0 0 1536,1040.7148 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1764,1040.7148 L1764,1050.7148 L1774,1050.7148 L1764,1040.7148 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="1542" y="1058.2832">- max_context_tokens: 8000</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="1542" y="1073.5938">- data_max_tokens: 8000</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202" x="1542" y="1088.9043">- map_max_length: 1000 words</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="1542" y="1104.2148">- reduce_max_length: 2000 words</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="1542" y="1119.5254">- concurrent_coroutines: 32</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="191" x="1325" y="1066.9248"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="171" x="1335" y="1088.5264">Set MAP-REDUCE parameters</text><line style="stroke:#000000;stroke-width:2.0;" x1="1278.5" x2="1278.5" y1="33.4961" y2="8129.9248"/><rect fill="#FFFFE0" height="8096.4287" style="stroke:#FFFFE0;stroke-width:1.0;" width="662" x="1821.5" y="33.4961"/><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="208" x="2065.75" y="1159.2676"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="188" x="2075.75" y="1180.8691">Start GlobalSearch.search(query)</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="2093.25,1213.4004,2246.25,1213.4004,2258.25,1225.4004,2246.25,1237.4004,2093.25,1237.4004,2081.25,1225.4004,2093.25,1213.4004" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="153" x="2093.25" y="1229.5576">Conversation history exists?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="2063.25" y="1223.0801">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="2258.25" y="1223.0801">no</text><path d="M2070.5,1247.4004 L2070.5,1263.7109 L2050.5,1267.7109 L2070.5,1271.7109 L2070.5,1288.0215 A0,0 0 0 0 2070.5,1288.0215 L2297.5,1288.0215 A0,0 0 0 0 2297.5,1288.0215 L2297.5,1257.4004 L2287.5,1247.4004 L2070.5,1247.4004 A0,0 0 0 0 2070.5,1247.4004 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2287.5,1247.4004 L2287.5,1257.4004 L2297.5,1257.4004 L2287.5,1247.4004 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="2076.5" y="1264.9688">conversation_history_max_turns</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68" x="2076.5" y="1280.2793">(default: 5)</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="223" x="1827.5" y="1250.6445"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="203" x="1837.5" y="1272.2461">Add conversation history to context</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="166" x="2307.5" y="1247.4004"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="146" x="2317.5" y="1269.002">Skip conversation context</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="2169.75,1294.0215,2181.75,1306.0215,2169.75,1318.0215,2157.75,1306.0215,2169.75,1294.0215" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:2.0;" x1="1821.5" x2="1821.5" y1="33.4961" y2="8129.9248"/><rect fill="#F08080" height="8096.4287" style="stroke:#F08080;stroke-width:1.0;" width="254" x="2483.5" y="33.4961"/><rect fill="#FFFFFF" filter="url(#fvkkzmuj9lo31)" height="1508.8711" style="stroke:#000000;stroke-width:2.0;" width="238" x="2489.5" y="1328.0215"/><path d="M2694.5,1328.0215 L2694.5,1337.5098 L2684.5,1347.5098 L2489.5,1347.5098 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="195" x="2492.5" y="1342.5566">Community Report Selection</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="2542.5,1364.5098,2689.5,1364.5098,2701.5,1376.5098,2689.5,1388.5098,2542.5,1388.5098,2530.5,1376.5098,2542.5,1364.5098" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="147" x="2542.5" y="1380.667">Dynamic selection enabled?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="2512.5" y="1374.1895">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="2701.5" y="1374.1895">no</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="2616,2743.5156,2628,2755.5156,2616,2767.5156,2604,2755.5156,2616,2743.5156" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:2.0;" x1="2483.5" x2="2483.5" y1="33.4961" y2="8129.9248"/><rect fill="#F08080" height="8096.4287" style="stroke:#F08080;stroke-width:1.0;" width="1016.5" x="2737.5" y="33.4961"/><rect fill="#FFFFFF" filter="url(#fvkkzmuj9lo31)" height="1508.8711" style="stroke:#000000;stroke-width:2.0;" width="1000.5" x="2743.5" y="1328.0215"/><path d="M2948.5,1328.0215 L2948.5,1337.5098 L2938.5,1347.5098 L2743.5,1347.5098 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="195" x="2746.5" y="1342.5566">Community Report Selection</text><path d="M3342,1405.2656 L3342,1452.1973 L3322,1456.1973 L3342,1460.1973 L3342,1507.1289 A0,0 0 0 0 3342,1507.1289 L3551,1507.1289 A0,0 0 0 0 3551,1507.1289 L3551,1415.2656 L3541,1405.2656 L3342,1405.2656 A0,0 0 0 0 3342,1405.2656 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3541,1405.2656 L3541,1415.2656 L3551,1415.2656 L3541,1405.2656 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73" x="3348" y="1422.834">Parameters:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="3348" y="1438.1445">- rating_threshold (default: 7)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="3348" y="1453.4551">- keep_parent (default: true)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="3348" y="1468.7656">- num_repeats (default: 1)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="3348" y="1484.0762">- use_summary (default: true)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="3348" y="1499.3867">- max_level (default: 10)</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="234" x="3088" y="1439.1309"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="214" x="3098" y="1460.7324">Initialize DynamicCommunitySelection</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="226" x="3092" y="1535.0195"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="206" x="3102" y="1556.6211">Start with root communities (level 0)</text><path d="M3342,1623.1523 L3342,1654.7734 L3322,1658.7734 L3342,1662.7734 L3342,1694.3945 A0,0 0 0 0 3342,1694.3945 L3716,1694.3945 A0,0 0 0 0 3716,1694.3945 L3716,1633.1523 L3706,1623.1523 L3342,1623.1523 A0,0 0 0 0 3342,1623.1523 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3706,1623.1523 L3706,1633.1523 L3716,1633.1523 L3706,1623.1523 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="3348" y="1640.7207">For each community:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="3348" y="1656.0313">- Query: User query</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="353" x="3348" y="1671.3418">- Description: Community report summary/full_content</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="3348" y="1686.6523">- LLM rates relevance: 0-10 scale</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="234" x="3088" y="1641.707"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="214" x="3098" y="1663.3086">Rate batch of communities in parallel</text><rect fill="#000000" filter="url(#fvkkzmuj9lo31)" height="6" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="919" x="2755.5" y="1714.3945"/><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="208" x="2767.5" y="1740.3945"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="188" x="2777.5" y="1761.9961">Community A: Call LLM for rating</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="207" x="2985.5" y="1740.3945"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="187" x="2995.5" y="1761.9961">Community B: Call LLM for rating</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="208" x="3220.5" y="1740.3945"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="188" x="3230.5" y="1761.9961">Community C: Call LLM for rating</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="204" x="3456.5" y="1740.3945"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="184" x="3466.5" y="1761.9961">... (up to concurrent_coroutines)</text><rect fill="#000000" filter="url(#fvkkzmuj9lo31)" height="6" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="919" x="2755.5" y="1794.5273"/><path d="M3327,1810.5273 L3327,1842.1484 L3307,1846.1484 L3327,1850.1484 L3327,1881.7695 A0,0 0 0 0 3327,1881.7695 L3456,1881.7695 A0,0 0 0 0 3456,1881.7695 L3456,1820.5273 L3446,1810.5273 L3327,1810.5273 A0,0 0 0 0 3327,1810.5273 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3446,1810.5273 L3446,1820.5273 L3456,1820.5273 L3446,1810.5273 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="3333" y="1828.0957">Track:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="3333" y="1843.4063">- llm_calls count</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="3333" y="1858.7168">- prompt_tokens</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="3333" y="1874.0273">- output_tokens</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="204" x="3103" y="1829.082"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="184" x="3113" y="1850.6836">Collect ratings from all LLM calls</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="170" x="3120" y="1945.7695"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="150" x="3130" y="1967.3711">For each rated community</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="3152,1999.9023,3258,1999.9023,3270,2011.9023,3258,2023.9023,3152,2023.9023,3140,2011.9023,3152,1999.9023" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="106" x="3152" y="2016.0596">Rating ≥ threshold?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="3122" y="2009.582">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="3270" y="2009.582">no</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="187" x="3010.5" y="2033.9023"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="167" x="3020.5" y="2055.5039">Add to relevant_communities</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="178" x="3015" y="2136.5127"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="158" x="3025" y="2158.1143">Add children to next queue</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="3068,2088.0352,3140,2088.0352,3152,2100.0352,3140,2112.0352,3068,2112.0352,3056,2100.0352,3068,2088.0352" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="3108" y="2122.6699">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="72" x="3068" y="2104.1924">Has children?</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="3104,2195.123,3116,2207.123,3104,2219.123,3092,2207.123,3104,2195.123" style="stroke:#A80036;stroke-width:1.5;"/><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="210" x="2999" y="2287.6006"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="190" x="3009" y="2309.2021">Remove parent from relevant set</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="3048.5,2239.123,3159.5,2239.123,3171.5,2251.123,3159.5,2263.123,3048.5,2263.123,3036.5,2251.123,3048.5,2239.123" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="3108" y="2273.7578">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="111" x="3048.5" y="2255.2803">keep_parent = false?</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="3104,2341.7334,3116,2353.7334,3104,2365.7334,3092,2353.7334,3104,2341.7334" style="stroke:#A80036;stroke-width:1.5;"/><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="110" x="3251" y="2033.9023"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="90" x="3261" y="2055.5039">Skip community</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="3205,2371.7334,3217,2383.7334,3205,2395.7334,3193,2383.7334,3205,2371.7334" style="stroke:#A80036;stroke-width:1.5;"/><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="3205,1901.7695,3217,1913.7695,3205,1925.7695,3193,1913.7695,3205,1901.7695" style="stroke:#A80036;stroke-width:1.5;"/><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="3137.5,2415.7334,3272.5,2415.7334,3284.5,2427.7334,3272.5,2439.7334,3137.5,2439.7334,3125.5,2427.7334,3137.5,2415.7334" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="135" x="3137.5" y="2431.8906">More rated communities?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="3284.5" y="2425.4131">yes</text><path d="M3330.5,2529.4863 L3330.5,2545.7969 L3310.5,2549.7969 L3330.5,2553.7969 L3330.5,2570.1074 A0,0 0 0 0 3330.5,2570.1074 L3542.5,2570.1074 A0,0 0 0 0 3542.5,2570.1074 L3542.5,2539.4863 L3532.5,2529.4863 L3330.5,2529.4863 A0,0 0 0 0 3330.5,2529.4863 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3532.5,2529.4863 L3532.5,2539.4863 L3542.5,2539.4863 L3532.5,2529.4863 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="3336.5" y="2547.0547">Fallback mechanism to ensure</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="3336.5" y="2562.3652">we don't return empty results</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="211" x="3099.5" y="2532.7305"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="191" x="3109.5" y="2554.332">Add all communities at next level</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="3104.5,2481.0088,3305.5,2481.0088,3317.5,2493.0088,3305.5,2505.0088,3104.5,2505.0088,3092.5,2493.0088,3104.5,2481.0088" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="3209" y="2515.6436">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="201" x="3104.5" y="2497.166">Queue empty AND no relevant found?</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="3205,2590.1074,3217,2602.1074,3205,2614.1074,3193,2602.1074,3205,2590.1074" style="stroke:#A80036;stroke-width:1.5;"/><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="3205,1589.1523,3217,1601.1523,3205,1613.1523,3193,1601.1523,3205,1589.1523" style="stroke:#A80036;stroke-width:1.5;"/><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="3138,2634.1074,3272,2634.1074,3284,2646.1074,3272,2658.1074,3138,2658.1074,3126,2646.1074,3138,2634.1074" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="134" x="3138" y="2650.2646">Queue has communities?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="3284" y="2643.7871">yes</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="308" x="3051" y="2699.3828"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="288" x="3061" y="2720.9844">Filter community_reports by relevant_communities</text><line style="stroke:#000000;stroke-width:2.0;" x1="2737.5" x2="2737.5" y1="33.4961" y2="8129.9248"/><rect fill="#F08080" height="8096.4287" style="stroke:#F08080;stroke-width:1.0;" width="788.75" x="3754" y="33.4961"/><rect fill="#FFFFFF" filter="url(#fvkkzmuj9lo31)" height="1508.8711" style="stroke:#000000;stroke-width:2.0;" width="772.75" x="3760" y="1328.0215"/><path d="M3965,1328.0215 L3965,1337.5098 L3955,1347.5098 L3760,1347.5098 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="195" x="3763" y="1342.5566">Community Report Selection</text><path d="M4387.75,1405.2656 L4387.75,1421.5762 L4367.75,1425.5762 L4387.75,1429.5762 L4387.75,1445.8867 A0,0 0 0 0 4387.75,1445.8867 L4520.75,1445.8867 A0,0 0 0 0 4520.75,1445.8867 L4520.75,1415.2656 L4510.75,1405.2656 L4387.75,1405.2656 A0,0 0 0 0 4387.75,1405.2656 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4510.75,1405.2656 L4510.75,1415.2656 L4520.75,1415.2656 L4510.75,1405.2656 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95" x="4393.75" y="1422.834">Default: level 2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="4393.75" y="1438.1445">Fast, no LLM calls</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="285" x="4082.75" y="1408.5098"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="265" x="4092.75" y="1430.1113">Select all reports at specified community_level</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="249" x="4100.75" y="1480.8867"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="229" x="4110.75" y="1502.4883">Filter by min_community_rank (optional)</text><path d="M3990,2784.2715 L3990,2800.582 L3970,2804.582 L3990,2808.582 L3990,2824.8926 A0,0 0 0 0 3990,2824.8926 L4191,2824.8926 A0,0 0 0 0 4191,2824.8926 L4191,2794.2715 L4181,2784.2715 L3990,2784.2715 A0,0 0 0 0 3990,2784.2715 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4181,2784.2715 L4181,2794.2715 L4191,2794.2715 L4181,2784.2715 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="3996" y="2801.8398">Selected reports will be used</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="3996" y="2817.1504">in MAP phase</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="187" x="3783" y="2787.5156"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="167" x="3793" y="2809.1172">Retrieved community reports</text><line style="stroke:#000000;stroke-width:2.0;" x1="3754" x2="3754" y1="33.4961" y2="8129.9248"/><rect fill="#B0C4DE" height="8096.4287" style="stroke:#B0C4DE;stroke-width:1.0;" width="745" x="4542.75" y="33.4961"/><rect fill="#FFFFFF" filter="url(#fvkkzmuj9lo31)" height="1093.0029" style="stroke:#000000;stroke-width:2.0;" width="729" x="4548.75" y="2846.8926"/><path d="M4750.75,2846.8926 L4750.75,2856.3809 L4740.75,2866.3809 L4548.75,2866.3809 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="192" x="4551.75" y="2861.4277">Community Report Batching</text><path d="M4955.25,2876.3809 L4955.25,2915.6572 L4935.25,2919.6572 L4955.25,2923.6572 L4955.25,2962.9336 A0,0 0 0 0 4955.25,2962.9336 L5212.25,2962.9336 A0,0 0 0 0 5212.25,2962.9336 L5212.25,2886.3809 L5202.25,2876.3809 L4955.25,2876.3809 A0,0 0 0 0 4955.25,2876.3809 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M5202.25,2876.3809 L5202.25,2886.3809 L5212.25,2886.3809 L5202.25,2876.3809 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236" x="4961.25" y="2893.9492">Function: build_community_context()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="4961.25" y="2909.2598">- Format reports as CSV</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209" x="4961.25" y="2924.5703">- Shuffle data (random_state: 86)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="4961.25" y="2939.8809">- Apply token limits per batch</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198" x="4961.25" y="2955.1914">- Calculate community weights</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="209" x="4726.25" y="2902.5908"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="189" x="4736.25" y="2924.1924">Build community context batches</text><path d="M4964.75,3035.8223 L4964.75,3044.4775 L4944.75,3048.4775 L4964.75,3052.4775 L4964.75,3061.1328 A0,0 0 0 0 4964.75,3061.1328 L5199.75,3061.1328 A0,0 0 0 0 5199.75,3061.1328 L5199.75,3045.8223 L5189.75,3035.8223 L4964.75,3035.8223 A0,0 0 0 0 4964.75,3035.8223 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M5189.75,3035.8223 L5189.75,3045.8223 L5199.75,3045.8223 L5189.75,3035.8223 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="4970.75" y="3053.3906">Improves diversity across batches</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="228" x="4716.75" y="3031.4111"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="208" x="4726.75" y="3053.0127">Shuffle community reports randomly</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="4776.75,2982.9336,4884.75,2982.9336,4896.75,2994.9336,4884.75,3006.9336,4776.75,3006.9336,4764.75,2994.9336,4776.75,2982.9336" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="4834.75" y="3017.5684">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="108" x="4776.75" y="2999.0908">shuffle_data = true?</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="4830.75,3085.5439,4842.75,3097.5439,4830.75,3109.5439,4818.75,3097.5439,4830.75,3085.5439" style="stroke:#A80036;stroke-width:1.5;"/><path d="M4930.25,3119.5439 L4930.25,3143.5098 L4910.25,3147.5098 L4930.25,3151.5098 L4930.25,3175.4756 A0,0 0 0 0 4930.25,3175.4756 L5084.25,3175.4756 A0,0 0 0 0 5084.25,3175.4756 L5084.25,3129.5439 L5074.25,3119.5439 L4930.25,3119.5439 A0,0 0 0 0 4930.25,3119.5439 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M5074.25,3119.5439 L5074.25,3129.5439 L5084.25,3129.5439 L5074.25,3119.5439 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="4936.25" y="3137.1123">- current_batch = []</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="4936.25" y="3152.4229">- current_tokens = 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87" x="4936.25" y="3167.7334">- batches = []</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="159" x="4751.25" y="3130.4434"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="139" x="4761.25" y="3152.0449">Initialize batch variables</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="188" x="4736.75" y="3239.4756"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="168" x="4746.75" y="3261.0771">Select next community report</text><path d="M4934.75,3283.6084 L4934.75,3361.1611 L4914.75,3365.1611 L4934.75,3369.1611 L4934.75,3446.7139 A0,0 0 0 0 4934.75,3446.7139 L5249.75,3446.7139 A0,0 0 0 0 5249.75,3446.7139 L5249.75,3293.6084 L5239.75,3283.6084 L4934.75,3283.6084 A0,0 0 0 0 4934.75,3283.6084 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M5239.75,3283.6084 L5239.75,3293.6084 L5249.75,3293.6084 L5239.75,3283.6084 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60" x="4940.75" y="3301.1768">Columns:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="24" x="4940.75" y="3316.4873">- id</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="4940.75" y="3331.7979">- community</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="41" x="4940.75" y="3347.1084">- level</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="37" x="4940.75" y="3362.4189">- title</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="4940.75" y="3377.7295">- summary OR full_content</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="4940.75" y="3393.04">- rank (optional)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="4940.75" y="3408.3506">- weight/occurrence (optional)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="4944.75" y="3423.6611"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="294" x="4940.75" y="3438.9717">Format: "id|community|level|title|summary|..."</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="168" x="4746.75" y="3348.0947"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="148" x="4756.75" y="3369.6963">Format report as CSV row</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="210" x="4725.75" y="3466.7139"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="190" x="4735.75" y="3488.3154">Count tokens in formatted report</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="4678.25,3520.8467,4983.25,3520.8467,4995.25,3532.8467,4983.25,3544.8467,4678.25,3544.8467,4666.25,3532.8467,4678.25,3520.8467" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="305" x="4678.25" y="3537.0039">current_tokens + report_tokens &gt; max_context_tokens?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="4648.25" y="3530.5264">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="4995.25" y="3530.5264">no</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="191" x="4560.75" y="3554.8467"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="171" x="4570.75" y="3576.4482">Save current batch to batches</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="109" x="4601.75" y="3608.9795"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="4611.75" y="3630.5811">Start new batch</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="167" x="4572.75" y="3663.1123"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="147" x="4582.75" y="3684.7139">Reset current_tokens = 0</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="182" x="4914.25" y="3554.8467"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="162" x="4924.25" y="3576.4482">Add report to current_batch</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="151" x="4929.75" y="3608.9795"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="131" x="4939.75" y="3630.5811">Update current_tokens</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="4830.75,3703.2451,4842.75,3715.2451,4830.75,3727.2451,4818.75,3715.2451,4830.75,3703.2451" style="stroke:#A80036;stroke-width:1.5;"/><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="4830.75,3195.4756,4842.75,3207.4756,4830.75,3219.4756,4818.75,3207.4756,4830.75,3195.4756" style="stroke:#A80036;stroke-width:1.5;"/><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="4793.25,3747.2451,4868.25,3747.2451,4880.25,3759.2451,4868.25,3771.2451,4793.25,3771.2451,4781.25,3759.2451,4793.25,3747.2451" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="75" x="4793.25" y="3763.4023">More reports?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="4880.25" y="3756.9248">yes</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="174" x="4743.75" y="3812.5205"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="154" x="4753.75" y="3834.1221">Save final batch to batches</text><path d="M4967.75,3856.6533 L4967.75,3888.2744 L4947.75,3892.2744 L4967.75,3896.2744 L4967.75,3927.8955 A0,0 0 0 0 4967.75,3927.8955 L5225.75,3927.8955 A0,0 0 0 0 5225.75,3927.8955 L5225.75,3866.6533 L5215.75,3856.6533 L4967.75,3856.6533 A0,0 0 0 0 4967.75,3856.6533 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M5215.75,3856.6533 L5215.75,3866.6533 L5225.75,3866.6533 L5215.75,3856.6533 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218" x="4973.75" y="3874.2217">Each batch ≤ max_context_tokens</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139" x="4973.75" y="3889.5322">(default: 8000 tokens)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="4977.75" y="3904.8428"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237" x="4973.75" y="3920.1533">Multiple batches = Multiple MAP calls</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="234" x="4713.75" y="3875.208"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="214" x="4723.75" y="3896.8096">Return batches of community reports</text><line style="stroke:#000000;stroke-width:2.0;" x1="4542.75" x2="4542.75" y1="33.4961" y2="8129.9248"/><rect fill="#E6E6FA" height="8096.4287" style="stroke:#E6E6FA;stroke-width:1.0;" width="630" x="5287.75" y="33.4961"/><rect fill="#FFFFFF" filter="url(#fvkkzmuj9lo31)" height="1144.4063" style="stroke:#000000;stroke-width:2.0;" width="614" x="5293.75" y="3949.8955"/><path d="M5471.75,3949.8955 L5471.75,3959.3838 L5461.75,3969.3838 L5293.75,3969.3838 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="168" x="5296.75" y="3964.4307">MAP - Extract Key Points</text><path d="M5599.25,3986.1396 L5599.25,4002.4502 L5579.25,4006.4502 L5599.25,4010.4502 L5599.25,4026.7607 A0,0 0 0 0 5599.25,4026.7607 L5849.25,4026.7607 A0,0 0 0 0 5849.25,4026.7607 L5849.25,3996.1396 L5839.25,3986.1396 L5599.25,3986.1396 A0,0 0 0 0 5599.25,3986.1396 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M5839.25,3986.1396 L5839.25,3996.1396 L5849.25,3996.1396 L5839.25,3986.1396 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229" x="5605.25" y="4003.708">Each batch processed independently</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="215" x="5605.25" y="4019.0186">in parallel with semaphore control</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="193" x="5386.25" y="3989.3838"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="173" x="5396.25" y="4010.9854">Prepare MAP phase execution</text><path d="M5658.75,4043.5166 L5658.75,4059.8271 L5638.75,4063.8271 L5658.75,4067.8271 L5658.75,4084.1377 A0,0 0 0 0 5658.75,4084.1377 L5885.75,4084.1377 A0,0 0 0 0 5885.75,4084.1377 L5885.75,4053.5166 L5875.75,4043.5166 L5658.75,4043.5166 A0,0 0 0 0 5658.75,4043.5166 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M5875.75,4043.5166 L5875.75,4053.5166 L5885.75,4053.5166 L5875.75,4043.5166 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="5664.75" y="4061.085">Default: 32 concurrent MAP calls</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127" x="5664.75" y="4076.3955">Controls parallelism</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="312" x="5326.75" y="4046.7607"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="292" x="5336.75" y="4068.3623">Create semaphore with concurrent_coroutines limit</text><rect fill="#000000" filter="url(#fvkkzmuj9lo31)" height="6" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="594" x="5303.75" y="4104.1377"/><line style="stroke:#000000;stroke-width:2.0;" x1="5287.75" x2="5287.75" y1="33.4961" y2="8129.9248"/><rect fill="#E6E6FA" height="8096.4287" style="stroke:#E6E6FA;stroke-width:1.0;" width="700.5" x="5917.75" y="33.4961"/><rect fill="#FFFFFF" filter="url(#fvkkzmuj9lo31)" height="1144.4063" style="stroke:#000000;stroke-width:2.0;" width="684.5" x="5923.75" y="3949.8955"/><path d="M6101.75,3949.8955 L6101.75,3959.3838 L6091.75,3969.3838 L5923.75,3969.3838 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="168" x="5926.75" y="3964.4307">MAP - Extract Key Points</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="133" x="6022.75" y="4130.1377"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="113" x="6032.75" y="4151.7393">Acquire semaphore</text><path d="M6205.25,4174.2705 L6205.25,4205.8916 L6185.25,4209.8916 L6205.25,4213.8916 L6205.25,4245.5127 A0,0 0 0 0 6205.25,4245.5127 L6596.25,4245.5127 A0,0 0 0 0 6596.25,4245.5127 L6596.25,4184.2705 L6586.25,4174.2705 L6205.25,4174.2705 A0,0 0 0 0 6205.25,4174.2705 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M6586.25,4174.2705 L6586.25,4184.2705 L6596.25,4184.2705 L6586.25,4174.2705 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190" x="6211.25" y="4191.8389">MAP_SYSTEM_PROMPT format:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="370" x="6211.25" y="4207.1494">- System: Prompt + context_data (community reports CSV)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="6211.25" y="4222.46">- User: Query</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="6211.25" y="4237.7705">- Parameters: max_length (1000 words)</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="192" x="5993.25" y="4192.8252"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="172" x="6003.25" y="4214.4268">Build MAP prompt for batch 1</text><path d="M6190.75,4262.2686 L6190.75,4278.5791 L6170.75,4282.5791 L6190.75,4286.5791 L6190.75,4302.8896 A0,0 0 0 0 6190.75,4302.8896 L6430.75,4302.8896 A0,0 0 0 0 6430.75,4302.8896 L6430.75,4272.2686 L6420.75,4262.2686 L6190.75,4262.2686 A0,0 0 0 0 6190.75,4262.2686 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M6420.75,4262.2686 L6420.75,4272.2686 L6430.75,4272.2686 L6420.75,4262.2686 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219" x="6196.75" y="4279.8369">response_format_json_object: true</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="6196.75" y="4295.1475">Ensures structured output</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="163" x="6007.75" y="4265.5127"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="143" x="6017.75" y="4287.1143">Call LLM with JSON mode</text><path d="M6185.75,4318.0361 L6185.75,4395.5889 L6165.75,4399.5889 L6185.75,4403.5889 L6185.75,4481.1416 A0,0 0 0 0 6185.75,4481.1416 L6421.75,4481.1416 A0,0 0 0 0 6421.75,4481.1416 L6421.75,4328.0361 L6411.75,4318.0361 L6185.75,4318.0361 A0,0 0 0 0 6185.75,4318.0361 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M6411.75,4318.0361 L6411.75,4328.0361 L6421.75,4328.0361 L6411.75,4318.0361 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="6191.75" y="4335.6045">Expected format:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="6191.75" y="4350.915">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="6199.75" y="4366.2256">"points": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="6207.75" y="4381.5361">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="6215.75" y="4396.8467">"description": "Key point text",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="6215.75" y="4412.1572">"score": 75  // 0-100</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="6207.75" y="4427.4678">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="6207.75" y="4442.7783">...</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="6199.75" y="4458.0889">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="6191.75" y="4473.3994">}</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="153" x="6012.75" y="4382.5225"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="133" x="6022.75" y="4404.124">Receive JSON response</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="141" x="6018.75" y="4516.1416"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="121" x="6028.75" y="4537.7432">Parse JSON response</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="6042.25,4584.4209,6136.25,4584.4209,6148.25,4596.4209,6136.25,4608.4209,6042.25,4608.4209,6030.25,4596.4209,6042.25,4584.4209" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="94" x="6042.25" y="4600.5781">Parse successful?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="6012.25" y="4594.1006">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="6148.25" y="4594.1006">no</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="133" x="5935.75" y="4618.4209"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="113" x="5945.75" y="4640.0225">Extract points array</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="175" x="6088.75" y="4618.4209"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="155" x="6098.75" y="4640.0225">Warning: JSON parse failed</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="157" x="6097.75" y="4687.5537"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="137" x="6107.75" y="4709.1553">Return empty points list</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="6089.25,4727.6865,6101.25,4739.6865,6089.25,4751.6865,6077.25,4739.6865,6089.25,4727.6865" style="stroke:#A80036;stroke-width:1.5;"/><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="134" x="6022.25" y="4771.6865"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="114" x="6032.25" y="4793.2881">Release semaphore</text><path d="M6172.25,4815.8193 L6172.25,4862.751 L6152.25,4866.751 L6172.25,4870.751 L6172.25,4917.6826 A0,0 0 0 0 6172.25,4917.6826 L6465.25,4917.6826 A0,0 0 0 0 6465.25,4917.6826 L6465.25,4825.8193 L6455.25,4815.8193 L6172.25,4815.8193 A0,0 0 0 0 6172.25,4815.8193 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M6455.25,4815.8193 L6455.25,4825.8193 L6465.25,4825.8193 L6455.25,4815.8193 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="6178.25" y="4833.3877">SearchResult contains:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212" x="6178.25" y="4848.6982">- response: list of {answer, score}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="250" x="6178.25" y="4864.0088">- context_data: community reports CSV</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="6178.25" y="4879.3193">- llm_calls: 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="272" x="6178.25" y="4894.6299">- prompt_tokens: context + prompt length</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="6178.25" y="4909.9404">- output_tokens: response length</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="126" x="6026.25" y="4849.6846"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="106" x="6036.25" y="4871.2861">Store SearchResult</text><line style="stroke:#000000;stroke-width:2.0;" x1="5917.75" x2="5917.75" y1="33.4961" y2="8129.9248"/><rect fill="#E6E6FA" height="8096.4287" style="stroke:#E6E6FA;stroke-width:1.0;" width="253" x="6618.25" y="33.4961"/><rect fill="#FFFFFF" filter="url(#fvkkzmuj9lo31)" height="1144.4063" style="stroke:#000000;stroke-width:2.0;" width="237" x="6624.25" y="3949.8955"/><path d="M6802.25,3949.8955 L6802.25,3959.3838 L6792.25,3969.3838 L6624.25,3969.3838 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="168" x="6627.25" y="3964.4307">MAP - Extract Key Points</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="133" x="6681.75" y="4322.8896"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="113" x="6691.75" y="4344.4912">Acquire semaphore</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="192" x="6652.25" y="4392.0225"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="172" x="6662.25" y="4413.624">Build MAP prompt for batch 2</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="163" x="6666.75" y="4461.1553"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="143" x="6676.75" y="4482.7568">Call LLM with JSON mode</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="202" x="6647.25" y="4530.2881"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="182" x="6657.25" y="4551.8896">Receive &amp; parse JSON response</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="134" x="6681.25" y="4598.5674"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="114" x="6691.25" y="4620.1689">Release semaphore</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="126" x="6685.25" y="4667.7002"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="106" x="6695.25" y="4689.3018">Store SearchResult</text><line style="stroke:#000000;stroke-width:2.0;" x1="6618.25" x2="6618.25" y1="33.4961" y2="8129.9248"/><rect fill="#E6E6FA" height="8096.4287" style="stroke:#E6E6FA;stroke-width:1.0;" width="253" x="6871.25" y="33.4961"/><rect fill="#FFFFFF" filter="url(#fvkkzmuj9lo31)" height="1144.4063" style="stroke:#000000;stroke-width:2.0;" width="237" x="6877.25" y="3949.8955"/><path d="M7055.25,3949.8955 L7055.25,3959.3838 L7045.25,3969.3838 L6877.25,3969.3838 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="168" x="6880.25" y="3964.4307">MAP - Extract Key Points</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="133" x="6934.75" y="4322.8896"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="113" x="6944.75" y="4344.4912">Acquire semaphore</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="192" x="6905.25" y="4392.0225"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="172" x="6915.25" y="4413.624">Build MAP prompt for batch 3</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="163" x="6919.75" y="4461.1553"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="143" x="6929.75" y="4482.7568">Call LLM with JSON mode</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="202" x="6900.25" y="4530.2881"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="182" x="6910.25" y="4551.8896">Receive &amp; parse JSON response</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="134" x="6934.25" y="4598.5674"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="114" x="6944.25" y="4620.1689">Release semaphore</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="126" x="6938.25" y="4667.7002"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="106" x="6948.25" y="4689.3018">Store SearchResult</text><line style="stroke:#000000;stroke-width:2.0;" x1="6871.25" x2="6871.25" y1="33.4961" y2="8129.9248"/><rect fill="#E6E6FA" height="8096.4287" style="stroke:#E6E6FA;stroke-width:1.0;" width="868.5" x="7124.25" y="33.4961"/><rect fill="#FFFFFF" filter="url(#fvkkzmuj9lo31)" height="1144.4063" style="stroke:#000000;stroke-width:2.0;" width="852.5" x="7130.25" y="3949.8955"/><path d="M7308.25,3949.8955 L7308.25,3959.3838 L7298.25,3969.3838 L7130.25,3969.3838 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="168" x="7133.25" y="3964.4307">MAP - Extract Key Points</text><path d="M7738.75,4461.8564 L7738.75,4508.7881 L7718.75,4512.7881 L7738.75,4516.7881 L7738.75,4563.7197 A0,0 0 0 0 7738.75,4563.7197 L7960.75,4563.7197 A0,0 0 0 0 7960.75,4563.7197 L7960.75,4471.8564 L7950.75,4461.8564 L7738.75,4461.8564 A0,0 0 0 0 7738.75,4461.8564 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M7950.75,4461.8564 L7950.75,4471.8564 L7960.75,4471.8564 L7950.75,4461.8564 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="7744.75" y="4479.4248">Number of batches depends on:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="7744.75" y="4494.7354">- Total community reports</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="7744.75" y="4510.0459">- Token limit per batch</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198" x="7744.75" y="4525.3564">- Community selection method</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="7748.75" y="4540.667"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="7744.75" y="4555.9775">Typical: 2-10 batches</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="125" x="7593.75" y="4495.7217"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="105" x="7603.75" y="4517.3232">... (one per batch)</text><rect fill="#000000" filter="url(#fvkkzmuj9lo31)" height="6" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="832.5" x="7140.25" y="4937.6826"/><path d="M7350.25,4960.4385 L7350.25,4976.749 L7330.25,4980.749 L7350.25,4984.749 L7350.25,5001.0596 A0,0 0 0 0 7350.25,5001.0596 L7560.25,5001.0596 A0,0 0 0 0 7560.25,5001.0596 L7560.25,4970.4385 L7550.25,4960.4385 L7350.25,4960.4385 A0,0 0 0 0 7350.25,4960.4385 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M7550.25,4960.4385 L7550.25,4970.4385 L7560.25,4970.4385 L7550.25,4960.4385 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="7356.25" y="4978.0068">List[SearchResult]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189" x="7356.25" y="4993.3174">Each with key points + scores</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="167" x="7163.25" y="4963.6826"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="147" x="7173.25" y="4985.2842">Collect all MAP responses</text><path d="M7332.75,5011.0596 L7332.75,5042.6807 L7312.75,5046.6807 L7332.75,5050.6807 L7332.75,5082.3018 A0,0 0 0 0 7332.75,5082.3018 L7583.75,5082.3018 A0,0 0 0 0 7583.75,5082.3018 L7583.75,5021.0596 L7573.75,5011.0596 L7332.75,5011.0596 A0,0 0 0 0 7332.75,5011.0596 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M7573.75,5011.0596 L7573.75,5021.0596 L7583.75,5021.0596 L7573.75,5011.0596 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="7338.75" y="5028.6279">Total MAP phase:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="7338.75" y="5043.9385">- llm_calls: N (one per batch)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219" x="7338.75" y="5059.249">- prompt_tokens: sum(all batches)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230" x="7338.75" y="5074.5596">- output_tokens: sum(all responses)</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="132" x="7180.75" y="5029.6143"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="112" x="7190.75" y="5051.2158">Aggregate statistics</text><line style="stroke:#000000;stroke-width:2.0;" x1="7124.25" x2="7124.25" y1="33.4961" y2="8129.9248"/><rect fill="#FAFAD2" height="8096.4287" style="stroke:#FAFAD2;stroke-width:1.0;" width="829.5" x="7992.75" y="33.4961"/><rect fill="#FFFFFF" filter="url(#fvkkzmuj9lo31)" height="2328.9043" style="stroke:#000000;stroke-width:2.0;" width="813.5" x="7998.75" y="5104.3018"/><path d="M8244.75,5104.3018 L8244.75,5113.79 L8234.75,5123.79 L7998.75,5123.79 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="236" x="8001.75" y="5118.8369">REDUCE - Synthesize Final Answer</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="261" x="8133.25" y="5140.79"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="241" x="8143.25" y="5162.3916">Collect all key points from MAP responses</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="155" x="8186.25" y="5238.9229"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="135" x="8196.25" y="5260.5244">For each MAP response</text><path d="M8342.25,5375.5332 L8342.25,5414.8096 L8322.25,5418.8096 L8342.25,5422.8096 L8342.25,5462.0859 A0,0 0 0 0 8342.25,5462.0859 L8535.25,5462.0859 A0,0 0 0 0 8535.25,5462.0859 L8535.25,5385.5332 L8525.25,5375.5332 L8342.25,5375.5332 A0,0 0 0 0 8342.25,5375.5332 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M8525.25,5375.5332 L8525.25,5385.5332 L8535.25,5385.5332 L8525.25,5375.5332 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="8348.25" y="5393.1016">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="8356.25" y="5408.4121">"analyst": batch_index,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="8356.25" y="5423.7227">"answer": description,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="8356.25" y="5439.0332">"score": importance_score</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="8348.25" y="5454.3438">}</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="117" x="8205.25" y="5401.7432"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="97" x="8215.25" y="5423.3447">Extract key point</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="144" x="8191.75" y="5483.376"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="124" x="8201.75" y="5504.9775">Add to key_points list</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="8263.75,5341.5332,8275.75,5353.5332,8263.75,5365.5332,8251.75,5353.5332,8263.75,5341.5332" style="stroke:#A80036;stroke-width:1.5;"/><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="8196.25,5537.5088,8331.25,5537.5088,8343.25,5549.5088,8331.25,5561.5088,8196.25,5561.5088,8184.25,5549.5088,8196.25,5537.5088" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="135" x="8196.25" y="5553.666">More points in response?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="8343.25" y="5547.1885">yes</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="8205.75,5293.0557,8321.75,5293.0557,8333.75,5305.0557,8321.75,5317.0557,8205.75,5317.0557,8193.75,5305.0557,8205.75,5293.0557" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="8267.75" y="5327.6904">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="116" x="8205.75" y="5309.2129">Response is valid list?</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="8263.75,5585.2842,8275.75,5597.2842,8263.75,5609.2842,8251.75,5597.2842,8263.75,5585.2842" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="8269.75" y="5582.9639">no</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="8263.75,5194.9229,8275.75,5206.9229,8263.75,5218.9229,8251.75,5206.9229,8263.75,5194.9229" style="stroke:#A80036;stroke-width:1.5;"/><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="8205.25,5629.2842,8322.25,5629.2842,8334.25,5641.2842,8322.25,5653.2842,8205.25,5653.2842,8193.25,5641.2842,8205.25,5629.2842" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="117" x="8205.25" y="5645.4414">More MAP responses?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="8334.25" y="5638.9639">yes</text><path d="M8371.25,5692.9375 L8371.25,5709.248 L8351.25,5713.248 L8371.25,5717.248 L8371.25,5733.5586 A0,0 0 0 0 8371.25,5733.5586 L8608.25,5733.5586 A0,0 0 0 0 8608.25,5733.5586 L8608.25,5702.9375 L8598.25,5692.9375 L8371.25,5692.9375 A0,0 0 0 0 8371.25,5692.9375 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M8598.25,5692.9375 L8598.25,5702.9375 L8608.25,5702.9375 L8598.25,5692.9375 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="8377.25" y="5710.5059">Remove irrelevant points</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="216" x="8377.25" y="5725.8164">(score = 0 means no relevant info)</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="175" x="8176.25" y="5696.1816"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="155" x="8186.25" y="5717.7832">Filter points with score &gt; 0</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="153" x="8187.25" y="5850.5137"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="133" x="8197.25" y="5872.1152">No relevant data found</text><path d="M8370.25,5901.4023 L8370.25,5917.7129 L8350.25,5921.7129 L8370.25,5925.7129 L8370.25,5942.0234 A0,0 0 0 0 8370.25,5942.0234 L8768.25,5942.0234 A0,0 0 0 0 8768.25,5942.0234 L8768.25,5911.4023 L8758.25,5901.4023 L8370.25,5901.4023 A0,0 0 0 0 8370.25,5901.4023 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M8758.25,5901.4023 L8758.25,5911.4023 L8768.25,5911.4023 L8758.25,5901.4023 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="8376.25" y="5918.9707">Canned response:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="377" x="8376.25" y="5934.2813">"I do not have enough information to answer this question."</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="173" x="8177.25" y="5904.6465"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="153" x="8187.25" y="5926.248">Return NO_DATA_ANSWER</text><ellipse cx="8263.75" cy="5973.0234" fill="#FFFFFF" filter="url(#fvkkzmuj9lo31)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="8263.75" cy="5973.0234" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="8173.25,5802.0361,8354.25,5802.0361,8366.25,5814.0361,8354.25,5826.0361,8173.25,5826.0361,8161.25,5814.0361,8173.25,5802.0361" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="8267.75" y="5836.6709">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="181" x="8173.25" y="5818.1934">allow_general_knowledge = false?</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="8195.25,5753.5586,8332.25,5753.5586,8344.25,5765.5586,8332.25,5777.5586,8195.25,5777.5586,8183.25,5765.5586,8195.25,5753.5586" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="8267.75" y="5788.1934">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="137" x="8195.25" y="5769.7158">No points with score &gt; 0?</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="8263.75,6026.0234,8275.75,6038.0234,8263.75,6050.0234,8251.75,6038.0234,8263.75,6026.0234" style="stroke:#A80036;stroke-width:1.5;"/><path d="M8389.75,6066.7793 L8389.75,6083.0898 L8369.75,6087.0898 L8389.75,6091.0898 L8389.75,6107.4004 A0,0 0 0 0 8389.75,6107.4004 L8604.75,6107.4004 A0,0 0 0 0 8604.75,6107.4004 L8604.75,6076.7793 L8594.75,6066.7793 L8389.75,6066.7793 A0,0 0 0 0 8389.75,6066.7793 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M8594.75,6066.7793 L8594.75,6076.7793 L8604.75,6076.7793 L8594.75,6066.7793 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="8395.75" y="6084.3477">Higher scored points first</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="8395.75" y="6099.6582">Prioritizes most important info</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="212" x="8157.75" y="6070.0234"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="192" x="8167.75" y="6091.625">Sort points by score (descending)</text><path d="M8409.25,6131.8115 L8409.25,6140.4668 L8389.25,6144.4668 L8409.25,6148.4668 L8409.25,6157.1221 A0,0 0 0 0 8409.25,6157.1221 L8688.25,6157.1221 A0,0 0 0 0 8688.25,6157.1221 L8688.25,6141.8115 L8678.25,6131.8115 L8409.25,6131.8115 A0,0 0 0 0 8409.25,6131.8115 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M8678.25,6131.8115 L8678.25,6141.8115 L8688.25,6141.8115 L8678.25,6131.8115 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="258" x="8415.25" y="6149.3799">Budget: data_max_tokens (default: 8000)</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="251" x="8138.25" y="6127.4004"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="231" x="8148.25" y="6149.002">Apply token budget for REDUCE context</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="139" x="8194.25" y="6225.5332"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="119" x="8204.25" y="6247.1348">Select next key point</text><path d="M8364.25,6269.666 L8364.25,6301.2871 L8344.25,6305.2871 L8364.25,6309.2871 L8364.25,6340.9082 A0,0 0 0 0 8364.25,6340.9082 L8544.25,6340.9082 A0,0 0 0 0 8544.25,6340.9082 L8544.25,6279.666 L8534.25,6269.666 L8364.25,6269.666 A0,0 0 0 0 8364.25,6269.666 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M8534.25,6269.666 L8534.25,6279.666 L8544.25,6279.666 L8534.25,6269.666 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="48" x="8370.25" y="6287.2344">Format:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="line-through" textLength="110" x="8370.25" y="6302.5449">--Analyst {index}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="16" x="8480.25" y="6302.5449">--</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="8370.25" y="6317.8555">Importance Score: {score}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="8370.25" y="6333.166">{answer}</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="161" x="8183.25" y="6288.2207"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="141" x="8193.25" y="6309.8223">Format as analyst report</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="203" x="8162.25" y="6360.9082"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="183" x="8172.25" y="6382.5098">Count tokens in formatted point</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="8123.25,6421.4199,8404.25,6421.4199,8416.25,6433.4199,8404.25,6445.4199,8123.25,6445.4199,8111.25,6433.4199,8123.25,6421.4199" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="281" x="8123.25" y="6437.5771">current_tokens + point_tokens ≤ data_max_tokens?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="8093.25" y="6431.0996">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="8416.25" y="6431.0996">no</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="156" x="8023.25" y="6455.4199"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="136" x="8033.25" y="6477.0215">Add to REDUCE context</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="151" x="8025.75" y="6509.5527"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="131" x="8035.75" y="6531.1543">Update current_tokens</text><path d="M8510.25,6459.8311 L8510.25,6468.4863 L8490.25,6472.4863 L8510.25,6476.4863 L8510.25,6485.1416 A0,0 0 0 0 8510.25,6485.1416 L8681.25,6485.1416 A0,0 0 0 0 8681.25,6485.1416 L8681.25,6469.8311 L8671.25,6459.8311 L8510.25,6459.8311 A0,0 0 0 0 8510.25,6459.8311 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M8671.25,6459.8311 L8671.25,6469.8311 L8681.25,6469.8311 L8671.25,6459.8311 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="8516.25" y="6477.3994">Token budget exceeded</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="128" x="8362.25" y="6455.4199"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="108" x="8372.25" y="6477.0215">Stop adding points</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="8263.75,6549.6855,8275.75,6561.6855,8263.75,6573.6855,8251.75,6561.6855,8263.75,6549.6855" style="stroke:#A80036;stroke-width:1.5;"/><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="8263.75,6181.5332,8275.75,6193.5332,8263.75,6205.5332,8251.75,6193.5332,8263.75,6181.5332" style="stroke:#A80036;stroke-width:1.5;"/><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="8177.75,6593.6855,8349.75,6593.6855,8361.75,6605.6855,8349.75,6617.6855,8177.75,6617.6855,8165.75,6605.6855,8177.75,6593.6855" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="172" x="8177.75" y="6609.8428">More points AND within budget?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="8361.75" y="6603.3652">yes</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="276" x="8125.75" y="6658.9609"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="256" x="8135.75" y="6680.5625">Combine all selected points into report_data</text><path d="M8356.75,6703.0938 L8356.75,6750.0254 L8336.75,6754.0254 L8356.75,6758.0254 L8356.75,6804.957 A0,0 0 0 0 8356.75,6804.957 L8688.75,6804.957 A0,0 0 0 0 8688.75,6804.957 L8688.75,6713.0938 L8678.75,6703.0938 L8356.75,6703.0938 A0,0 0 0 0 8356.75,6703.0938 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M8678.75,6703.0938 L8678.75,6713.0938 L8688.75,6713.0938 L8678.75,6703.0938 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="8362.75" y="6720.6621">REDUCE_SYSTEM_PROMPT format:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="306" x="8362.75" y="6735.9727">- System: Prompt + report_data (analyst reports)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="8362.75" y="6751.2832">- Parameters:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="280" x="8370.75" y="6766.5938">- response_type (e.g., "Multiple Paragraphs")</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="8370.75" y="6781.9043">- max_length (2000 words)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="311" x="8362.75" y="6797.2148">- Optional: GENERAL_KNOWLEDGE_INSTRUCTION</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="146" x="8190.75" y="6736.959"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="126" x="8200.75" y="6758.5605">Build REDUCE prompt</text><path d="M8404.75,6873.4346 L8404.75,6889.7451 L8384.75,6893.7451 L8404.75,6897.7451 L8404.75,6914.0557 A0,0 0 0 0 8404.75,6914.0557 L8666.75,6914.0557 A0,0 0 0 0 8666.75,6914.0557 L8666.75,6883.4346 L8656.75,6873.4346 L8404.75,6873.4346 A0,0 0 0 0 8404.75,6873.4346 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M8656.75,6873.4346 L8656.75,6883.4346 L8666.75,6883.4346 L8656.75,6873.4346 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241" x="8410.75" y="6891.0029">Allows LLM to use external knowledge</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209" x="8410.75" y="6906.3135">Risk: May increase hallucinations</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="242" x="8142.75" y="6876.6787"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="222" x="8152.75" y="6898.2803">Append general knowledge instruction</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="8174.75,6824.957,8352.75,6824.957,8364.75,6836.957,8352.75,6848.957,8174.75,6848.957,8162.75,6836.957,8174.75,6824.957" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="8267.75" y="6859.5918">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="178" x="8174.75" y="6841.1143">allow_general_knowledge = true?</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="8263.75,6934.0557,8275.75,6946.0557,8263.75,6958.0557,8251.75,6946.0557,8263.75,6934.0557" style="stroke:#A80036;stroke-width:1.5;"/><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="171" x="8178.25" y="6978.0557"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="151" x="8188.25" y="6999.6572">Call LLM for final synthesis</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="8211.75,7032.1885,8315.75,7032.1885,8327.75,7044.1885,8315.75,7056.1885,8211.75,7056.1885,8199.75,7044.1885,8211.75,7032.1885" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="8211.75" y="7048.3457">Streaming enabled?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="8181.75" y="7041.8682">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="8327.75" y="7041.8682">no</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="138" x="8022.25" y="7120.3213"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="118" x="8032.25" y="7141.9229">Receive token chunk</text><path d="M8171.25,7171.21 L8171.25,7187.5205 L8151.25,7191.5205 L8171.25,7195.5205 L8171.25,7211.8311 A0,0 0 0 0 8171.25,7211.8311 L8303.25,7211.8311 A0,0 0 0 0 8303.25,7211.8311 L8303.25,7181.21 L8293.25,7171.21 L8171.25,7171.21 A0,0 0 0 0 8171.25,7171.21 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M8293.25,7171.21 L8293.25,7181.21 L8303.25,7181.21 L8293.25,7171.21 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="8177.25" y="7188.7783">Real-time display</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68" x="8177.25" y="7204.0889">in terminal</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="120" x="8031.25" y="7174.4541"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="100" x="8041.25" y="7196.0557">Yield token to CLI</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="161" x="8010.75" y="7231.8311"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="141" x="8020.75" y="7253.4326">Append to full_response</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="8091.25,7066.1885,8103.25,7078.1885,8091.25,7090.1885,8079.25,7078.1885,8091.25,7066.1885" style="stroke:#A80036;stroke-width:1.5;"/><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="8055.75,7285.9639,8126.75,7285.9639,8138.75,7297.9639,8126.75,7309.9639,8055.75,7309.9639,8043.75,7297.9639,8055.75,7285.9639" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="71" x="8055.75" y="7302.1211">More tokens?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="8138.75" y="7295.6436">yes</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="178" x="8347.25" y="7066.1885"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="158" x="8357.25" y="7087.79">Receive complete response</text><polygon fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" points="8263.75,7315.9639,8275.75,7327.9639,8263.75,7339.9639,8251.75,7327.9639,8263.75,7315.9639" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="8237.75" y="7325.6436">no</text><path d="M8365.25,7349.9639 L8365.25,7381.585 L8345.25,7385.585 L8365.25,7389.585 L8365.25,7421.2061 A0,0 0 0 0 8365.25,7421.2061 L8646.25,7421.2061 A0,0 0 0 0 8646.25,7421.2061 L8646.25,7359.9639 L8636.25,7349.9639 L8365.25,7349.9639 A0,0 0 0 0 8365.25,7349.9639 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M8636.25,7349.9639 L8636.25,7359.9639 L8646.25,7359.9639 L8636.25,7349.9639 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="8371.25" y="7367.5322">- llm_calls: 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="260" x="8371.25" y="7382.8428">- prompt_tokens: REDUCE prompt length</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232" x="8371.25" y="7398.1533">- output_tokens: final answer length</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179" x="8371.25" y="7413.4639">- completion_time: duration</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="163" x="8182.25" y="7368.5186"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="143" x="8192.25" y="7390.1201">Track REDUCE metadata</text><line style="stroke:#000000;stroke-width:2.0;" x1="7992.75" x2="7992.75" y1="33.4961" y2="8129.9248"/><rect fill="#98FB98" height="8096.4287" style="stroke:#98FB98;stroke-width:1.0;" width="720.5" x="8822.25" y="33.4961"/><rect fill="#FFFFFF" filter="url(#fvkkzmuj9lo31)" height="319.9688" style="stroke:#000000;stroke-width:2.0;" width="704.5" x="8828.25" y="7443.2061"/><path d="M9019.25,7443.2061 L9019.25,7452.6943 L9009.25,7462.6943 L8828.25,7462.6943 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="181" x="8831.25" y="7457.7412">Create GlobalSearchResult</text><path d="M9093.75,7472.6943 L9093.75,7580.8682 L9073.75,7584.8682 L9093.75,7588.8682 L9093.75,7697.042 A0,0 0 0 0 9093.75,7697.042 L9522.75,7697.042 A0,0 0 0 0 9522.75,7697.042 L9522.75,7482.6943 L9512.75,7472.6943 L9093.75,7472.6943 A0,0 0 0 0 9093.75,7472.6943 " fill="#FBFB77" filter="url(#fvkkzmuj9lo31)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M9512.75,7472.6943 L9512.75,7482.6943 L9522.75,7482.6943 L9512.75,7472.6943 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182" x="9099.75" y="7490.2627">GlobalSearchResult contains:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="283" x="9099.75" y="7505.5732">- response: Final synthesized answer (string)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="258" x="9099.75" y="7520.8838">- context_data: Community reports used</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="291" x="9099.75" y="7536.1943">- context_text: Formatted community context</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="294" x="9099.75" y="7551.5049">- map_responses: List[SearchResult] from MAP</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="9099.75" y="7566.8154">- reduce_context_data: Analyst reports</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="311" x="9099.75" y="7582.126">- reduce_context_text: Formatted reduce context</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="253" x="9099.75" y="7597.4365">- completion_time: total duration (float)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="318" x="9099.75" y="7612.7471">- llm_calls: build_context + MAP (N) + REDUCE (1)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="9099.75" y="7628.0576">- prompt_tokens: sum(all phases)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="9099.75" y="7643.3682">- output_tokens: sum(all phases)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="408" x="9099.75" y="7658.6787">- llm_calls_categories: {"build_context": X, "map": N, "reduce": 1}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="326" x="9099.75" y="7673.9893">- prompt_tokens_categories: per-phase breakdown</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="322" x="9099.75" y="7689.2998">- output_tokens_categories: per-phase breakdown</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="230" x="8843.75" y="7567.8018"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="210" x="8853.75" y="7589.4033">Assemble GlobalSearchResult object</text><rect fill="#FEFECE" filter="url(#fvkkzmuj9lo31)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="241" x="8838.25" y="7717.042"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="221" x="8848.25" y="7738.6436">Return GlobalSearchResult to API layer</text><line style="stroke:#000000;stroke-width:2.0;" x1="8822.25" x2="8822.25" y1="33.4961" y2="8129.9248"/><line style="stroke:#000000;stroke-width:2.0;" x1="9542.75" x2="9542.75" y1="33.4961" y2="8129.9248"/><line style="stroke:#A80036;stroke-width:1.5;" x1="272.5" x2="272.5" y1="79.6953" y2="99.6953"/><polygon fill="#A80036" points="268.5,89.6953,272.5,99.6953,276.5,89.6953,272.5,93.6953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="272.5" x2="272.5" y1="147.7969" y2="199.3174"/><polygon fill="#A80036" points="268.5,189.3174,272.5,199.3174,276.5,189.3174,272.5,193.3174" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="272.5" x2="272.5" y1="233.4502" y2="294.9707"/><polygon fill="#A80036" points="268.5,284.9707,272.5,294.9707,276.5,284.9707,272.5,288.9707" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="224.5" x2="78.5" y1="7849.3076" y2="7849.3076"/><line style="stroke:#A80036;stroke-width:1.5;" x1="78.5" x2="78.5" y1="7849.3076" y2="7920.4834"/><polygon fill="#A80036" points="74.5,7910.4834,78.5,7920.4834,82.5,7910.4834,78.5,7914.4834" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="320.5" x2="466.5" y1="7849.3076" y2="7849.3076"/><line style="stroke:#A80036;stroke-width:1.5;" x1="466.5" x2="466.5" y1="7849.3076" y2="7871.3076"/><polygon fill="#A80036" points="462.5,7861.3076,466.5,7871.3076,470.5,7861.3076,466.5,7865.3076" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="78.5" x2="78.5" y1="7954.6162" y2="8021.792"/><line style="stroke:#A80036;stroke-width:1.5;" x1="78.5" x2="260.5" y1="8021.792" y2="8021.792"/><polygon fill="#A80036" points="250.5,8017.792,260.5,8021.792,250.5,8025.792,254.5,8021.792" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="466.5" x2="466.5" y1="7905.4404" y2="8021.792"/><line style="stroke:#A80036;stroke-width:1.5;" x1="466.5" x2="284.5" y1="8021.792" y2="8021.792"/><polygon fill="#A80036" points="294.5,8017.792,284.5,8021.792,294.5,8025.792,290.5,8021.792" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="272.5" x2="272.5" y1="7817.3076" y2="7837.3076"/><polygon fill="#A80036" points="268.5,7827.3076,272.5,7837.3076,276.5,7827.3076,272.5,7831.3076" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="272.5" x2="272.5" y1="8033.792" y2="8053.792"/><polygon fill="#A80036" points="268.5,8043.792,272.5,8053.792,276.5,8043.792,272.5,8047.792" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="272.5" x2="272.5" y1="8087.9248" y2="8107.9248"/><polygon fill="#A80036" points="268.5,8097.9248,272.5,8107.9248,276.5,8097.9248,272.5,8101.9248" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="714.5" x2="714.5" y1="423.3691" y2="443.3691"/><polygon fill="#A80036" points="710.5,433.3691,714.5,443.3691,718.5,433.3691,714.5,437.3691" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="929.5" x2="929.5" y1="423.3691" y2="450.4355"/><polygon fill="#A80036" points="925.5,440.4355,929.5,450.4355,933.5,440.4355,929.5,444.4355" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1150.5" x2="1150.5" y1="423.3691" y2="450.4355"/><polygon fill="#A80036" points="1146.5,440.4355,1150.5,450.4355,1154.5,440.4355,1150.5,444.4355" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="714.5" x2="714.5" y1="491.6348" y2="511.6348"/><polygon fill="#A80036" points="710.5,501.6348,714.5,511.6348,718.5,501.6348,714.5,505.6348" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="929.5" x2="929.5" y1="484.5684" y2="511.6348"/><polygon fill="#A80036" points="925.5,501.6348,929.5,511.6348,933.5,501.6348,929.5,505.6348" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1150.5" x2="1150.5" y1="484.5684" y2="511.6348"/><polygon fill="#A80036" points="1146.5,501.6348,1150.5,511.6348,1154.5,501.6348,1150.5,505.6348" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="935.5" x2="935.5" y1="397.3691" y2="417.3691"/><polygon fill="#A80036" points="931.5,407.3691,935.5,417.3691,939.5,407.3691,935.5,411.3691" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="935.5" x2="935.5" y1="517.6348" y2="537.6348"/><polygon fill="#A80036" points="931.5,527.6348,935.5,537.6348,939.5,527.6348,935.5,531.6348" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="850" x2="828.25" y1="617.9004" y2="617.9004"/><line style="stroke:#A80036;stroke-width:1.5;" x1="828.25" x2="828.25" y1="617.9004" y2="639.9004"/><polygon fill="#A80036" points="824.25,629.9004,828.25,639.9004,832.25,629.9004,828.25,633.9004" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1021" x2="1042.75" y1="617.9004" y2="617.9004"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1042.75" x2="1042.75" y1="617.9004" y2="639.9004"/><polygon fill="#A80036" points="1038.75,629.9004,1042.75,639.9004,1046.75,629.9004,1042.75,633.9004" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="828.25" x2="828.25" y1="674.0332" y2="692.0332"/><line style="stroke:#A80036;stroke-width:1.5;" x1="828.25" x2="923.5" y1="692.0332" y2="692.0332"/><polygon fill="#A80036" points="913.5,688.0332,923.5,692.0332,913.5,696.0332,917.5,692.0332" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1042.75" x2="1042.75" y1="674.0332" y2="692.0332"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1042.75" x2="947.5" y1="692.0332" y2="692.0332"/><polygon fill="#A80036" points="957.5,688.0332,947.5,692.0332,957.5,696.0332,953.5,692.0332" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="935.5" x2="935.5" y1="585.9004" y2="605.9004"/><polygon fill="#A80036" points="931.5,595.9004,935.5,605.9004,939.5,595.9004,935.5,599.9004" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1420.5" x2="1420.5" y1="852.9199" y2="873.8193"/><polygon fill="#A80036" points="1416.5,863.8193,1420.5,873.8193,1424.5,863.8193,1420.5,867.8193" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1420.5" x2="1420.5" y1="907.9521" y2="962.7168"/><polygon fill="#A80036" points="1416.5,952.7168,1420.5,962.7168,1424.5,952.7168,1420.5,956.7168" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1420.5" x2="1420.5" y1="996.8496" y2="1066.9248"/><polygon fill="#A80036" points="1416.5,1056.9248,1420.5,1066.9248,1424.5,1056.9248,1420.5,1060.9248" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1420.5" x2="1420.5" y1="758.166" y2="804.6543"/><polygon fill="#A80036" points="1416.5,794.6543,1420.5,804.6543,1424.5,794.6543,1420.5,798.6543" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2081.25" x2="1939" y1="1225.4004" y2="1225.4004"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1939" x2="1939" y1="1225.4004" y2="1250.6445"/><polygon fill="#A80036" points="1935,1240.6445,1939,1250.6445,1943,1240.6445,1939,1244.6445" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2258.25" x2="2390.5" y1="1225.4004" y2="1225.4004"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2390.5" x2="2390.5" y1="1225.4004" y2="1247.4004"/><polygon fill="#A80036" points="2386.5,1237.4004,2390.5,1247.4004,2394.5,1237.4004,2390.5,1241.4004" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1939" x2="1939" y1="1284.7773" y2="1306.0215"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1939" x2="2157.75" y1="1306.0215" y2="1306.0215"/><polygon fill="#A80036" points="2147.75,1302.0215,2157.75,1306.0215,2147.75,1310.0215,2151.75,1306.0215" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2390.5" x2="2390.5" y1="1281.5332" y2="1306.0215"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2390.5" x2="2181.75" y1="1306.0215" y2="1306.0215"/><polygon fill="#A80036" points="2191.75,1302.0215,2181.75,1306.0215,2191.75,1310.0215,2187.75,1306.0215" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2169.75" x2="2169.75" y1="1193.4004" y2="1213.4004"/><polygon fill="#A80036" points="2165.75,1203.4004,2169.75,1213.4004,2173.75,1203.4004,2169.75,1207.4004" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3205" x2="3205" y1="1473.2637" y2="1535.0195"/><polygon fill="#A80036" points="3201,1525.0195,3205,1535.0195,3209,1525.0195,3205,1529.0195" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2871.5" x2="2871.5" y1="1720.3945" y2="1740.3945"/><polygon fill="#A80036" points="2867.5,1730.3945,2871.5,1740.3945,2875.5,1730.3945,2871.5,1734.3945" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3089" x2="3089" y1="1720.3945" y2="1740.3945"/><polygon fill="#A80036" points="3085,1730.3945,3089,1740.3945,3093,1730.3945,3089,1734.3945" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3324.5" x2="3324.5" y1="1720.3945" y2="1740.3945"/><polygon fill="#A80036" points="3320.5,1730.3945,3324.5,1740.3945,3328.5,1730.3945,3324.5,1734.3945" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3558.5" x2="3558.5" y1="1720.3945" y2="1740.3945"/><polygon fill="#A80036" points="3554.5,1730.3945,3558.5,1740.3945,3562.5,1730.3945,3558.5,1734.3945" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2871.5" x2="2871.5" y1="1774.5273" y2="1794.5273"/><polygon fill="#A80036" points="2867.5,1784.5273,2871.5,1794.5273,2875.5,1784.5273,2871.5,1788.5273" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3089" x2="3089" y1="1774.5273" y2="1794.5273"/><polygon fill="#A80036" points="3085,1784.5273,3089,1794.5273,3093,1784.5273,3089,1788.5273" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3324.5" x2="3324.5" y1="1774.5273" y2="1794.5273"/><polygon fill="#A80036" points="3320.5,1784.5273,3324.5,1794.5273,3328.5,1784.5273,3324.5,1788.5273" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3558.5" x2="3558.5" y1="1774.5273" y2="1794.5273"/><polygon fill="#A80036" points="3554.5,1784.5273,3558.5,1794.5273,3562.5,1784.5273,3558.5,1788.5273" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3205" x2="3205" y1="1675.8398" y2="1714.3945"/><polygon fill="#A80036" points="3201,1704.3945,3205,1714.3945,3209,1704.3945,3205,1708.3945" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3205" x2="3205" y1="1800.5273" y2="1829.082"/><polygon fill="#A80036" points="3201,1819.082,3205,1829.082,3209,1819.082,3205,1823.082" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3104" x2="3104" y1="2112.0352" y2="2136.5127"/><polygon fill="#A80036" points="3100,2126.5127,3104,2136.5127,3108,2126.5127,3104,2130.5127" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3152" x2="3203" y1="2100.0352" y2="2100.0352"/><polygon fill="#A80036" points="3199,2143.5791,3203,2153.5791,3207,2143.5791,3203,2147.5791" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3203" x2="3203" y1="2100.0352" y2="2207.123"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3203" x2="3116" y1="2207.123" y2="2207.123"/><polygon fill="#A80036" points="3126,2203.123,3116,2207.123,3126,2211.123,3122,2207.123" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3104" x2="3104" y1="2170.6455" y2="2195.123"/><polygon fill="#A80036" points="3100,2185.123,3104,2195.123,3108,2185.123,3104,2189.123" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3104" x2="3104" y1="2068.0352" y2="2088.0352"/><polygon fill="#A80036" points="3100,2078.0352,3104,2088.0352,3108,2078.0352,3104,2082.0352" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3104" x2="3104" y1="2263.123" y2="2287.6006"/><polygon fill="#A80036" points="3100,2277.6006,3104,2287.6006,3108,2277.6006,3104,2281.6006" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3171.5" x2="3219" y1="2251.123" y2="2251.123"/><polygon fill="#A80036" points="3215,2294.667,3219,2304.667,3223,2294.667,3219,2298.667" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3219" x2="3219" y1="2251.123" y2="2353.7334"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3219" x2="3116" y1="2353.7334" y2="2353.7334"/><polygon fill="#A80036" points="3126,2349.7334,3116,2353.7334,3126,2357.7334,3122,2353.7334" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3104" x2="3104" y1="2321.7334" y2="2341.7334"/><polygon fill="#A80036" points="3100,2331.7334,3104,2341.7334,3108,2331.7334,3104,2335.7334" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3104" x2="3104" y1="2219.123" y2="2239.123"/><polygon fill="#A80036" points="3100,2229.123,3104,2239.123,3108,2229.123,3104,2233.123" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3140" x2="3104" y1="2011.9023" y2="2011.9023"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3104" x2="3104" y1="2011.9023" y2="2033.9023"/><polygon fill="#A80036" points="3100,2023.9023,3104,2033.9023,3108,2023.9023,3104,2027.9023" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3270" x2="3306" y1="2011.9023" y2="2011.9023"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3306" x2="3306" y1="2011.9023" y2="2033.9023"/><polygon fill="#A80036" points="3302,2023.9023,3306,2033.9023,3310,2023.9023,3306,2027.9023" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3104" x2="3104" y1="2365.7334" y2="2383.7334"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3104" x2="3193" y1="2383.7334" y2="2383.7334"/><polygon fill="#A80036" points="3183,2379.7334,3193,2383.7334,3183,2387.7334,3187,2383.7334" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3306" x2="3306" y1="2068.0352" y2="2383.7334"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3306" x2="3217" y1="2383.7334" y2="2383.7334"/><polygon fill="#A80036" points="3227,2379.7334,3217,2383.7334,3227,2387.7334,3223,2383.7334" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3205" x2="3205" y1="1979.9023" y2="1999.9023"/><polygon fill="#A80036" points="3201,1989.9023,3205,1999.9023,3209,1989.9023,3205,1993.9023" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3205" x2="3205" y1="1925.7695" y2="1945.7695"/><polygon fill="#A80036" points="3201,1935.7695,3205,1945.7695,3209,1935.7695,3205,1939.7695" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3284.5" x2="3383" y1="2427.7334" y2="2427.7334"/><polygon fill="#A80036" points="3379,2175.4902,3383,2165.4902,3387,2175.4902,3383,2171.4902" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3383" x2="3383" y1="1913.7695" y2="2427.7334"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3383" x2="3217" y1="1913.7695" y2="1913.7695"/><polygon fill="#A80036" points="3227,1909.7695,3217,1913.7695,3227,1917.7695,3223,1913.7695" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3205" x2="3205" y1="2395.7334" y2="2415.7334"/><polygon fill="#A80036" points="3201,2405.7334,3205,2415.7334,3209,2405.7334,3205,2409.7334" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3205" x2="3205" y1="1863.2148" y2="1901.7695"/><polygon fill="#A80036" points="3201,1891.7695,3205,1901.7695,3209,1891.7695,3205,1895.7695" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3205" x2="3205" y1="2505.0088" y2="2532.7305"/><polygon fill="#A80036" points="3201,2522.7305,3205,2532.7305,3209,2522.7305,3205,2526.7305" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3317.5" x2="3552.5" y1="2493.0088" y2="2493.0088"/><polygon fill="#A80036" points="3548.5,2539.7969,3552.5,2549.7969,3556.5,2539.7969,3552.5,2543.7969" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3552.5" x2="3552.5" y1="2493.0088" y2="2602.1074"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3552.5" x2="3217" y1="2602.1074" y2="2602.1074"/><polygon fill="#A80036" points="3227,2598.1074,3217,2602.1074,3227,2606.1074,3223,2602.1074" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3205" x2="3205" y1="2566.8633" y2="2590.1074"/><polygon fill="#A80036" points="3201,2580.1074,3205,2590.1074,3209,2580.1074,3205,2584.1074" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3205" x2="3205" y1="2439.7334" y2="2481.0088"/><polygon fill="#A80036" points="3201,2471.0088,3205,2481.0088,3209,2471.0088,3205,2475.0088" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="3209" y="2461.1885">no</text><line style="stroke:#A80036;stroke-width:1.5;" x1="3205" x2="3205" y1="1613.1523" y2="1641.707"/><polygon fill="#A80036" points="3201,1631.707,3205,1641.707,3209,1631.707,3205,1635.707" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3284" x2="3728" y1="2646.1074" y2="2646.1074"/><polygon fill="#A80036" points="3724,2101.4473,3728,2091.4473,3732,2101.4473,3728,2097.4473" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3728" x2="3728" y1="1601.1523" y2="2646.1074"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3728" x2="3217" y1="1601.1523" y2="1601.1523"/><polygon fill="#A80036" points="3227,1597.1523,3217,1601.1523,3227,1605.1523,3223,1601.1523" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3205" x2="3205" y1="2614.1074" y2="2634.1074"/><polygon fill="#A80036" points="3201,2624.1074,3205,2634.1074,3209,2624.1074,3205,2628.1074" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3205" x2="3205" y1="1569.1523" y2="1589.1523"/><polygon fill="#A80036" points="3201,1579.1523,3205,1589.1523,3209,1579.1523,3205,1583.1523" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3205" x2="3205" y1="2658.1074" y2="2699.3828"/><polygon fill="#A80036" points="3201,2689.3828,3205,2699.3828,3209,2689.3828,3205,2693.3828" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="3209" y="2679.5625">no</text><line style="stroke:#A80036;stroke-width:1.5;" x1="4225.25" x2="4225.25" y1="1442.6426" y2="1480.8867"/><polygon fill="#A80036" points="4221.25,1470.8867,4225.25,1480.8867,4229.25,1470.8867,4225.25,1474.8867" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4830.75" x2="4830.75" y1="3006.9336" y2="3031.4111"/><polygon fill="#A80036" points="4826.75,3021.4111,4830.75,3031.4111,4834.75,3021.4111,4830.75,3025.4111" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4896.75" x2="5209.75" y1="2994.9336" y2="2994.9336"/><polygon fill="#A80036" points="5205.75,3038.4775,5209.75,3048.4775,5213.75,3038.4775,5209.75,3042.4775" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5209.75" x2="5209.75" y1="2994.9336" y2="3097.5439"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5209.75" x2="4842.75" y1="3097.5439" y2="3097.5439"/><polygon fill="#A80036" points="4852.75,3093.5439,4842.75,3097.5439,4852.75,3101.5439,4848.75,3097.5439" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4830.75" x2="4830.75" y1="3065.5439" y2="3085.5439"/><polygon fill="#A80036" points="4826.75,3075.5439,4830.75,3085.5439,4834.75,3075.5439,4830.75,3079.5439" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4830.75" x2="4830.75" y1="2936.7236" y2="2982.9336"/><polygon fill="#A80036" points="4826.75,2972.9336,4830.75,2982.9336,4834.75,2972.9336,4830.75,2976.9336" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4830.75" x2="4830.75" y1="3109.5439" y2="3130.4434"/><polygon fill="#A80036" points="4826.75,3120.4434,4830.75,3130.4434,4834.75,3120.4434,4830.75,3124.4434" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4830.75" x2="4830.75" y1="3273.6084" y2="3348.0947"/><polygon fill="#A80036" points="4826.75,3338.0947,4830.75,3348.0947,4834.75,3338.0947,4830.75,3342.0947" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4830.75" x2="4830.75" y1="3382.2275" y2="3466.7139"/><polygon fill="#A80036" points="4826.75,3456.7139,4830.75,3466.7139,4834.75,3456.7139,4830.75,3460.7139" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4656.25" x2="4656.25" y1="3588.9795" y2="3608.9795"/><polygon fill="#A80036" points="4652.25,3598.9795,4656.25,3608.9795,4660.25,3598.9795,4656.25,3602.9795" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4656.25" x2="4656.25" y1="3643.1123" y2="3663.1123"/><polygon fill="#A80036" points="4652.25,3653.1123,4656.25,3663.1123,4660.25,3653.1123,4656.25,3657.1123" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5005.25" x2="5005.25" y1="3588.9795" y2="3608.9795"/><polygon fill="#A80036" points="5001.25,3598.9795,5005.25,3608.9795,5009.25,3598.9795,5005.25,3602.9795" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4666.25" x2="4656.25" y1="3532.8467" y2="3532.8467"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4656.25" x2="4656.25" y1="3532.8467" y2="3554.8467"/><polygon fill="#A80036" points="4652.25,3544.8467,4656.25,3554.8467,4660.25,3544.8467,4656.25,3548.8467" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4995.25" x2="5005.25" y1="3532.8467" y2="3532.8467"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5005.25" x2="5005.25" y1="3532.8467" y2="3554.8467"/><polygon fill="#A80036" points="5001.25,3544.8467,5005.25,3554.8467,5009.25,3544.8467,5005.25,3548.8467" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4656.25" x2="4656.25" y1="3697.2451" y2="3715.2451"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4656.25" x2="4818.75" y1="3715.2451" y2="3715.2451"/><polygon fill="#A80036" points="4808.75,3711.2451,4818.75,3715.2451,4808.75,3719.2451,4812.75,3715.2451" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5005.25" x2="5005.25" y1="3643.1123" y2="3715.2451"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5005.25" x2="4842.75" y1="3715.2451" y2="3715.2451"/><polygon fill="#A80036" points="4852.75,3711.2451,4842.75,3715.2451,4852.75,3719.2451,4848.75,3715.2451" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4830.75" x2="4830.75" y1="3500.8467" y2="3520.8467"/><polygon fill="#A80036" points="4826.75,3510.8467,4830.75,3520.8467,4834.75,3510.8467,4830.75,3514.8467" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4830.75" x2="4830.75" y1="3219.4756" y2="3239.4756"/><polygon fill="#A80036" points="4826.75,3229.4756,4830.75,3239.4756,4834.75,3229.4756,4830.75,3233.4756" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4880.25" x2="5261.75" y1="3759.2451" y2="3759.2451"/><polygon fill="#A80036" points="5257.75,3495.8604,5261.75,3485.8604,5265.75,3495.8604,5261.75,3491.8604" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5261.75" x2="5261.75" y1="3207.4756" y2="3759.2451"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5261.75" x2="4842.75" y1="3207.4756" y2="3207.4756"/><polygon fill="#A80036" points="4852.75,3203.4756,4842.75,3207.4756,4852.75,3211.4756,4848.75,3207.4756" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4830.75" x2="4830.75" y1="3727.2451" y2="3747.2451"/><polygon fill="#A80036" points="4826.75,3737.2451,4830.75,3747.2451,4834.75,3737.2451,4830.75,3741.2451" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4830.75" x2="4830.75" y1="3164.5762" y2="3195.4756"/><polygon fill="#A80036" points="4826.75,3185.4756,4830.75,3195.4756,4834.75,3185.4756,4830.75,3189.4756" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4830.75" x2="4830.75" y1="3771.2451" y2="3812.5205"/><polygon fill="#A80036" points="4826.75,3802.5205,4830.75,3812.5205,4834.75,3802.5205,4830.75,3806.5205" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="4834.75" y="3792.7002">no</text><line style="stroke:#A80036;stroke-width:1.5;" x1="4830.75" x2="4830.75" y1="3846.6533" y2="3875.208"/><polygon fill="#A80036" points="4826.75,3865.208,4830.75,3875.208,4834.75,3865.208,4830.75,3869.208" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5482.75" x2="5482.75" y1="4023.5166" y2="4046.7607"/><polygon fill="#A80036" points="5478.75,4036.7607,5482.75,4046.7607,5486.75,4036.7607,5482.75,4040.7607" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5482.75" x2="5482.75" y1="4080.8936" y2="4104.1377"/><polygon fill="#A80036" points="5478.75,4094.1377,5482.75,4104.1377,5486.75,4094.1377,5482.75,4098.1377" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6089.25" x2="6089.25" y1="4164.2705" y2="4192.8252"/><polygon fill="#A80036" points="6085.25,4182.8252,6089.25,4192.8252,6093.25,4182.8252,6089.25,4186.8252" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6089.25" x2="6089.25" y1="4226.958" y2="4265.5127"/><polygon fill="#A80036" points="6085.25,4255.5127,6089.25,4265.5127,6093.25,4255.5127,6089.25,4259.5127" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6089.25" x2="6089.25" y1="4299.6455" y2="4382.5225"/><polygon fill="#A80036" points="6085.25,4372.5225,6089.25,4382.5225,6093.25,4372.5225,6089.25,4376.5225" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6089.25" x2="6089.25" y1="4416.6553" y2="4516.1416"/><polygon fill="#A80036" points="6085.25,4506.1416,6089.25,4516.1416,6093.25,4506.1416,6089.25,4510.1416" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6176.25" x2="6176.25" y1="4652.5537" y2="4687.5537"/><polygon fill="#A80036" points="6172.25,4677.5537,6176.25,4687.5537,6180.25,4677.5537,6176.25,4681.5537" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6030.25" x2="6002.25" y1="4596.4209" y2="4596.4209"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6002.25" x2="6002.25" y1="4596.4209" y2="4618.4209"/><polygon fill="#A80036" points="5998.25,4608.4209,6002.25,4618.4209,6006.25,4608.4209,6002.25,4612.4209" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6148.25" x2="6176.25" y1="4596.4209" y2="4596.4209"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6176.25" x2="6176.25" y1="4596.4209" y2="4618.4209"/><polygon fill="#A80036" points="6172.25,4608.4209,6176.25,4618.4209,6180.25,4608.4209,6176.25,4612.4209" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6002.25" x2="6002.25" y1="4652.5537" y2="4739.6865"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6002.25" x2="6077.25" y1="4739.6865" y2="4739.6865"/><polygon fill="#A80036" points="6067.25,4735.6865,6077.25,4739.6865,6067.25,4743.6865,6071.25,4739.6865" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6176.25" x2="6176.25" y1="4721.6865" y2="4739.6865"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6176.25" x2="6101.25" y1="4739.6865" y2="4739.6865"/><polygon fill="#A80036" points="6111.25,4735.6865,6101.25,4739.6865,6111.25,4743.6865,6107.25,4739.6865" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6089.25" x2="6089.25" y1="4550.2744" y2="4584.4209"/><polygon fill="#A80036" points="6085.25,4574.4209,6089.25,4584.4209,6093.25,4574.4209,6089.25,4578.4209" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6089.25" x2="6089.25" y1="4751.6865" y2="4771.6865"/><polygon fill="#A80036" points="6085.25,4761.6865,6089.25,4771.6865,6093.25,4761.6865,6089.25,4765.6865" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6089.25" x2="6089.25" y1="4805.8193" y2="4849.6846"/><polygon fill="#A80036" points="6085.25,4839.6846,6089.25,4849.6846,6093.25,4839.6846,6089.25,4843.6846" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6748.25" x2="6748.25" y1="4357.0225" y2="4392.0225"/><polygon fill="#A80036" points="6744.25,4382.0225,6748.25,4392.0225,6752.25,4382.0225,6748.25,4386.0225" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6748.25" x2="6748.25" y1="4426.1553" y2="4461.1553"/><polygon fill="#A80036" points="6744.25,4451.1553,6748.25,4461.1553,6752.25,4451.1553,6748.25,4455.1553" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6748.25" x2="6748.25" y1="4495.2881" y2="4530.2881"/><polygon fill="#A80036" points="6744.25,4520.2881,6748.25,4530.2881,6752.25,4520.2881,6748.25,4524.2881" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6748.25" x2="6748.25" y1="4564.4209" y2="4598.5674"/><polygon fill="#A80036" points="6744.25,4588.5674,6748.25,4598.5674,6752.25,4588.5674,6748.25,4592.5674" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6748.25" x2="6748.25" y1="4632.7002" y2="4667.7002"/><polygon fill="#A80036" points="6744.25,4657.7002,6748.25,4667.7002,6752.25,4657.7002,6748.25,4661.7002" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7001.25" x2="7001.25" y1="4357.0225" y2="4392.0225"/><polygon fill="#A80036" points="6997.25,4382.0225,7001.25,4392.0225,7005.25,4382.0225,7001.25,4386.0225" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7001.25" x2="7001.25" y1="4426.1553" y2="4461.1553"/><polygon fill="#A80036" points="6997.25,4451.1553,7001.25,4461.1553,7005.25,4451.1553,7001.25,4455.1553" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7001.25" x2="7001.25" y1="4495.2881" y2="4530.2881"/><polygon fill="#A80036" points="6997.25,4520.2881,7001.25,4530.2881,7005.25,4520.2881,7001.25,4524.2881" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7001.25" x2="7001.25" y1="4564.4209" y2="4598.5674"/><polygon fill="#A80036" points="6997.25,4588.5674,7001.25,4598.5674,7005.25,4588.5674,7001.25,4592.5674" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7001.25" x2="7001.25" y1="4632.7002" y2="4667.7002"/><polygon fill="#A80036" points="6997.25,4657.7002,7001.25,4667.7002,7005.25,4657.7002,7001.25,4661.7002" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7656.25" x2="7656.25" y1="4529.8545" y2="4937.6826"/><polygon fill="#A80036" points="7652.25,4927.6826,7656.25,4937.6826,7660.25,4927.6826,7656.25,4931.6826" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7246.75" x2="7246.75" y1="4943.6826" y2="4963.6826"/><polygon fill="#A80036" points="7242.75,4953.6826,7246.75,4963.6826,7250.75,4953.6826,7246.75,4957.6826" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7246.75" x2="7246.75" y1="4997.8154" y2="5029.6143"/><polygon fill="#A80036" points="7242.75,5019.6143,7246.75,5029.6143,7250.75,5019.6143,7246.75,5023.6143" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="5435.876" y2="5483.376"/><polygon fill="#A80036" points="8259.75,5473.376,8263.75,5483.376,8267.75,5473.376,8263.75,5477.376" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="5365.5332" y2="5401.7432"/><polygon fill="#A80036" points="8259.75,5391.7432,8263.75,5401.7432,8267.75,5391.7432,8263.75,5395.7432" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8343.25" x2="8547.25" y1="5549.5088" y2="5549.5088"/><polygon fill="#A80036" points="8543.25,5463.376,8547.25,5453.376,8551.25,5463.376,8547.25,5459.376" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8547.25" x2="8547.25" y1="5353.5332" y2="5549.5088"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8547.25" x2="8275.75" y1="5353.5332" y2="5353.5332"/><polygon fill="#A80036" points="8285.75,5349.5332,8275.75,5353.5332,8285.75,5357.5332,8281.75,5353.5332" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="5517.5088" y2="5537.5088"/><polygon fill="#A80036" points="8259.75,5527.5088,8263.75,5537.5088,8267.75,5527.5088,8263.75,5531.5088" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="5317.0557" y2="5341.5332"/><polygon fill="#A80036" points="8259.75,5331.5332,8263.75,5341.5332,8267.75,5331.5332,8263.75,5335.5332" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8333.75" x2="8569.25" y1="5305.0557" y2="5305.0557"/><polygon fill="#A80036" points="8565.25,5449.8535,8569.25,5459.8535,8573.25,5449.8535,8569.25,5453.8535" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8569.25" x2="8569.25" y1="5305.0557" y2="5597.2842"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8569.25" x2="8275.75" y1="5597.2842" y2="5597.2842"/><polygon fill="#A80036" points="8285.75,5593.2842,8275.75,5597.2842,8285.75,5601.2842,8281.75,5597.2842" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="5561.5088" y2="5585.2842"/><polygon fill="#A80036" points="8259.75,5575.2842,8263.75,5585.2842,8267.75,5575.2842,8263.75,5579.2842" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="5273.0557" y2="5293.0557"/><polygon fill="#A80036" points="8259.75,5283.0557,8263.75,5293.0557,8267.75,5283.0557,8263.75,5287.0557" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="5218.9229" y2="5238.9229"/><polygon fill="#A80036" points="8259.75,5228.9229,8263.75,5238.9229,8267.75,5228.9229,8263.75,5232.9229" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8334.25" x2="8593.25" y1="5641.2842" y2="5641.2842"/><polygon fill="#A80036" points="8589.25,5435.2871,8593.25,5425.2871,8597.25,5435.2871,8593.25,5431.2871" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8593.25" x2="8593.25" y1="5206.9229" y2="5641.2842"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8593.25" x2="8275.75" y1="5206.9229" y2="5206.9229"/><polygon fill="#A80036" points="8285.75,5202.9229,8275.75,5206.9229,8285.75,5210.9229,8281.75,5206.9229" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="5609.2842" y2="5629.2842"/><polygon fill="#A80036" points="8259.75,5619.2842,8263.75,5629.2842,8267.75,5619.2842,8263.75,5623.2842" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="5174.9229" y2="5194.9229"/><polygon fill="#A80036" points="8259.75,5184.9229,8263.75,5194.9229,8267.75,5184.9229,8263.75,5188.9229" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="5653.2842" y2="5696.1816"/><polygon fill="#A80036" points="8259.75,5686.1816,8263.75,5696.1816,8267.75,5686.1816,8263.75,5690.1816" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="8267.75" y="5674.7393">no</text><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="5884.6465" y2="5904.6465"/><polygon fill="#A80036" points="8259.75,5894.6465,8263.75,5904.6465,8267.75,5894.6465,8263.75,5898.6465" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="5938.7793" y2="5962.0234"/><polygon fill="#A80036" points="8259.75,5952.0234,8263.75,5962.0234,8267.75,5952.0234,8263.75,5956.0234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="5826.0361" y2="5850.5137"/><polygon fill="#A80036" points="8259.75,5840.5137,8263.75,5850.5137,8267.75,5840.5137,8263.75,5844.5137" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8366.25" x2="8778.25" y1="5814.0361" y2="5814.0361"/><polygon fill="#A80036" points="8774.25,5902.6465,8778.25,5912.6465,8782.25,5902.6465,8778.25,5906.6465" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8778.25" x2="8778.25" y1="5814.0361" y2="6006.0234"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8778.25" x2="8263.75" y1="6006.0234" y2="6006.0234"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="6006.0234" y2="6026.0234"/><polygon fill="#A80036" points="8259.75,6016.0234,8263.75,6026.0234,8267.75,6016.0234,8263.75,6020.0234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="5777.5586" y2="5802.0361"/><polygon fill="#A80036" points="8259.75,5792.0361,8263.75,5802.0361,8267.75,5792.0361,8263.75,5796.0361" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8344.25" x2="8796.25" y1="5765.5586" y2="5765.5586"/><polygon fill="#A80036" points="8792.25,5896.6465,8796.25,5906.6465,8800.25,5896.6465,8796.25,5900.6465" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8796.25" x2="8796.25" y1="5765.5586" y2="6038.0234"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8796.25" x2="8275.75" y1="6038.0234" y2="6038.0234"/><polygon fill="#A80036" points="8285.75,6034.0234,8275.75,6038.0234,8285.75,6042.0234,8281.75,6038.0234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="5730.3145" y2="5753.5586"/><polygon fill="#A80036" points="8259.75,5743.5586,8263.75,5753.5586,8267.75,5743.5586,8263.75,5747.5586" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="6050.0234" y2="6070.0234"/><polygon fill="#A80036" points="8259.75,6060.0234,8263.75,6070.0234,8267.75,6060.0234,8263.75,6064.0234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="6104.1563" y2="6127.4004"/><polygon fill="#A80036" points="8259.75,6117.4004,8263.75,6127.4004,8267.75,6117.4004,8263.75,6121.4004" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="6259.666" y2="6288.2207"/><polygon fill="#A80036" points="8259.75,6278.2207,8263.75,6288.2207,8267.75,6278.2207,8263.75,6282.2207" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="6322.3535" y2="6360.9082"/><polygon fill="#A80036" points="8259.75,6350.9082,8263.75,6360.9082,8267.75,6350.9082,8263.75,6354.9082" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8101.25" x2="8101.25" y1="6489.5527" y2="6509.5527"/><polygon fill="#A80036" points="8097.25,6499.5527,8101.25,6509.5527,8105.25,6499.5527,8101.25,6503.5527" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8111.25" x2="8101.25" y1="6433.4199" y2="6433.4199"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8101.25" x2="8101.25" y1="6433.4199" y2="6455.4199"/><polygon fill="#A80036" points="8097.25,6445.4199,8101.25,6455.4199,8105.25,6445.4199,8101.25,6449.4199" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8416.25" x2="8426.25" y1="6433.4199" y2="6433.4199"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8426.25" x2="8426.25" y1="6433.4199" y2="6455.4199"/><polygon fill="#A80036" points="8422.25,6445.4199,8426.25,6455.4199,8430.25,6445.4199,8426.25,6449.4199" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8101.25" x2="8101.25" y1="6543.6855" y2="6561.6855"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8101.25" x2="8251.75" y1="6561.6855" y2="6561.6855"/><polygon fill="#A80036" points="8241.75,6557.6855,8251.75,6561.6855,8241.75,6565.6855,8245.75,6561.6855" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8426.25" x2="8426.25" y1="6489.5527" y2="6561.6855"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8426.25" x2="8275.75" y1="6561.6855" y2="6561.6855"/><polygon fill="#A80036" points="8285.75,6557.6855,8275.75,6561.6855,8285.75,6565.6855,8281.75,6561.6855" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="6395.041" y2="6421.4199"/><polygon fill="#A80036" points="8259.75,6411.4199,8263.75,6421.4199,8267.75,6411.4199,8263.75,6415.4199" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="6205.5332" y2="6225.5332"/><polygon fill="#A80036" points="8259.75,6215.5332,8263.75,6225.5332,8267.75,6215.5332,8263.75,6219.5332" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8361.75" x2="8703.25" y1="6605.6855" y2="6605.6855"/><polygon fill="#A80036" points="8699.25,6401.4199,8703.25,6391.4199,8707.25,6401.4199,8703.25,6397.4199" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8703.25" x2="8703.25" y1="6193.5332" y2="6605.6855"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8703.25" x2="8275.75" y1="6193.5332" y2="6193.5332"/><polygon fill="#A80036" points="8285.75,6189.5332,8275.75,6193.5332,8285.75,6197.5332,8281.75,6193.5332" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="6573.6855" y2="6593.6855"/><polygon fill="#A80036" points="8259.75,6583.6855,8263.75,6593.6855,8267.75,6583.6855,8263.75,6587.6855" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="6161.5332" y2="6181.5332"/><polygon fill="#A80036" points="8259.75,6171.5332,8263.75,6181.5332,8267.75,6171.5332,8263.75,6175.5332" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="6617.6855" y2="6658.9609"/><polygon fill="#A80036" points="8259.75,6648.9609,8263.75,6658.9609,8267.75,6648.9609,8263.75,6652.9609" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="8267.75" y="6639.1406">no</text><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="6693.0938" y2="6736.959"/><polygon fill="#A80036" points="8259.75,6726.959,8263.75,6736.959,8267.75,6726.959,8263.75,6730.959" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="6848.957" y2="6876.6787"/><polygon fill="#A80036" points="8259.75,6866.6787,8263.75,6876.6787,8267.75,6866.6787,8263.75,6870.6787" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8364.75" x2="8676.75" y1="6836.957" y2="6836.957"/><polygon fill="#A80036" points="8672.75,6883.7451,8676.75,6893.7451,8680.75,6883.7451,8676.75,6887.7451" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8676.75" x2="8676.75" y1="6836.957" y2="6946.0557"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8676.75" x2="8275.75" y1="6946.0557" y2="6946.0557"/><polygon fill="#A80036" points="8285.75,6942.0557,8275.75,6946.0557,8285.75,6950.0557,8281.75,6946.0557" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="6910.8115" y2="6934.0557"/><polygon fill="#A80036" points="8259.75,6924.0557,8263.75,6934.0557,8267.75,6924.0557,8263.75,6928.0557" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="6771.0918" y2="6824.957"/><polygon fill="#A80036" points="8259.75,6814.957,8263.75,6824.957,8267.75,6814.957,8263.75,6818.957" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="6958.0557" y2="6978.0557"/><polygon fill="#A80036" points="8259.75,6968.0557,8263.75,6978.0557,8267.75,6968.0557,8263.75,6972.0557" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8091.25" x2="8091.25" y1="7154.4541" y2="7174.4541"/><polygon fill="#A80036" points="8087.25,7164.4541,8091.25,7174.4541,8095.25,7164.4541,8091.25,7168.4541" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8091.25" x2="8091.25" y1="7208.5869" y2="7231.8311"/><polygon fill="#A80036" points="8087.25,7221.8311,8091.25,7231.8311,8095.25,7221.8311,8091.25,7225.8311" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8091.25" x2="8091.25" y1="7090.1885" y2="7120.3213"/><polygon fill="#A80036" points="8087.25,7110.3213,8091.25,7120.3213,8095.25,7110.3213,8091.25,7114.3213" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8138.75" x2="8315.25" y1="7297.9639" y2="7297.9639"/><polygon fill="#A80036" points="8311.25,7201.5205,8315.25,7191.5205,8319.25,7201.5205,8315.25,7197.5205" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8315.25" x2="8315.25" y1="7078.1885" y2="7297.9639"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8315.25" x2="8103.25" y1="7078.1885" y2="7078.1885"/><polygon fill="#A80036" points="8113.25,7074.1885,8103.25,7078.1885,8113.25,7082.1885,8109.25,7078.1885" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8091.25" x2="8091.25" y1="7265.9639" y2="7285.9639"/><polygon fill="#A80036" points="8087.25,7275.9639,8091.25,7285.9639,8095.25,7275.9639,8091.25,7279.9639" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8199.75" x2="8091.25" y1="7044.1885" y2="7044.1885"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8091.25" x2="8091.25" y1="7044.1885" y2="7066.1885"/><polygon fill="#A80036" points="8087.25,7056.1885,8091.25,7066.1885,8095.25,7056.1885,8091.25,7060.1885" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8327.75" x2="8436.25" y1="7044.1885" y2="7044.1885"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8436.25" x2="8436.25" y1="7044.1885" y2="7066.1885"/><polygon fill="#A80036" points="8432.25,7056.1885,8436.25,7066.1885,8440.25,7056.1885,8436.25,7060.1885" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8091.25" x2="8091.25" y1="7309.9639" y2="7327.9639"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8091.25" x2="8251.75" y1="7327.9639" y2="7327.9639"/><polygon fill="#A80036" points="8241.75,7323.9639,8251.75,7327.9639,8241.75,7331.9639,8245.75,7327.9639" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8436.25" x2="8436.25" y1="7100.3213" y2="7327.9639"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8436.25" x2="8275.75" y1="7327.9639" y2="7327.9639"/><polygon fill="#A80036" points="8285.75,7323.9639,8275.75,7327.9639,8285.75,7331.9639,8281.75,7327.9639" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="7012.1885" y2="7032.1885"/><polygon fill="#A80036" points="8259.75,7022.1885,8263.75,7032.1885,8267.75,7022.1885,8263.75,7026.1885" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="7339.9639" y2="7368.5186"/><polygon fill="#A80036" points="8259.75,7358.5186,8263.75,7368.5186,8267.75,7358.5186,8263.75,7362.5186" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8958.75" x2="8958.75" y1="7601.9346" y2="7717.042"/><polygon fill="#A80036" points="8954.75,7707.042,8958.75,7717.042,8962.75,7707.042,8958.75,7711.042" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="272.5" x2="272.5" y1="343.2363" y2="348.2363"/><line style="stroke:#A80036;stroke-width:1.5;" x1="272.5" x2="935.5" y1="348.2363" y2="348.2363"/><line style="stroke:#A80036;stroke-width:1.5;" x1="935.5" x2="935.5" y1="348.2363" y2="363.2363"/><polygon fill="#A80036" points="931.5,353.2363,935.5,363.2363,939.5,353.2363,935.5,357.2363" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="935.5" x2="935.5" y1="704.0332" y2="709.0332"/><line style="stroke:#A80036;stroke-width:1.5;" x1="935.5" x2="1420.5" y1="709.0332" y2="709.0332"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1420.5" x2="1420.5" y1="709.0332" y2="724.0332"/><polygon fill="#A80036" points="1416.5,714.0332,1420.5,724.0332,1424.5,714.0332,1420.5,718.0332" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1420.5" x2="1420.5" y1="1101.0576" y2="1133.6626"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1420.5" x2="2169.75" y1="1133.6626" y2="1133.6626"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2169.75" x2="2169.75" y1="1133.6626" y2="1159.2676"/><polygon fill="#A80036" points="2165.75,1149.2676,2169.75,1159.2676,2173.75,1149.2676,2169.75,1153.2676" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2530.5" x2="2518.5" y1="1376.5098" y2="1376.5098"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2518.5" x2="2518.5" y1="1376.5098" y2="1393.5098"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2518.5" x2="3205" y1="1393.5098" y2="1393.5098"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3205" x2="3205" y1="1393.5098" y2="1439.1309"/><polygon fill="#A80036" points="3201,1429.1309,3205,1439.1309,3209,1429.1309,3205,1433.1309" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2701.5" x2="4225.25" y1="1376.5098" y2="1376.5098"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4225.25" x2="4225.25" y1="1376.5098" y2="1408.5098"/><polygon fill="#A80036" points="4221.25,1398.5098,4225.25,1408.5098,4229.25,1398.5098,4225.25,1402.5098" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3205" x2="3205" y1="2733.5156" y2="2737.5156"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3205" x2="2586" y1="2737.5156" y2="2737.5156"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2586" x2="2586" y1="2737.5156" y2="2755.5156"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2586" x2="2604" y1="2755.5156" y2="2755.5156"/><polygon fill="#A80036" points="2594,2751.5156,2604,2755.5156,2594,2759.5156,2598,2755.5156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4225.25" x2="4225.25" y1="1515.0195" y2="2755.5156"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4225.25" x2="2628" y1="2755.5156" y2="2755.5156"/><polygon fill="#A80036" points="2638,2751.5156,2628,2755.5156,2638,2759.5156,2634,2755.5156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2616" x2="2616" y1="2767.5156" y2="2772.5156"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2616" x2="3876.5" y1="2772.5156" y2="2772.5156"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3876.5" x2="3876.5" y1="2772.5156" y2="2787.5156"/><polygon fill="#A80036" points="3872.5,2777.5156,3876.5,2787.5156,3880.5,2777.5156,3876.5,2781.5156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2169.75" x2="2169.75" y1="1318.0215" y2="1328.7656"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2169.75" x2="2616" y1="1328.7656" y2="1328.7656"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2616" x2="2616" y1="1328.7656" y2="1364.5098"/><polygon fill="#A80036" points="2612,1354.5098,2616,1364.5098,2620,1354.5098,2616,1358.5098" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3876.5" x2="3876.5" y1="2821.6484" y2="2849.1196"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3876.5" x2="4830.75" y1="2849.1196" y2="2849.1196"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4830.75" x2="4830.75" y1="2849.1196" y2="2902.5908"/><polygon fill="#A80036" points="4826.75,2892.5908,4830.75,2902.5908,4834.75,2892.5908,4830.75,2896.5908" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5321.75" x2="5321.75" y1="4110.1377" y2="4114.1377"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5321.75" x2="6089.25" y1="4114.1377" y2="4114.1377"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6089.25" x2="6089.25" y1="4114.1377" y2="4130.1377"/><polygon fill="#A80036" points="6085.25,4120.1377,6089.25,4130.1377,6093.25,4120.1377,6089.25,4124.1377" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5519.5" x2="5519.5" y1="4110.1377" y2="4114.1377"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5519.5" x2="6748.25" y1="4114.1377" y2="4114.1377"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6748.25" x2="6748.25" y1="4114.1377" y2="4322.8896"/><polygon fill="#A80036" points="6744.25,4312.8896,6748.25,4322.8896,6752.25,4312.8896,6748.25,4316.8896" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5749.5" x2="5749.5" y1="4110.1377" y2="4114.1377"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5749.5" x2="7001.25" y1="4114.1377" y2="4114.1377"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7001.25" x2="7001.25" y1="4114.1377" y2="4322.8896"/><polygon fill="#A80036" points="6997.25,4312.8896,7001.25,4322.8896,7005.25,4312.8896,7001.25,4316.8896" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5890.75" x2="5890.75" y1="4110.1377" y2="4114.1377"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5890.75" x2="7656.25" y1="4114.1377" y2="4114.1377"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7656.25" x2="7656.25" y1="4114.1377" y2="4495.7217"/><polygon fill="#A80036" points="7652.25,4485.7217,7656.25,4495.7217,7660.25,4485.7217,7656.25,4489.7217" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6089.25" x2="6089.25" y1="4883.8174" y2="4923.6826"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6089.25" x2="7158.25" y1="4923.6826" y2="4923.6826"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7158.25" x2="7158.25" y1="4923.6826" y2="4937.6826"/><polygon fill="#A80036" points="7154.25,4927.6826,7158.25,4937.6826,7162.25,4927.6826,7158.25,4931.6826" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6748.25" x2="6748.25" y1="4701.833" y2="4923.6826"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6748.25" x2="7283.5" y1="4923.6826" y2="4923.6826"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7283.5" x2="7283.5" y1="4923.6826" y2="4937.6826"/><polygon fill="#A80036" points="7279.5,4927.6826,7283.5,4937.6826,7287.5,4927.6826,7283.5,4931.6826" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7001.25" x2="7001.25" y1="4701.833" y2="4923.6826"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7001.25" x2="7513.5" y1="4923.6826" y2="4923.6826"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7513.5" x2="7513.5" y1="4923.6826" y2="4937.6826"/><polygon fill="#A80036" points="7509.5,4927.6826,7513.5,4937.6826,7517.5,4927.6826,7513.5,4931.6826" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4830.75" x2="4830.75" y1="3909.3408" y2="3944.8955"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4830.75" x2="5482.75" y1="3944.8955" y2="3944.8955"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5482.75" x2="5482.75" y1="3944.8955" y2="3989.3838"/><polygon fill="#A80036" points="5478.75,3979.3838,5482.75,3989.3838,5486.75,3979.3838,5482.75,3983.3838" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7246.75" x2="7246.75" y1="5063.7471" y2="5099.3018"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7246.75" x2="8263.75" y1="5099.3018" y2="5099.3018"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="5099.3018" y2="5140.79"/><polygon fill="#A80036" points="8259.75,5130.79,8263.75,5140.79,8267.75,5130.79,8263.75,5134.79" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8263.75" y1="7402.6514" y2="7467.6943"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8263.75" x2="8958.75" y1="7467.6943" y2="7467.6943"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8958.75" x2="8958.75" y1="7467.6943" y2="7567.8018"/><polygon fill="#A80036" points="8954.75,7557.8018,8958.75,7567.8018,8962.75,7557.8018,8958.75,7561.8018" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8958.75" x2="8958.75" y1="7751.1748" y2="7768.1748"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8958.75" x2="272.5" y1="7768.1748" y2="7768.1748"/><line style="stroke:#A80036;stroke-width:1.5;" x1="272.5" x2="272.5" y1="7768.1748" y2="7783.1748"/><polygon fill="#A80036" points="268.5,7773.1748,272.5,7783.1748,276.5,7773.1748,272.5,7777.1748" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="79" x="266.25" y="50.8984">CLI Layer</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="115" x="880" y="50.8984">Data Loading</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="107" x="1496.5" y="50.8984">Initialization</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="142" x="2081.5" y="50.8984">Query Execution</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="263" x="2479" y="50.8984">Phase 1: Community Selection</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="202" x="3144.75" y="50.8984">Dynamic Selection Path</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="176" x="4060.375" y="50.8984">Static Selection Path</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="228" x="4801.25" y="50.8984">Phase 2: Context Batching</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="253" x="5476.25" y="50.8984">Phase 3: MAP Phase (Parallel)</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="108" x="6214" y="50.8984">MAP Batch 1</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="108" x="6690.75" y="50.8984">MAP Batch 2</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="108" x="6943.75" y="50.8984">MAP Batch 3</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="110" x="7503.5" y="50.8984">MAP Batch N</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="203" x="8306" y="50.8984">Phase 4: REDUCE Phase</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="220" x="9072.5" y="50.8984">Phase 5: Result Assembly</text><!--MD5=[3b06c15eacbb7584dd932de10197fbe3]
@startuml Global Search Activity Diagram
title GraphRAG Global Search - Detailed Activity Flow (MAP-REDUCE)

|#AntiqueWhite|CLI Layer|
start
:User executes query\n""graphrag query 'What are the main themes?' - -method global"";

:Parse CLI arguments;
note right
  - query string
  - root directory
  - data directory
  - community_level
  - response_type
  - dynamic-community-selection
  - streaming flag
end note

:Load configuration\n(settings.yaml);

|#LightBlue|Data Loading|
:Read Parquet files from output/;
fork
  :Load entities.parquet\n(optional for dynamic selection);
fork again
  :Load communities.parquet;
fork again
  :Load community_reports.parquet;
end fork

:Load embedding vector stores\n(if dynamic selection enabled);
if (Dynamic selection enabled?) then (yes)
  :Load entity_description embeddings;
else (no)
  :Skip embedding loading;
endif

|#LightGreen|Initialization|
:Create GlobalSearch engine via factory;

partition "Factory Setup" {
  :Create completion model\n(LiteLLM);
  :Load global search prompts;
  note right
    - MAP_SYSTEM_PROMPT
    - REDUCE_SYSTEM_PROMPT
    - GENERAL_KNOWLEDGE_INSTRUCTION
  end note
  :Create GlobalCommunityContext builder;
  note right
    Configured with:
    - community_reports DataFrame
    - communities DataFrame
    - entities DataFrame (optional)
    - token encoder
    - dynamic selection settings
  end note
  :Set MAP-REDUCE parameters;
  note right
    - max_context_tokens: 8000
    - data_max_tokens: 8000
    - map_max_length: 1000 words
    - reduce_max_length: 2000 words
    - concurrent_coroutines: 32
  end note
}

|#LightYellow|Query Execution|
:Start GlobalSearch.search(query);

if (Conversation history exists?) then (yes)
  :Add conversation history to context;
  note right
    conversation_history_max_turns
    (default: 5)
  end note
else (no)
  :Skip conversation context;
endif

|#LightCoral|Phase 1: Community Selection|
partition "Community Report Selection" {
  if (Dynamic selection enabled?) then (yes)
    |#LightCoral|Dynamic Selection Path|
    :Initialize DynamicCommunitySelection;
    note right
      Parameters:
      - rating_threshold (default: 7)
      - keep_parent (default: true)
      - num_repeats (default: 1)
      - use_summary (default: true)
      - max_level (default: 10)
    end note

    :Start with root communities (level 0);

    repeat
      :Rate batch of communities in parallel;
      note right
        For each community:
        - Query: User query
        - Description: Community report summary/full_content
        - LLM rates relevance: 0-10 scale
      end note

      fork
        :Community A: Call LLM for rating;
      fork again
        :Community B: Call LLM for rating;
      fork again
        :Community C: Call LLM for rating;
      fork again
        :... (up to concurrent_coroutines);
      end fork

      :Collect ratings from all LLM calls;
      note right
        Track:
        - llm_calls count
        - prompt_tokens
        - output_tokens
      end note

      repeat
        :For each rated community;

        if (Rating ≥ threshold?) then (yes)
          :Add to relevant_communities;

          if (Has children?) then (yes)
            :Add children to next queue;
          endif

          if (keep_parent = false?) then (yes)
            :Remove parent from relevant set;
          endif
        else (no)
          :Skip community;
        endif

      repeat while (More rated communities?) is (yes)
      -> no;

      if (Queue empty AND no relevant found?) then (yes)
        :Add all communities at next level;
        note right
          Fallback mechanism to ensure
          we don't return empty results
        end note
      endif

    repeat while (Queue has communities?) is (yes)
    -> no;

    :Filter community_reports by relevant_communities;

  else (no)
    |#LightCoral|Static Selection Path|
    :Select all reports at specified community_level;
    note right
      Default: level 2
      Fast, no LLM calls
    end note

    :Filter by min_community_rank (optional);
  endif

  :Retrieved community reports;
  note right
    Selected reports will be used
    in MAP phase
  end note
}

|#LightSteelBlue|Phase 2: Context Batching|
partition "Community Report Batching" {
  :Build community context batches;
  note right
    Function: build_community_context()
    - Format reports as CSV
    - Shuffle data (random_state: 86)
    - Apply token limits per batch
    - Calculate community weights
  end note

  if (shuffle_data = true?) then (yes)
    :Shuffle community reports randomly;
    note right
      Improves diversity across batches
    end note
  endif

  :Initialize batch variables;
  note right
    - current_batch = []
    - current_tokens = 0
    - batches = []
  end note

  repeat
    :Select next community report;

    :Format report as CSV row;
    note right
      Columns:
      - id
      - community
      - level
      - title
      - summary OR full_content
      - rank (optional)
      - weight/occurrence (optional)

      Format: "id|community|level|title|summary|..."
    end note

    :Count tokens in formatted report;

    if (current_tokens + report_tokens > max_context_tokens?) then (yes)
      :Save current batch to batches;
      :Start new batch;
      :Reset current_tokens = 0;
    else (no)
      :Add report to current_batch;
      :Update current_tokens;
    endif

  repeat while (More reports?) is (yes)
  -> no;

  :Save final batch to batches;

  :Return batches of community reports;
  note right
    Each batch ≤ max_context_tokens
    (default: 8000 tokens)

    Multiple batches = Multiple MAP calls
  end note
}

|#Lavender|Phase 3: MAP Phase (Parallel)|
partition "MAP - Extract Key Points" {
  :Prepare MAP phase execution;
  note right
    Each batch processed independently
    in parallel with semaphore control
  end note

  :Create semaphore with concurrent_coroutines limit;
  note right
    Default: 32 concurrent MAP calls
    Controls parallelism
  end note

  fork
    |#Lavender|MAP Batch 1|
    :Acquire semaphore;

    :Build MAP prompt for batch 1;
    note right
      MAP_SYSTEM_PROMPT format:
      - System: Prompt + context_data (community reports CSV)
      - User: Query
      - Parameters: max_length (1000 words)
    end note

    :Call LLM with JSON mode;
    note right
      response_format_json_object: true
      Ensures structured output
    end note

    :Receive JSON response;
    note right
      Expected format:
      {
        "points": [
          {
            "description": "Key point text",
            "score": 75  // 0-100
          },
          ...
        ]
      }
    end note

    :Parse JSON response;
    if (Parse successful?) then (yes)
      :Extract points array;
    else (no)
      :Warning: JSON parse failed;
      :Return empty points list;
    endif

    :Release semaphore;

    :Store SearchResult;
    note right
      SearchResult contains:
      - response: list of {answer, score}
      - context_data: community reports CSV
      - llm_calls: 1
      - prompt_tokens: context + prompt length
      - output_tokens: response length
    end note

  fork again
    |#Lavender|MAP Batch 2|
    :Acquire semaphore;
    :Build MAP prompt for batch 2;
    :Call LLM with JSON mode;
    :Receive & parse JSON response;
    :Release semaphore;
    :Store SearchResult;

  fork again
    |#Lavender|MAP Batch 3|
    :Acquire semaphore;
    :Build MAP prompt for batch 3;
    :Call LLM with JSON mode;
    :Receive & parse JSON response;
    :Release semaphore;
    :Store SearchResult;

  fork again
    |#Lavender|MAP Batch N|
    :... (one per batch);
    note right
      Number of batches depends on:
      - Total community reports
      - Token limit per batch
      - Community selection method

      Typical: 2-10 batches
    end note
  end fork

  :Collect all MAP responses;
  note right
    List[SearchResult]
    Each with key points + scores
  end note

  :Aggregate statistics;
  note right
    Total MAP phase:
    - llm_calls: N (one per batch)
    - prompt_tokens: sum(all batches)
    - output_tokens: sum(all responses)
  end note
}

|#LightGoldenRodYellow|Phase 4: REDUCE Phase|
partition "REDUCE - Synthesize Final Answer" {
  :Collect all key points from MAP responses;

  repeat
    :For each MAP response;

    if (Response is valid list?) then (yes)
      repeat
        :Extract key point;
        note right
          {
            "analyst": batch_index,
            "answer": description,
            "score": importance_score
          }
        end note
        :Add to key_points list;
      repeat while (More points in response?) is (yes)
      -> no;
    endif

  repeat while (More MAP responses?) is (yes)
  -> no;

  :Filter points with score > 0;
  note right
    Remove irrelevant points
    (score = 0 means no relevant info)
  end note

  if (No points with score > 0?) then (yes)
    if (allow_general_knowledge = false?) then (yes)
      :No relevant data found;
      :Return NO_DATA_ANSWER;
      note right
        Canned response:
        "I do not have enough information to answer this question."
      end note
      stop
    endif
  endif

  :Sort points by score (descending);
  note right
    Higher scored points first
    Prioritizes most important info
  end note

  :Apply token budget for REDUCE context;
  note right
    Budget: data_max_tokens (default: 8000)
  end note

  repeat
    :Select next key point;

    :Format as analyst report;
    note right
      Format:
      - - - -Analyst {index}- - - -
      Importance Score: {score}
      {answer}
    end note

    :Count tokens in formatted point;

    if (current_tokens + point_tokens ≤ data_max_tokens?) then (yes)
      :Add to REDUCE context;
      :Update current_tokens;
    else (no)
      :Stop adding points;
      note right: Token budget exceeded
    endif

  repeat while (More points AND within budget?) is (yes)
  -> no;

  :Combine all selected points into report_data;

  :Build REDUCE prompt;
  note right
    REDUCE_SYSTEM_PROMPT format:
    - System: Prompt + report_data (analyst reports)
    - Parameters:
      - response_type (e.g., "Multiple Paragraphs")
      - max_length (2000 words)
    - Optional: GENERAL_KNOWLEDGE_INSTRUCTION
  end note

  if (allow_general_knowledge = true?) then (yes)
    :Append general knowledge instruction;
    note right
      Allows LLM to use external knowledge
      Risk: May increase hallucinations
    end note
  endif

  :Call LLM for final synthesis;

  if (Streaming enabled?) then (yes)
    repeat
      :Receive token chunk;
      :Yield token to CLI;
      note right
        Real-time display
        in terminal
      end note
      :Append to full_response;
    repeat while (More tokens?) is (yes)
    -> no;
  else (no)
    :Receive complete response;
  endif

  :Track REDUCE metadata;
  note right
    - llm_calls: 1
    - prompt_tokens: REDUCE prompt length
    - output_tokens: final answer length
    - completion_time: duration
  end note
}

|#PaleGreen|Phase 5: Result Assembly|
partition "Create GlobalSearchResult" {
  :Assemble GlobalSearchResult object;
  note right
    GlobalSearchResult contains:
    - response: Final synthesized answer (string)
    - context_data: Community reports used
    - context_text: Formatted community context
    - map_responses: List[SearchResult] from MAP
    - reduce_context_data: Analyst reports
    - reduce_context_text: Formatted reduce context
    - completion_time: total duration (float)
    - llm_calls: build_context + MAP (N) + REDUCE (1)
    - prompt_tokens: sum(all phases)
    - output_tokens: sum(all phases)
    - llm_calls_categories: {"build_context": X, "map": N, "reduce": 1}
    - prompt_tokens_categories: per-phase breakdown
    - output_tokens_categories: per-phase breakdown
  end note

  :Return GlobalSearchResult to API layer;
}

|#AntiqueWhite|CLI Layer|
:Display answer to user;

if (Verbose flag?) then (yes)
  :Display statistics;
  note right
    - LLM calls: N + 1 (MAP + REDUCE)
      - build_context: X calls
      - map: N calls
      - reduce: 1 call
    - Prompt tokens: Y
    - Output tokens: Z
    - Total tokens: Y + Z
    - Completion time: T seconds
  end note
else (no)
  :Skip statistics;
endif

:Exit with success;
stop







@enduml

PlantUML version 1.2021.00(Sun Jan 10 18:25:05 SGT 2021)
(MIT source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: SG
--></g></svg>