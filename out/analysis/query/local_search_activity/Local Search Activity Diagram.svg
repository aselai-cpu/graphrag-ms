<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="5120px" preserveAspectRatio="none" style="width:9619px;height:5120px;" version="1.1" viewBox="0 0 9619 5120" width="9619px" zoomAndPan="magnify"><defs><filter height="300%" id="f1ercbwujgdkok" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="410" x="4603.5" y="27.4023">GraphRAG Local Search - Detailed Activity Flow</text><rect fill="#FAEBD7" height="5069.6782" style="stroke:#FAEBD7;stroke-width:1.0;" width="478" x="15" y="33.4961"/><ellipse cx="256.5" cy="69.6953" fill="#000000" filter="url(#f1ercbwujgdkok)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="48.1016" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="398" x="57.5" y="99.6953"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="118" x="67.5" y="121.2969">User executes query</text><text fill="#000000" font-family="monospace" font-size="12" lengthAdjust="spacing" textLength="378" x="67.5" y="134.9668">graphrag query 'How is X related to Y?' --method local</text><path d="M345.5,157.7969 L345.5,204.7285 L325.5,208.7285 L345.5,212.7285 L345.5,259.6602 A0,0 0 0 0 345.5,259.6602 L485.5,259.6602 A0,0 0 0 0 485.5,259.6602 L485.5,167.7969 L475.5,157.7969 L345.5,157.7969 A0,0 0 0 0 345.5,157.7969 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M475.5,157.7969 L475.5,167.7969 L485.5,167.7969 L475.5,157.7969 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="351.5" y="175.3652">- query string</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="351.5" y="190.6758">- root directory</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="351.5" y="205.9863">- data directory</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="351.5" y="221.2969">- community_level</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="351.5" y="236.6074">- response_type</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="351.5" y="251.918">- streaming flag</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="138" x="187.5" y="191.6621"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="118" x="197.5" y="213.2637">Parse CLI arguments</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="48.2656" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="126" x="193.5" y="279.6602"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="106" x="203.5" y="301.2617">Load configuration</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="83" x="203.5" y="315.3945">(settings.yaml)</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="151" x="181" y="4802.356"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="131" x="191" y="4823.9575">Display answer to user</text><polygon fill="#FEFECE" filter="url(#f1ercbwujgdkok)" points="220.5,4856.4888,292.5,4856.4888,304.5,4868.4888,292.5,4880.4888,220.5,4880.4888,208.5,4868.4888,220.5,4856.4888" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="72" x="220.5" y="4872.646">Verbose flag?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="190.5" y="4866.1685">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="304.5" y="4866.1685">no</text><path d="M156,4890.4888 L156,4929.7651 L136,4933.7651 L156,4937.7651 L156,4977.0415 A0,0 0 0 0 156,4977.0415 L366,4977.0415 A0,0 0 0 0 366,4977.0415 L366,4900.4888 L356,4890.4888 L156,4890.4888 A0,0 0 0 0 156,4890.4888 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M356,4890.4888 L356,4900.4888 L366,4900.4888 L356,4890.4888 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="162" y="4908.0571">- LLM calls: 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="162" y="4923.3677">- Prompt tokens: X</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="162" y="4938.6782">- Output tokens: Y</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="162" y="4953.9888">- Total tokens: X + Y</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189" x="162" y="4969.2993">- Completion time: Z seconds</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="115" x="21" y="4916.6987"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="95" x="31" y="4938.3003">Display statistics</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="97" x="386" y="4890.4888"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="77" x="396" y="4912.0903">Skip statistics</text><polygon fill="#FEFECE" filter="url(#f1ercbwujgdkok)" points="256.5,4983.0415,268.5,4995.0415,256.5,5007.0415,244.5,4995.0415,256.5,4983.0415" style="stroke:#A80036;stroke-width:1.5;"/><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="116" x="198.5" y="5027.0415"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="96" x="208.5" y="5048.6431">Exit with success</text><ellipse cx="256.5" cy="5092.1743" fill="#FFFFFF" filter="url(#f1ercbwujgdkok)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="256.5" cy="5092.1743" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:2.0;" x1="15" x2="15" y1="33.4961" y2="5103.1743"/><rect fill="#ADD8E6" height="5069.6782" style="stroke:#ADD8E6;stroke-width:1.0;" width="1165" x="493" y="33.4961"/><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="204" x="971.5" y="347.9258"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="184" x="981.5" y="369.5273">Read Parquet files from output/</text><rect fill="#000000" filter="url(#f1ercbwujgdkok)" height="6" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="1149" x="499" y="402.0586"/><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="143" x="511" y="435.125"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="123" x="521" y="456.7266">Load entities.parquet</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="175" x="664" y="435.125"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="155" x="674" y="456.7266">Load relationships.parquet</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="174" x="867" y="435.125"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="154" x="877" y="456.7266">Load communities.parquet</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="212" x="1069" y="435.125"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="192" x="1079" y="456.7266">Load community_reports.parquet</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="157" x="1309" y="435.125"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="137" x="1319" y="456.7266">Load text_units.parquet</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="48.2656" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="160" x="1476" y="428.0586"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="140" x="1486" y="449.6602">Load covariates.parquet</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="54" x="1486" y="463.793">(optional)</text><rect fill="#000000" filter="url(#f1ercbwujgdkok)" height="6" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="1149" x="499" y="496.3242"/><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="196" x="975.5" y="522.3242"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="176" x="985.5" y="543.9258">Load embedding vector stores</text><rect fill="#000000" filter="url(#f1ercbwujgdkok)" height="6" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="490" x="828.5" y="576.457"/><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="229" x="842.5" y="602.457"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="209" x="852.5" y="624.0586">Load entity_description embeddings</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="205" x="1099.5" y="602.457"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="185" x="1109.5" y="624.0586">Load text_unit_text embeddings</text><rect fill="#000000" filter="url(#f1ercbwujgdkok)" height="6" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="490" x="828.5" y="656.5898"/><line style="stroke:#000000;stroke-width:2.0;" x1="493" x2="493" y1="33.4961" y2="5103.1743"/><rect fill="#90EE90" height="5069.6782" style="stroke:#90EE90;stroke-width:1.0;" width="662.5" x="1658" y="33.4961"/><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="234" x="1683.5" y="682.5898"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="214" x="1693.5" y="704.1914">Create LocalSearch engine via factory</text><rect fill="#FFFFFF" filter="url(#f1ercbwujgdkok)" height="457.0117" style="stroke:#000000;stroke-width:2.0;" width="646.5" x="1664" y="726.7227"/><path d="M1767,726.7227 L1767,736.2109 L1757,746.2109 L1664,746.2109 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93" x="1667" y="741.2578">Factory Setup</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="48.2656" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="165" x="1718" y="763.2109"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="145" x="1728" y="784.8125">Create completion model</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="50" x="1728" y="798.9453">(LiteLLM)</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="48.2656" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="168" x="1716.5" y="831.4766"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="148" x="1726.5" y="853.0781">Create embedding model</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="131" x="1726.5" y="867.2109">(for query embedding)</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="48.2656" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="167" x="1717" y="899.7422"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="147" x="1727" y="921.3438">Load local search prompt</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="95" x="1727" y="935.4766">(system prompt)</text><path d="M1947,958.0078 L1947,1027.9053 L1927,1031.9053 L1947,1035.9053 L1947,1105.8027 A0,0 0 0 0 1947,1105.8027 L2174,1105.8027 A0,0 0 0 0 2174,1105.8027 L2174,968.0078 L2164,958.0078 L1947,958.0078 A0,0 0 0 0 1947,958.0078 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2164,958.0078 L2164,968.0078 L2174,968.0078 L2164,958.0078 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="1953" y="975.5762">Configured with:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="1953" y="990.8867">- entities DataFrame</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="1953" y="1006.1973">- relationships DataFrame</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="1953" y="1021.5078">- communities DataFrame</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="1953" y="1036.8184">- community_reports DataFrame</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="1953" y="1052.1289">- text_units DataFrame</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="1953" y="1067.4395">- covariates DataFrame</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="1953" y="1082.75">- token encoder</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="1953" y="1098.0605">- embedding vectorstore</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="253" x="1674" y="1014.8389"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="233" x="1684" y="1036.4404">Create LocalSearchMixedContext builder</text><path d="M1882.5,1115.8027 L1882.5,1139.7686 L1862.5,1143.7686 L1882.5,1147.7686 L1882.5,1171.7344 A0,0 0 0 0 1882.5,1171.7344 L2300.5,1171.7344 A0,0 0 0 0 2300.5,1171.7344 L2300.5,1125.8027 L2290.5,1115.8027 L1882.5,1115.8027 A0,0 0 0 0 1882.5,1115.8027 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2290.5,1115.8027 L2290.5,1125.8027 L2300.5,1125.8027 L2290.5,1115.8027 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="369" x="1888.5" y="1133.3711">text_unit_budget = max_context_tokens × text_unit_prop</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="397" x="1888.5" y="1148.6816">community_budget = max_context_tokens × community_prop</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="267" x="1888.5" y="1163.9922">(default: 12000 tokens total, 0.5/0.5 split)</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="124" x="1738.5" y="1126.7021"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="104" x="1748.5" y="1148.3037">Set token budgets</text><line style="stroke:#000000;stroke-width:2.0;" x1="1658" x2="1658" y1="33.4961" y2="5103.1743"/><rect fill="#FFFFE0" height="5069.6782" style="stroke:#FFFFE0;stroke-width:1.0;" width="662" x="2320.5" y="33.4961"/><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="200" x="2568.75" y="1203.7344"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="180" x="2578.75" y="1225.3359">Start LocalSearch.search(query)</text><polygon fill="#FEFECE" filter="url(#f1ercbwujgdkok)" points="2592.25,1257.8672,2745.25,1257.8672,2757.25,1269.8672,2745.25,1281.8672,2592.25,1281.8672,2580.25,1269.8672,2592.25,1257.8672" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="153" x="2592.25" y="1274.0244">Conversation history exists?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="2562.25" y="1267.5469">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="2757.25" y="1267.5469">no</text><path d="M2569.5,1291.8672 L2569.5,1308.1777 L2549.5,1312.1777 L2569.5,1316.1777 L2569.5,1332.4883 A0,0 0 0 0 2569.5,1332.4883 L2796.5,1332.4883 A0,0 0 0 0 2796.5,1332.4883 L2796.5,1301.8672 L2786.5,1291.8672 L2569.5,1291.8672 A0,0 0 0 0 2569.5,1291.8672 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2786.5,1291.8672 L2786.5,1301.8672 L2796.5,1301.8672 L2786.5,1291.8672 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="2575.5" y="1309.4355">conversation_history_max_turns</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68" x="2575.5" y="1324.7461">(default: 5)</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="223" x="2326.5" y="1295.1113"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="203" x="2336.5" y="1316.7129">Add conversation history to context</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="166" x="2806.5" y="1291.8672"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="146" x="2816.5" y="1313.4688">Skip conversation context</text><polygon fill="#FEFECE" filter="url(#f1ercbwujgdkok)" points="2668.75,1338.4883,2680.75,1350.4883,2668.75,1362.4883,2656.75,1350.4883,2668.75,1338.4883" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:2.0;" x1="2320.5" x2="2320.5" y1="33.4961" y2="5103.1743"/><rect fill="#F08080" height="5069.6782" style="stroke:#F08080;stroke-width:1.0;" width="725.5" x="2982.5" y="33.4961"/><rect fill="#FFFFFF" filter="url(#f1ercbwujgdkok)" height="437.7715" style="stroke:#000000;stroke-width:2.0;" width="709.5" x="2988.5" y="1372.4883"/><path d="M3188.5,1372.4883 L3188.5,1381.9766 L3178.5,1391.9766 L2988.5,1391.9766 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="190" x="2991.5" y="1387.0234">Entity Extraction &amp; Mapping</text><path d="M3329,1413.3877 L3329,1422.043 L3309,1426.043 L3329,1430.043 L3329,1438.6982 A0,0 0 0 0 3329,1438.6982 L3688,1438.6982 A0,0 0 0 0 3688,1438.6982 L3688,1423.3877 L3678,1413.3877 L3329,1413.3877 A0,0 0 0 0 3329,1413.3877 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3678,1413.3877 L3678,1423.3877 L3688,1423.3877 L3678,1413.3877 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="338" x="3335" y="1430.9561">query_embedding = embedding_model.encode(query)</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="268" x="3041" y="1408.9766"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="248" x="3051" y="1430.5781">Embed query using text embedding model</text><path d="M3371.5,1453.1094 L3371.5,1484.7305 L3351.5,1488.7305 L3371.5,1492.7305 L3371.5,1524.3516 A0,0 0 0 0 3371.5,1524.3516 L3658.5,1524.3516 A0,0 0 0 0 3658.5,1524.3516 L3658.5,1463.1094 L3648.5,1453.1094 L3371.5,1453.1094 A0,0 0 0 0 3371.5,1453.1094 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3648.5,1453.1094 L3648.5,1463.1094 L3658.5,1463.1094 L3648.5,1453.1094 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="3377.5" y="1470.6777">Search parameters:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="262" x="3377.5" y="1485.9883">- k = top_k_entities × oversample_scaler</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="3377.5" y="1501.2988">- default: 10 × 2 = 20 entities</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="266" x="3377.5" y="1516.6094">- embedding_vectorstore_key: ID or TITLE</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="353" x="2998.5" y="1471.6641"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="333" x="3008.5" y="1493.2656">Vector similarity search on entity_description embeddings</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="218" x="3066" y="1544.3516"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="198" x="3076" y="1565.9531">Retrieve similar entity descriptions</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="150" x="3100" y="1598.4844"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="130" x="3110" y="1620.0859">Filter excluded entities</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="188" x="3081" y="1652.6172"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="168" x="3091" y="1674.2188">Sort by similarity score (rank)</text><path d="M3262.5,1703.5059 L3262.5,1719.8164 L3242.5,1723.8164 L3262.5,1727.8164 L3262.5,1744.127 A0,0 0 0 0 3262.5,1744.127 L3430.5,1744.127 A0,0 0 0 0 3430.5,1744.127 L3430.5,1713.5059 L3420.5,1703.5059 L3262.5,1703.5059 A0,0 0 0 0 3262.5,1703.5059 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3420.5,1703.5059 L3420.5,1713.5059 L3430.5,1713.5059 L3420.5,1703.5059 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="3268.5" y="1721.0742">top_k_mapped_entities</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="3268.5" y="1736.3848">(default: 10)</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="135" x="3107.5" y="1706.75"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="115" x="3117.5" y="1728.3516">Select top-k entities</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="249" x="3050.5" y="1764.127"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="143" x="3060.5" y="1785.7285">Store selected entities as</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="82" x="3207.5" y="1785.7285">seed_entities</text><line style="stroke:#000000;stroke-width:2.0;" x1="2982.5" x2="2982.5" y1="33.4961" y2="5103.1743"/><rect fill="#B0C4DE" height="5069.6782" style="stroke:#B0C4DE;stroke-width:1.0;" width="702" x="3708" y="33.4961"/><rect fill="#FFFFFF" filter="url(#f1ercbwujgdkok)" height="588.0586" style="stroke:#000000;stroke-width:2.0;" width="686" x="3714" y="1820.2598"/><path d="M3900,1820.2598 L3900,1829.748 L3890,1839.748 L3714,1839.748 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="176" x="3717" y="1834.7949">Neighborhood Expansion</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="231" x="3760.5" y="1856.748"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="211" x="3770.5" y="1878.3496">Initialize entity_set with seed_entities</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="136" x="3808" y="1954.8809"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="116" x="3818" y="1976.4824">For each seed entity</text><path d="M4048,2005.7695 L4048,2022.0801 L4028,2026.0801 L4048,2030.0801 L4048,2046.3906 A0,0 0 0 0 4048,2046.3906 L4372,2046.3906 A0,0 0 0 0 4372,2046.3906 L4372,2015.7695 L4362,2005.7695 L4048,2005.7695 A0,0 0 0 0 4048,2005.7695 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4362,2005.7695 L4362,2015.7695 L4372,2015.7695 L4362,2005.7695 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198" x="4054" y="2023.3379">Query relationships DataFrame:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="303" x="4054" y="2038.6484">- df[(df.source == entity) | (df.target == entity)]</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="304" x="3724" y="2009.0137"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="284" x="3734" y="2030.6152">Find relationships where entity is source or target</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="237" x="3757.5" y="2066.3906"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="217" x="3767.5" y="2087.9922">Extract connected entities (neighbors)</text><path d="M4019,2124.7793 L4019,2141.0898 L3999,2145.0898 L4019,2149.0898 L4019,2165.4004 A0,0 0 0 0 4019,2165.4004 L4235,2165.4004 A0,0 0 0 0 4235,2165.4004 L4235,2134.7793 L4225,2124.7793 L4019,2124.7793 A0,0 0 0 0 4019,2124.7793 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4225,2124.7793 L4225,2134.7793 L4235,2134.7793 L4225,2124.7793 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="4025" y="2142.3477">Entity rank = importance score</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="4025" y="2157.6582">from indexing phase</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="246" x="3753" y="2128.0234"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="226" x="3763" y="2149.625">Rank neighbors by entity.rank attribute</text><path d="M4001,2182.1563 L4001,2198.4668 L3981,2202.4668 L4001,2206.4668 L4001,2222.7773 A0,0 0 0 0 4001,2222.7773 L4147,2222.7773 A0,0 0 0 0 4147,2222.7773 L4147,2192.1563 L4137,2182.1563 L4001,2182.1563 A0,0 0 0 0 4001,2182.1563 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4137,2182.1563 L4137,2192.1563 L4147,2192.1563 L4137,2182.1563 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="4007" y="2199.7246">top_k_relationships</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="4007" y="2215.0352">(default: 10)</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="210" x="3771" y="2185.4004"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="190" x="3781" y="2207.002">Select top-k neighbors per entity</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="178" x="3787" y="2242.7773"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="158" x="3797" y="2264.3789">Add neighbors to entity_set</text><polygon fill="#FEFECE" filter="url(#f1ercbwujgdkok)" points="3876,1910.8809,3888,1922.8809,3876,1934.8809,3864,1922.8809,3876,1910.8809" style="stroke:#A80036;stroke-width:1.5;"/><polygon fill="#FEFECE" filter="url(#f1ercbwujgdkok)" points="3825,2296.9102,3927,2296.9102,3939,2308.9102,3927,2320.9102,3825,2320.9102,3813,2308.9102,3825,2296.9102" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="102" x="3825" y="2313.0674">More seed entities?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="3939" y="2306.5898">yes</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="272" x="3740" y="2362.1855"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="252" x="3750" y="2383.7871">Final entity_set = seed_entities + neighbors</text><line style="stroke:#000000;stroke-width:2.0;" x1="3708" x2="3708" y1="33.4961" y2="5103.1743"/><rect fill="#E6E6FA" height="5069.6782" style="stroke:#E6E6FA;stroke-width:1.0;" width="79" x="4410" y="33.4961"/><rect fill="#FFFFFF" filter="url(#f1ercbwujgdkok)" height="1463.4985" style="stroke:#000000;stroke-width:2.0;" width="63" x="4416" y="2418.3184"/><path d="M4643,2418.3184 L4643,2427.8066 L4633,2437.8066 L4416,2437.8066 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="217" x="4419" y="2432.8535">Multi-Source Context Assembly</text><rect fill="#000000" filter="url(#f1ercbwujgdkok)" height="6" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="43" x="4426" y="2454.8066"/><line style="stroke:#000000;stroke-width:2.0;" x1="4410" x2="4410" y1="33.4961" y2="5103.1743"/><rect fill="#E6E6FA" height="5069.6782" style="stroke:#E6E6FA;stroke-width:1.0;" width="422" x="4489" y="33.4961"/><rect fill="#FFFFFF" filter="url(#f1ercbwujgdkok)" height="1463.4985" style="stroke:#000000;stroke-width:2.0;" width="406" x="4495" y="2418.3184"/><path d="M4722,2418.3184 L4722,2427.8066 L4712,2437.8066 L4495,2437.8066 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="217" x="4498" y="2432.8535">Multi-Source Context Assembly</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="169" x="4510.5" y="2687.4834"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="149" x="4520.5" y="2709.085">Filter entities by entity_set</text><path d="M4676.5,2756.6162 L4676.5,2788.2373 L4656.5,2792.2373 L4676.5,2796.2373 L4676.5,2827.8584 A0,0 0 0 0 4676.5,2827.8584 L4791.5,2827.8584 A0,0 0 0 0 4791.5,2827.8584 L4791.5,2766.6162 L4781.5,2756.6162 L4676.5,2756.6162 A0,0 0 0 0 4676.5,2756.6162 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4781.5,2756.6162 L4781.5,2766.6162 L4791.5,2766.6162 L4781.5,2756.6162 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="24" x="4682.5" y="2774.1846">- id</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="4682.5" y="2789.4951">- entity (name)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="4682.5" y="2804.8057">- description</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="40" x="4682.5" y="2820.1162">- rank</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="123" x="4533.5" y="2775.1709"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="103" x="4543.5" y="2796.7725">Select entity fields</text><path d="M4683,2862.8584 L4683,2879.0801 L4663,2883.0801 L4683,2887.0801 L4683,2903.3018 A0,0 0 0 0 4683,2903.3018 L4889,2903.3018 A0,0 0 0 0 4889,2903.3018 L4889,2872.8584 L4879,2862.8584 L4683,2862.8584 A0,0 0 0 0 4683,2862.8584 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4879,2862.8584 L4879,2872.8584 L4889,2872.8584 L4879,2862.8584 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="168" x="4689" y="2879.9253">id,entity,description</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="4689" y="2895.5596">Ordered by rank (descending)</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="136" x="4527" y="2866.0137"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="116" x="4537" y="2887.6152">Format as CSV table</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="176" x="4507" y="2938.3018"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="156" x="4517" y="2959.9033">Count entity context tokens</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="158" x="4516" y="3007.4346"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="46" x="4526" y="3029.0361">Store as</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="88" x="4576" y="3029.0361">entity_context</text><line style="stroke:#000000;stroke-width:2.0;" x1="4489" x2="4489" y1="33.4961" y2="5103.1743"/><rect fill="#E6E6FA" height="5069.6782" style="stroke:#E6E6FA;stroke-width:1.0;" width="490" x="4911" y="33.4961"/><rect fill="#FFFFFF" filter="url(#f1ercbwujgdkok)" height="1463.4985" style="stroke:#000000;stroke-width:2.0;" width="474" x="4917" y="2418.3184"/><path d="M5144,2418.3184 L5144,2427.8066 L5134,2437.8066 L4917,2437.8066 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="217" x="4920" y="2432.8535">Multi-Source Context Assembly</text><path d="M5158,2638.7734 L5158,2655.084 L5138,2659.084 L5158,2663.084 L5158,2679.3945 A0,0 0 0 0 5158,2679.3945 L5371,2679.3945 A0,0 0 0 0 5371,2679.3945 L5371,2648.7734 L5361,2638.7734 L5158,2638.7734 A0,0 0 0 0 5158,2638.7734 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M5361,2638.7734 L5361,2648.7734 L5371,2648.7734 L5361,2638.7734 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="5164" y="2656.3418">Relationships between entities</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="5164" y="2671.6523">in entity_set</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="184" x="4954" y="2642.0176"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="164" x="4964" y="2663.6191">Get in-network relationships</text><path d="M5159.5,2714.3945 L5159.5,2730.7051 L5139.5,2734.7051 L5159.5,2738.7051 L5159.5,2755.0156 A0,0 0 0 0 5159.5,2755.0156 L5305.5,2755.0156 A0,0 0 0 0 5305.5,2755.0156 L5305.5,2724.3945 L5295.5,2714.3945 L5159.5,2714.3945 A0,0 0 0 0 5159.5,2714.3945 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M5295.5,2714.3945 L5295.5,2724.3945 L5305.5,2724.3945 L5295.5,2714.3945 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="5165.5" y="2731.9629">top_k_relationships</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="5165.5" y="2747.2734">(default: 10)</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="187" x="4952.5" y="2717.6387"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="167" x="4962.5" y="2739.2402">Apply relationship count limit</text><path d="M5145.5,2790.0156 L5145.5,2829.292 L5125.5,2833.292 L5145.5,2837.292 L5145.5,2876.5684 A0,0 0 0 0 5145.5,2876.5684 L5249.5,2876.5684 A0,0 0 0 0 5249.5,2876.5684 L5249.5,2800.0156 L5239.5,2790.0156 L5145.5,2790.0156 A0,0 0 0 0 5145.5,2790.0156 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M5239.5,2790.0156 L5239.5,2800.0156 L5249.5,2800.0156 L5239.5,2790.0156 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="24" x="5151.5" y="2807.584">- id</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54" x="5151.5" y="2822.8945">- source</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49" x="5151.5" y="2838.2051">- target</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="5151.5" y="2853.5156">- description</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="40" x="5151.5" y="2868.8262">- rank</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="159" x="4966.5" y="2816.2256"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="139" x="4976.5" y="2837.8271">Select relationship fields</text><path d="M5134,2911.5684 L5134,2927.79 L5114,2931.79 L5134,2935.79 L5134,2952.0117 A0,0 0 0 0 5134,2952.0117 L5379,2952.0117 A0,0 0 0 0 5379,2952.0117 L5379,2921.5684 L5369,2911.5684 L5134,2911.5684 A0,0 0 0 0 5134,2911.5684 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M5369,2911.5684 L5369,2921.5684 L5379,2921.5684 L5369,2911.5684 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="224" x="5140" y="2928.6353">id,source,target,description</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="5140" y="2944.2695">Ordered by rank (descending)</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="136" x="4978" y="2914.7236"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="116" x="4988" y="2936.3252">Format as CSV table</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="212" x="4940" y="2987.0117"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="192" x="4950" y="3008.6133">Count relationship context tokens</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="197" x="4947.5" y="3056.1445"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="46" x="4957.5" y="3077.7461">Store as</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="127" x="5007.5" y="3077.7461">relationship_context</text><line style="stroke:#000000;stroke-width:2.0;" x1="4911" x2="4911" y1="33.4961" y2="5103.1743"/><rect fill="#E6E6FA" height="5069.6782" style="stroke:#E6E6FA;stroke-width:1.0;" width="802" x="5401" y="33.4961"/><rect fill="#FFFFFF" filter="url(#f1ercbwujgdkok)" height="1463.4985" style="stroke:#000000;stroke-width:2.0;" width="786" x="5407" y="2418.3184"/><path d="M5634,2418.3184 L5634,2427.8066 L5624,2437.8066 L5407,2437.8066 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="217" x="5410" y="2432.8535">Multi-Source Context Assembly</text><path d="M5834.5,2480.8066 L5834.5,2497.1172 L5814.5,2501.1172 L5834.5,2505.1172 L5834.5,2521.4277 A0,0 0 0 0 5834.5,2521.4277 L6025.5,2521.4277 A0,0 0 0 0 6025.5,2521.4277 L6025.5,2490.8066 L6015.5,2480.8066 L5834.5,2480.8066 A0,0 0 0 0 5834.5,2480.8066 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M6015.5,2480.8066 L6015.5,2490.8066 L6025.5,2490.8066 L6015.5,2480.8066 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="5840.5" y="2498.375">Communities containing</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="5840.5" y="2513.6855">any of the selected entities</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="277" x="5537.5" y="2484.0508"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="257" x="5547.5" y="2505.6523">Filter communities by entity_set membership</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="293" x="5529.5" y="2541.4277"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="273" x="5539.5" y="2563.0293">Get community reports for filtered communities</text><path d="M5763,2595.5605 L5763,2611.8711 L5743,2615.8711 L5763,2619.8711 L5763,2636.1816 A0,0 0 0 0 5763,2636.1816 L6181,2636.1816 A0,0 0 0 0 6181,2636.1816 L6181,2605.5605 L6171,2595.5605 L5763,2595.5605 A0,0 0 0 0 5763,2595.5605 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M6171,2595.5605 L6171,2605.5605 L6181,2605.5605 L6171,2595.5605 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="397" x="5769" y="2613.1289">community_budget = max_context_tokens × community_prop</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="5769" y="2628.4395">(default: 12000 × 0.5 = 6000 tokens)</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="134" x="5609" y="2598.8047"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="114" x="5619" y="2620.4063">Apply token budget</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="188" x="5582" y="2743.1816"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="168" x="5592" y="2764.7832">Select next community report</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="206" x="5573" y="2812.3145"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="186" x="5583" y="2833.916">Count tokens in report summary</text><polygon fill="#FEFECE" filter="url(#f1ercbwujgdkok)" points="5527.5,2881.4473,5824.5,2881.4473,5836.5,2893.4473,5824.5,2905.4473,5527.5,2905.4473,5515.5,2893.4473,5527.5,2881.4473" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="297" x="5527.5" y="2897.6045">current_tokens + report_tokens ≤ community_budget?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="5497.5" y="2891.127">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="5836.5" y="2891.127">no</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="145" x="5433" y="2915.4473"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="125" x="5443" y="2937.0488">Add report to context</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="151" x="5430" y="2984.5801"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="131" x="5440" y="3006.1816">Update current_tokens</text><path d="M5934,2919.8584 L5934,2928.5137 L5914,2932.5137 L5934,2936.5137 L5934,2945.1689 A0,0 0 0 0 5934,2945.1689 L6105,2945.1689 A0,0 0 0 0 6105,2945.1689 L6105,2929.8584 L6095,2919.8584 L5934,2919.8584 A0,0 0 0 0 5934,2919.8584 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M6095,2919.8584 L6095,2929.8584 L6105,2929.8584 L6095,2919.8584 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="5940" y="2937.4268">Token budget exceeded</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="135" x="5779" y="2915.4473"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="115" x="5789" y="2937.0488">Stop adding reports</text><polygon fill="#FEFECE" filter="url(#f1ercbwujgdkok)" points="5676,3024.7129,5688,3036.7129,5676,3048.7129,5664,3036.7129,5676,3024.7129" style="stroke:#A80036;stroke-width:1.5;"/><polygon fill="#FEFECE" filter="url(#f1ercbwujgdkok)" points="5676,2671.1816,5688,2683.1816,5676,2695.1816,5664,2683.1816,5676,2671.1816" style="stroke:#A80036;stroke-width:1.5;"/><polygon fill="#FEFECE" filter="url(#f1ercbwujgdkok)" points="5587,3096.7129,5765,3096.7129,5777,3108.7129,5765,3120.7129,5587,3120.7129,5575,3108.7129,5587,3096.7129" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="178" x="5587" y="3112.8701">More reports AND within budget?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="5777" y="3106.3926">yes</text><path d="M5764,3163.6548 L5764,3179.8765 L5744,3183.8765 L5764,3187.8765 L5764,3204.0981 A0,0 0 0 0 5764,3204.0981 L6042,3204.0981 A0,0 0 0 0 6042,3204.0981 L6042,3173.6548 L6032,3163.6548 L5764,3163.6548 A0,0 0 0 0 5764,3163.6548 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M6032,3163.6548 L6032,3173.6548 L6042,3173.6548 L6032,3163.6548 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="5770" y="3180.7217">id,community,summary</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="257" x="5770" y="3196.356">Ordered by community size (descending)</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="136" x="5608" y="3166.8101"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="116" x="5618" y="3188.4116">Format as CSV table</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="192" x="5580" y="3227.3423"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="46" x="5590" y="3248.9438">Store as</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="122" x="5640" y="3248.9438">community_context</text><line style="stroke:#000000;stroke-width:2.0;" x1="5401" x2="5401" y1="33.4961" y2="5103.1743"/><rect fill="#E6E6FA" height="5069.6782" style="stroke:#E6E6FA;stroke-width:1.0;" width="764" x="6203" y="33.4961"/><rect fill="#FFFFFF" filter="url(#f1ercbwujgdkok)" height="1463.4985" style="stroke:#000000;stroke-width:2.0;" width="748" x="6209" y="2418.3184"/><path d="M6436,2418.3184 L6436,2427.8066 L6426,2437.8066 L6209,2437.8066 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="217" x="6212" y="2432.8535">Multi-Source Context Assembly</text><path d="M6578.5,2477.5625 L6578.5,2493.873 L6558.5,2497.873 L6578.5,2501.873 L6578.5,2518.1836 A0,0 0 0 0 6578.5,2518.1836 L6748.5,2518.1836 A0,0 0 0 0 6748.5,2518.1836 L6748.5,2487.5625 L6738.5,2477.5625 L6578.5,2477.5625 A0,0 0 0 0 6578.5,2477.5625 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M6738.5,2477.5625 L6738.5,2487.5625 L6748.5,2487.5625 L6738.5,2477.5625 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="6584.5" y="2495.1309">Text units that mention</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="6584.5" y="2510.4414">any entity in entity_set</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="181" x="6377.5" y="2480.8066"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="161" x="6387.5" y="2502.4082">Filter text units by entity_set</text><path d="M6555,2538.1836 L6555,2554.4941 L6535,2558.4941 L6555,2562.4941 L6555,2578.8047 A0,0 0 0 0 6555,2578.8047 L6945,2578.8047 A0,0 0 0 0 6945,2578.8047 L6945,2548.1836 L6935,2538.1836 L6555,2538.1836 A0,0 0 0 0 6555,2538.1836 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M6935,2538.1836 L6935,2548.1836 L6945,2548.1836 L6935,2538.1836 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="369" x="6561" y="2555.752">text_unit_budget = max_context_tokens × text_unit_prop</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="6561" y="2571.0625">(default: 12000 × 0.5 = 6000 tokens)</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="134" x="6401" y="2541.4277"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="114" x="6411" y="2563.0293">Apply token budget</text><path d="M6547.5,2598.8047 L6547.5,2615.1152 L6527.5,2619.1152 L6547.5,2623.1152 L6547.5,2639.4258 A0,0 0 0 0 6547.5,2639.4258 L6702.5,2639.4258 A0,0 0 0 0 6702.5,2639.4258 L6702.5,2608.8047 L6692.5,2598.8047 L6547.5,2598.8047 A0,0 0 0 0 6547.5,2598.8047 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M6692.5,2598.8047 L6692.5,2608.8047 L6702.5,2608.8047 L6692.5,2598.8047 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="6553.5" y="2616.373">Primary: entity rank</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="6553.5" y="2631.6836">Secondary: text order</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="119" x="6408.5" y="2602.0488"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="99" x="6418.5" y="2623.6504">Sort by relevance</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="133" x="6401.5" y="2746.4258"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="113" x="6411.5" y="2768.0273">Select next text unit</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="160" x="6388" y="2815.5586"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="140" x="6398" y="2837.1602">Count tokens in text unit</text><polygon fill="#FEFECE" filter="url(#f1ercbwujgdkok)" points="6332,2884.6914,6604,2884.6914,6616,2896.6914,6604,2908.6914,6332,2908.6914,6320,2896.6914,6332,2884.6914" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="272" x="6332" y="2900.8486">current_tokens + unit_tokens ≤ text_unit_budget?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="6302" y="2894.3711">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="6616" y="2894.3711">no</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="156" x="6232" y="2918.6914"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="136" x="6242" y="2940.293">Add text unit to context</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="151" x="6234.5" y="2987.8242"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="131" x="6244.5" y="3009.4258">Update current_tokens</text><path d="M6719,2923.1025 L6719,2931.7578 L6699,2935.7578 L6719,2939.7578 L6719,2948.4131 A0,0 0 0 0 6719,2948.4131 L6890,2948.4131 A0,0 0 0 0 6890,2948.4131 L6890,2933.1025 L6880,2923.1025 L6719,2923.1025 A0,0 0 0 0 6719,2923.1025 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M6880,2923.1025 L6880,2933.1025 L6890,2933.1025 L6880,2923.1025 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="6725" y="2940.6709">Token budget exceeded</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="146" x="6553" y="2918.6914"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="126" x="6563" y="2940.293">Stop adding text units</text><polygon fill="#FEFECE" filter="url(#f1ercbwujgdkok)" points="6468,3027.957,6480,3039.957,6468,3051.957,6456,3039.957,6468,3027.957" style="stroke:#A80036;stroke-width:1.5;"/><polygon fill="#FEFECE" filter="url(#f1ercbwujgdkok)" points="6468,2674.4258,6480,2686.4258,6468,2698.4258,6456,2686.4258,6468,2674.4258" style="stroke:#A80036;stroke-width:1.5;"/><polygon fill="#FEFECE" filter="url(#f1ercbwujgdkok)" points="6373.5,3099.957,6562.5,3099.957,6574.5,3111.957,6562.5,3123.957,6373.5,3123.957,6361.5,3111.957,6373.5,3099.957" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="189" x="6373.5" y="3116.1143">More text units AND within budget?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="6574.5" y="3109.6367">yes</text><path d="M6556,3166.8989 L6556,3183.1206 L6536,3187.1206 L6556,3191.1206 L6556,3207.3423 A0,0 0 0 0 6556,3207.3423 L6727,3207.3423 A0,0 0 0 0 6727,3207.3423 L6727,3176.8989 L6717,3166.8989 L6556,3166.8989 A0,0 0 0 0 6556,3166.8989 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M6717,3166.8989 L6717,3176.8989 L6727,3176.8989 L6717,3166.8989 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="56" x="6562" y="3183.9658">id,text</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="6562" y="3199.6001">Maintains original order</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="136" x="6400" y="3170.0542"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="116" x="6410" y="3191.6558">Format as CSV table</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="177" x="6379.5" y="3230.5864"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="46" x="6389.5" y="3252.188">Store as</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="107" x="6439.5" y="3252.188">text_unit_context</text><line style="stroke:#000000;stroke-width:2.0;" x1="6203" x2="6203" y1="33.4961" y2="5103.1743"/><rect fill="#E6E6FA" height="5069.6782" style="stroke:#E6E6FA;stroke-width:1.0;" width="1425.5" x="6967" y="33.4961"/><rect fill="#FFFFFF" filter="url(#f1ercbwujgdkok)" height="1463.4985" style="stroke:#000000;stroke-width:2.0;" width="1409.5" x="6973" y="2418.3184"/><path d="M7200,2418.3184 L7200,2427.8066 L7190,2437.8066 L6973,2437.8066 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="217" x="6976" y="2432.8535">Multi-Source Context Assembly</text><polygon fill="#FEFECE" filter="url(#f1ercbwujgdkok)" points="7992,2705.2715,8103,2705.2715,8115,2717.2715,8103,2729.2715,7992,2729.2715,7980,2717.2715,7992,2705.2715" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="111" x="7992" y="2721.4287">Covariates available?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="7962" y="2714.9512">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="8115" y="2714.9512">no</text><path d="M7910.5,2739.2715 L7910.5,2755.582 L7890.5,2759.582 L7910.5,2763.582 L7910.5,2779.8926 A0,0 0 0 0 7910.5,2779.8926 L8060.5,2779.8926 A0,0 0 0 0 8060.5,2779.8926 L8060.5,2749.2715 L8050.5,2739.2715 L7910.5,2739.2715 A0,0 0 0 0 7910.5,2739.2715 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M8050.5,2739.2715 L8050.5,2749.2715 L8060.5,2749.2715 L8050.5,2739.2715 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="7916.5" y="2756.8398">Claims mentioning</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="7916.5" y="2772.1504">entities in entity_set</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="186" x="7704.5" y="2742.5156"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="166" x="7714.5" y="2764.1172">Filter covariates by entity_set</text><path d="M7884.5,2814.8926 L7884.5,2831.2031 L7864.5,2835.2031 L7884.5,2839.2031 L7884.5,2855.5137 A0,0 0 0 0 7884.5,2855.5137 L8051.5,2855.5137 A0,0 0 0 0 8051.5,2855.5137 L8051.5,2824.8926 L8041.5,2814.8926 L7884.5,2814.8926 A0,0 0 0 0 7884.5,2814.8926 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M8041.5,2814.8926 L8041.5,2824.8926 L8051.5,2824.8926 L8041.5,2814.8926 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="7890.5" y="2832.4609">Remaining tokens after</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="7890.5" y="2847.7715">other contexts</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="134" x="7730.5" y="2818.1367"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="114" x="7740.5" y="2839.7383">Apply token budget</text><path d="M7911.5,2895.0137 L7911.5,2903.5801 L7891.5,2907.5801 L7911.5,2911.5801 L7911.5,2920.1465 A0,0 0 0 0 7911.5,2920.1465 L8204.5,2920.1465 A0,0 0 0 0 8204.5,2920.1465 L8204.5,2905.0137 L8194.5,2895.0137 L7911.5,2895.0137 A0,0 0 0 0 7911.5,2895.0137 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M8194.5,2895.0137 L8194.5,2905.0137 L8204.5,2905.0137 L8194.5,2895.0137 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="272" x="7917.5" y="2912.0806">id,subject,object,type,description</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="188" x="7703.5" y="2890.5137"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="168" x="7713.5" y="2912.1152">Format as structured records</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="178" x="7708.5" y="2959.6465"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="46" x="7718.5" y="2981.248">Store as</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="108" x="7768.5" y="2981.248">covariate_context</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="146" x="8214.5" y="2739.2715"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="126" x="8224.5" y="2760.873">Skip covariate context</text><polygon fill="#FEFECE" filter="url(#f1ercbwujgdkok)" points="8047.5,2999.7793,8059.5,3011.7793,8047.5,3023.7793,8035.5,3011.7793,8047.5,2999.7793" style="stroke:#A80036;stroke-width:1.5;"/><rect fill="#000000" filter="url(#f1ercbwujgdkok)" height="6" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="1389.5" x="6983" y="3284.7192"/><path d="M7480,3300.7192 L7480,3416.5483 L7460,3420.5483 L7480,3424.5483 L7480,3540.3774 A0,0 0 0 0 7480,3540.3774 L7639,3540.3774 A0,0 0 0 0 7639,3540.3774 L7639,3310.7192 L7629,3300.7192 L7480,3300.7192 A0,0 0 0 0 7480,3300.7192 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M7629,3300.7192 L7629,3310.7192 L7639,3310.7192 L7629,3300.7192 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="48" x="7486" y="3318.2876">Format:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="line-through" textLength="8" x="7486" y="3333.5981">-</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47" x="7494" y="3333.5981">Entities</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="line-through" textLength="8" x="7541" y="3333.5981">-</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="7486" y="3348.9087">[entity_context]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="7490" y="3364.2192"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="line-through" textLength="8" x="7486" y="3379.5298">-</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="7494" y="3379.5298">Relationships</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="line-through" textLength="8" x="7579" y="3379.5298">-</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="7486" y="3394.8403">[relationship_context]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="7490" y="3410.1509"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="line-through" textLength="8" x="7486" y="3425.4614">-</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="48" x="7494" y="3425.4614">Reports</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="line-through" textLength="8" x="7542" y="3425.4614">-</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="7486" y="3440.772">[community_context]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="7490" y="3456.0825"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="line-through" textLength="8" x="7486" y="3471.3931">-</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49" x="7494" y="3471.3931">Sources</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="line-through" textLength="8" x="7543" y="3471.3931">-</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="7486" y="3486.7036">[text_unit_context]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="7490" y="3502.0142"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="line-through" textLength="8" x="7486" y="3517.3247">-</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="7494" y="3517.3247">Claims</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="line-through" textLength="8" x="7537" y="3517.3247">-</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="7486" y="3532.6353">[covariate_context]</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="284" x="7176" y="3403.4819"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="264" x="7186" y="3425.0835">Combine all contexts into single context string</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="189" x="7223.5" y="3560.3774"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="169" x="7233.5" y="3581.979">Calculate total context tokens</text><polygon fill="#FEFECE" filter="url(#f1ercbwujgdkok)" points="7219,3614.5103,7417,3614.5103,7429,3626.5103,7417,3638.5103,7219,3638.5103,7207,3626.5103,7219,3614.5103" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="198" x="7219" y="3630.6675">total_tokens &gt; max_context_tokens?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="7189" y="3624.1899">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="7429" y="3624.1899">no</text><path d="M7224,3648.5103 L7224,3664.8208 L7204,3668.8208 L7224,3672.8208 L7224,3689.1313 A0,0 0 0 0 7224,3689.1313 L7437,3689.1313 A0,0 0 0 0 7437,3689.1313 L7437,3658.5103 L7427,3648.5103 L7224,3648.5103 A0,0 0 0 0 7224,3648.5103 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M7427,3648.5103 L7427,3658.5103 L7437,3658.5103 L7427,3648.5103 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="7230" y="3666.0786">This should not happen if</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="7230" y="3681.3892">budgets are correctly enforced</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="198" x="7006" y="3651.7544"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="178" x="7016" y="3673.356">Warning: Context exceeds limit</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="175" x="7017.5" y="3709.1313"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="155" x="7027.5" y="3730.7329">Truncate context to fit limit</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="148" x="7457" y="3648.5103"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="128" x="7467" y="3670.1118">Context within limits ✓</text><polygon fill="#FEFECE" filter="url(#f1ercbwujgdkok)" points="7318,3749.2642,7330,3761.2642,7318,3773.2642,7306,3761.2642,7318,3749.2642" style="stroke:#A80036;stroke-width:1.5;"/><path d="M7428.5,3783.2642 L7428.5,3822.5405 L7408.5,3826.5405 L7428.5,3830.5405 L7428.5,3869.8169 A0,0 0 0 0 7428.5,3869.8169 L7693.5,3869.8169 A0,0 0 0 0 7693.5,3869.8169 L7693.5,3793.2642 L7683.5,3783.2642 L7428.5,3783.2642 A0,0 0 0 0 7428.5,3783.2642 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M7683.5,3783.2642 L7683.5,3793.2642 L7693.5,3793.2642 L7683.5,3783.2642 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60" x="7434.5" y="3800.8325">Contains:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="224" x="7434.5" y="3816.1431">- context_chunks: formatted string</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222" x="7434.5" y="3831.4536">- context_records: raw DataFrames</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="7434.5" y="3846.7642">- llm_calls: 0 (no LLM used)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244" x="7434.5" y="3862.0747">- prompt_tokens: context token count</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="181" x="7227.5" y="3809.4741"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="161" x="7237.5" y="3831.0757">Create ContextBuilderResult</text><line style="stroke:#000000;stroke-width:2.0;" x1="6967" x2="6967" y1="33.4961" y2="5103.1743"/><rect fill="#FAFAD2" height="5069.6782" style="stroke:#FAFAD2;stroke-width:1.0;" width="651" x="8392.5" y="33.4961"/><rect fill="#FFFFFF" filter="url(#f1ercbwujgdkok)" height="606.502" style="stroke:#000000;stroke-width:2.0;" width="635" x="8398.5" y="3891.8169"/><path d="M8514.5,3891.8169 L8514.5,3901.3052 L8504.5,3911.3052 L8398.5,3911.3052 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106" x="8401.5" y="3906.3521">LLM Generation</text><path d="M8778.5,3921.3052 L8778.5,3968.2368 L8758.5,3972.2368 L8778.5,3976.2368 L8778.5,4023.1685 A0,0 0 0 0 8778.5,4023.1685 L9023.5,4023.1685 A0,0 0 0 0 9023.5,4023.1685 L9023.5,3931.3052 L9013.5,3921.3052 L8778.5,3921.3052 A0,0 0 0 0 8778.5,3921.3052 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M9013.5,3921.3052 L9013.5,3931.3052 L9023.5,3931.3052 L9013.5,3921.3052 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="8784.5" y="3938.8735">System Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="224" x="8784.5" y="3954.1841">- LOCAL_SEARCH_SYSTEM_PROMPT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="8784.5" y="3969.4946">- Formatted context</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="8788.5" y="3984.8052"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="8784.5" y="4000.1157">User Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="8784.5" y="4015.4263">- User query</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="176" x="8582.5" y="3955.1704"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="156" x="8592.5" y="3976.772">Build completion messages</text><polygon fill="#FEFECE" filter="url(#f1ercbwujgdkok)" points="8618.5,4043.1685,8722.5,4043.1685,8734.5,4055.1685,8722.5,4067.1685,8618.5,4067.1685,8606.5,4055.1685,8618.5,4043.1685" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="8618.5" y="4059.3257">Streaming enabled?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="8588.5" y="4052.8481">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="8734.5" y="4052.8481">no</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="175" x="8410.5" y="4077.1685"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="155" x="8420.5" y="4098.77">Call LLM with stream=True</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="138" x="8429" y="4185.4341"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="118" x="8439" y="4207.0356">Receive token chunk</text><path d="M8578,4236.3228 L8578,4252.6333 L8558,4256.6333 L8578,4260.6333 L8578,4276.9438 A0,0 0 0 0 8578,4276.9438 L8710,4276.9438 A0,0 0 0 0 8710,4276.9438 L8710,4246.3228 L8700,4236.3228 L8578,4236.3228 A0,0 0 0 0 8578,4236.3228 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M8700,4236.3228 L8700,4246.3228 L8710,4246.3228 L8700,4236.3228 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="8584" y="4253.8911">Real-time display</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68" x="8584" y="4269.2017">in terminal</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="120" x="8438" y="4239.5669"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="100" x="8448" y="4261.1685">Yield token to CLI</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="161" x="8417.5" y="4296.9438"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="141" x="8427.5" y="4318.5454">Append to full_response</text><polygon fill="#FEFECE" filter="url(#f1ercbwujgdkok)" points="8498,4131.3013,8510,4143.3013,8498,4155.3013,8486,4143.3013,8498,4131.3013" style="stroke:#A80036;stroke-width:1.5;"/><polygon fill="#FEFECE" filter="url(#f1ercbwujgdkok)" points="8462.5,4351.0767,8533.5,4351.0767,8545.5,4363.0767,8533.5,4375.0767,8462.5,4375.0767,8450.5,4363.0767,8462.5,4351.0767" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="71" x="8462.5" y="4367.2339">More tokens?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="8545.5" y="4360.7563">yes</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="156" x="8765" y="4077.1685"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="136" x="8775" y="4098.77">Call LLM non-streaming</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="178" x="8754" y="4131.3013"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="158" x="8764" y="4152.9028">Receive complete response</text><polygon fill="#FEFECE" filter="url(#f1ercbwujgdkok)" points="8670.5,4381.0767,8682.5,4393.0767,8670.5,4405.0767,8658.5,4393.0767,8670.5,4381.0767" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="8644.5" y="4390.7563">no</text><path d="M8771,4415.0767 L8771,4446.6978 L8751,4450.6978 L8771,4454.6978 L8771,4486.3188 A0,0 0 0 0 8771,4486.3188 L8970,4486.3188 A0,0 0 0 0 8970,4486.3188 L8970,4425.0767 L8960,4415.0767 L8771,4415.0767 A0,0 0 0 0 8771,4415.0767 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M8960,4415.0767 L8960,4425.0767 L8970,4425.0767 L8960,4415.0767 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="8777" y="4432.645">- prompt_tokens (input)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="8777" y="4447.9556">- output_tokens (generated)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="8777" y="4463.2661">- completion_time</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="8777" y="4478.5767">- llm_calls: 1</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="161" x="8590" y="4433.6313"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="141" x="8600" y="4455.2329">Track LLM call metadata</text><line style="stroke:#000000;stroke-width:2.0;" x1="8392.5" x2="8392.5" y1="33.4961" y2="5103.1743"/><rect fill="#98FB98" height="5069.6782" style="stroke:#98FB98;stroke-width:1.0;" width="555.5" x="9043.5" y="33.4961"/><rect fill="#FFFFFF" filter="url(#f1ercbwujgdkok)" height="274.0371" style="stroke:#000000;stroke-width:2.0;" width="539.5" x="9049.5" y="4508.3188"/><path d="M9196.5,4508.3188 L9196.5,4517.8071 L9186.5,4527.8071 L9049.5,4527.8071 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="137" x="9052.5" y="4522.854">Create SearchResult</text><path d="M9278,4537.8071 L9278,4623.0151 L9258,4627.0151 L9278,4631.0151 L9278,4716.2231 A0,0 0 0 0 9278,4716.2231 L9579,4716.2231 A0,0 0 0 0 9579,4716.2231 L9579,4547.8071 L9569,4537.8071 L9278,4537.8071 A0,0 0 0 0 9278,4537.8071 " fill="#FBFB77" filter="url(#f1ercbwujgdkok)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M9569,4537.8071 L9569,4547.8071 L9579,4547.8071 L9569,4537.8071 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="9284" y="4555.3755">SearchResult contains:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199" x="9284" y="4570.686">- response: LLM answer (string)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="238" x="9284" y="4585.9966">- context_data: raw DataFrames (dict)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="263" x="9284" y="4601.3071">- context_text: formatted context (string)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="9284" y="4616.6177">- completion_time: duration (float)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="9284" y="4631.9282">- llm_calls: 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="280" x="9284" y="4647.2388">- prompt_tokens: context + system + query</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200" x="9284" y="4662.5493">- output_tokens: answer length</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="9284" y="4677.8599">- llm_calls_categories: {"search": 1}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="265" x="9284" y="4693.1704">- prompt_tokens_categories: {"search": N}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="262" x="9284" y="4708.481">- output_tokens_categories: {"search": M}</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="193" x="9065" y="4609.9487"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="173" x="9075" y="4631.5503">Assemble SearchResult object</text><rect fill="#FEFECE" filter="url(#f1ercbwujgdkok)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="204" x="9059.5" y="4736.2231"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="184" x="9069.5" y="4757.8247">Return SearchResult to API layer</text><line style="stroke:#000000;stroke-width:2.0;" x1="9043.5" x2="9043.5" y1="33.4961" y2="5103.1743"/><line style="stroke:#000000;stroke-width:2.0;" x1="9599" x2="9599" y1="33.4961" y2="5103.1743"/><line style="stroke:#A80036;stroke-width:1.5;" x1="256.5" x2="256.5" y1="79.6953" y2="99.6953"/><polygon fill="#A80036" points="252.5,89.6953,256.5,99.6953,260.5,89.6953,256.5,93.6953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="256.5" x2="256.5" y1="147.7969" y2="191.6621"/><polygon fill="#A80036" points="252.5,181.6621,256.5,191.6621,260.5,181.6621,256.5,185.6621" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="256.5" x2="256.5" y1="225.7949" y2="279.6602"/><polygon fill="#A80036" points="252.5,269.6602,256.5,279.6602,260.5,269.6602,256.5,273.6602" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="208.5" x2="78.5" y1="4868.4888" y2="4868.4888"/><line style="stroke:#A80036;stroke-width:1.5;" x1="78.5" x2="78.5" y1="4868.4888" y2="4916.6987"/><polygon fill="#A80036" points="74.5,4906.6987,78.5,4916.6987,82.5,4906.6987,78.5,4910.6987" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="304.5" x2="434.5" y1="4868.4888" y2="4868.4888"/><line style="stroke:#A80036;stroke-width:1.5;" x1="434.5" x2="434.5" y1="4868.4888" y2="4890.4888"/><polygon fill="#A80036" points="430.5,4880.4888,434.5,4890.4888,438.5,4880.4888,434.5,4884.4888" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="78.5" x2="78.5" y1="4950.8315" y2="4995.0415"/><line style="stroke:#A80036;stroke-width:1.5;" x1="78.5" x2="244.5" y1="4995.0415" y2="4995.0415"/><polygon fill="#A80036" points="234.5,4991.0415,244.5,4995.0415,234.5,4999.0415,238.5,4995.0415" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="434.5" x2="434.5" y1="4924.6216" y2="4995.0415"/><line style="stroke:#A80036;stroke-width:1.5;" x1="434.5" x2="268.5" y1="4995.0415" y2="4995.0415"/><polygon fill="#A80036" points="278.5,4991.0415,268.5,4995.0415,278.5,4999.0415,274.5,4995.0415" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="256.5" x2="256.5" y1="4836.4888" y2="4856.4888"/><polygon fill="#A80036" points="252.5,4846.4888,256.5,4856.4888,260.5,4846.4888,256.5,4850.4888" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="256.5" x2="256.5" y1="5007.0415" y2="5027.0415"/><polygon fill="#A80036" points="252.5,5017.0415,256.5,5027.0415,260.5,5017.0415,256.5,5021.0415" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="256.5" x2="256.5" y1="5061.1743" y2="5081.1743"/><polygon fill="#A80036" points="252.5,5071.1743,256.5,5081.1743,260.5,5071.1743,256.5,5075.1743" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="582.5" x2="582.5" y1="408.0586" y2="435.125"/><polygon fill="#A80036" points="578.5,425.125,582.5,435.125,586.5,425.125,582.5,429.125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="751.5" x2="751.5" y1="408.0586" y2="435.125"/><polygon fill="#A80036" points="747.5,425.125,751.5,435.125,755.5,425.125,751.5,429.125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="954" x2="954" y1="408.0586" y2="435.125"/><polygon fill="#A80036" points="950,425.125,954,435.125,958,425.125,954,429.125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1175" x2="1175" y1="408.0586" y2="435.125"/><polygon fill="#A80036" points="1171,425.125,1175,435.125,1179,425.125,1175,429.125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1387.5" x2="1387.5" y1="408.0586" y2="435.125"/><polygon fill="#A80036" points="1383.5,425.125,1387.5,435.125,1391.5,425.125,1387.5,429.125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1556" x2="1556" y1="408.0586" y2="428.0586"/><polygon fill="#A80036" points="1552,418.0586,1556,428.0586,1560,418.0586,1556,422.0586" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="582.5" x2="582.5" y1="469.2578" y2="496.3242"/><polygon fill="#A80036" points="578.5,486.3242,582.5,496.3242,586.5,486.3242,582.5,490.3242" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="751.5" x2="751.5" y1="469.2578" y2="496.3242"/><polygon fill="#A80036" points="747.5,486.3242,751.5,496.3242,755.5,486.3242,751.5,490.3242" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="954" x2="954" y1="469.2578" y2="496.3242"/><polygon fill="#A80036" points="950,486.3242,954,496.3242,958,486.3242,954,490.3242" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1175" x2="1175" y1="469.2578" y2="496.3242"/><polygon fill="#A80036" points="1171,486.3242,1175,496.3242,1179,486.3242,1175,490.3242" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1387.5" x2="1387.5" y1="469.2578" y2="496.3242"/><polygon fill="#A80036" points="1383.5,486.3242,1387.5,496.3242,1391.5,486.3242,1387.5,490.3242" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1556" x2="1556" y1="476.3242" y2="496.3242"/><polygon fill="#A80036" points="1552,486.3242,1556,496.3242,1560,486.3242,1556,490.3242" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1073.5" x2="1073.5" y1="382.0586" y2="402.0586"/><polygon fill="#A80036" points="1069.5,392.0586,1073.5,402.0586,1077.5,392.0586,1073.5,396.0586" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1073.5" x2="1073.5" y1="502.3242" y2="522.3242"/><polygon fill="#A80036" points="1069.5,512.3242,1073.5,522.3242,1077.5,512.3242,1073.5,516.3242" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="957" x2="957" y1="582.457" y2="602.457"/><polygon fill="#A80036" points="953,592.457,957,602.457,961,592.457,957,596.457" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1202" x2="1202" y1="582.457" y2="602.457"/><polygon fill="#A80036" points="1198,592.457,1202,602.457,1206,592.457,1202,596.457" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="957" x2="957" y1="636.5898" y2="656.5898"/><polygon fill="#A80036" points="953,646.5898,957,656.5898,961,646.5898,957,650.5898" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1202" x2="1202" y1="636.5898" y2="656.5898"/><polygon fill="#A80036" points="1198,646.5898,1202,656.5898,1206,646.5898,1202,650.5898" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1073.5" x2="1073.5" y1="556.457" y2="576.457"/><polygon fill="#A80036" points="1069.5,566.457,1073.5,576.457,1077.5,566.457,1073.5,570.457" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1800.5" x2="1800.5" y1="811.4766" y2="831.4766"/><polygon fill="#A80036" points="1796.5,821.4766,1800.5,831.4766,1804.5,821.4766,1800.5,825.4766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1800.5" x2="1800.5" y1="879.7422" y2="899.7422"/><polygon fill="#A80036" points="1796.5,889.7422,1800.5,899.7422,1804.5,889.7422,1800.5,893.7422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1800.5" x2="1800.5" y1="948.0078" y2="1014.8389"/><polygon fill="#A80036" points="1796.5,1004.8389,1800.5,1014.8389,1804.5,1004.8389,1800.5,1008.8389" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1800.5" x2="1800.5" y1="1048.9717" y2="1126.7021"/><polygon fill="#A80036" points="1796.5,1116.7021,1800.5,1126.7021,1804.5,1116.7021,1800.5,1120.7021" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1800.5" x2="1800.5" y1="716.7227" y2="763.2109"/><polygon fill="#A80036" points="1796.5,753.2109,1800.5,763.2109,1804.5,753.2109,1800.5,757.2109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2580.25" x2="2438" y1="1269.8672" y2="1269.8672"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2438" x2="2438" y1="1269.8672" y2="1295.1113"/><polygon fill="#A80036" points="2434,1285.1113,2438,1295.1113,2442,1285.1113,2438,1289.1113" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2757.25" x2="2889.5" y1="1269.8672" y2="1269.8672"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2889.5" x2="2889.5" y1="1269.8672" y2="1291.8672"/><polygon fill="#A80036" points="2885.5,1281.8672,2889.5,1291.8672,2893.5,1281.8672,2889.5,1285.8672" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2438" x2="2438" y1="1329.2441" y2="1350.4883"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2438" x2="2656.75" y1="1350.4883" y2="1350.4883"/><polygon fill="#A80036" points="2646.75,1346.4883,2656.75,1350.4883,2646.75,1354.4883,2650.75,1350.4883" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2889.5" x2="2889.5" y1="1326" y2="1350.4883"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2889.5" x2="2680.75" y1="1350.4883" y2="1350.4883"/><polygon fill="#A80036" points="2690.75,1346.4883,2680.75,1350.4883,2690.75,1354.4883,2686.75,1350.4883" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2668.75" x2="2668.75" y1="1237.8672" y2="1257.8672"/><polygon fill="#A80036" points="2664.75,1247.8672,2668.75,1257.8672,2672.75,1247.8672,2668.75,1251.8672" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3175" x2="3175" y1="1443.1094" y2="1471.6641"/><polygon fill="#A80036" points="3171,1461.6641,3175,1471.6641,3179,1461.6641,3175,1465.6641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3175" x2="3175" y1="1505.7969" y2="1544.3516"/><polygon fill="#A80036" points="3171,1534.3516,3175,1544.3516,3179,1534.3516,3175,1538.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3175" x2="3175" y1="1578.4844" y2="1598.4844"/><polygon fill="#A80036" points="3171,1588.4844,3175,1598.4844,3179,1588.4844,3175,1592.4844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3175" x2="3175" y1="1632.6172" y2="1652.6172"/><polygon fill="#A80036" points="3171,1642.6172,3175,1652.6172,3179,1642.6172,3175,1646.6172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3175" x2="3175" y1="1686.75" y2="1706.75"/><polygon fill="#A80036" points="3171,1696.75,3175,1706.75,3179,1696.75,3175,1700.75" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3175" x2="3175" y1="1740.8828" y2="1764.127"/><polygon fill="#A80036" points="3171,1754.127,3175,1764.127,3179,1754.127,3175,1758.127" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3876" x2="3876" y1="1989.0137" y2="2009.0137"/><polygon fill="#A80036" points="3872,1999.0137,3876,2009.0137,3880,1999.0137,3876,2003.0137" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3876" x2="3876" y1="2043.1465" y2="2066.3906"/><polygon fill="#A80036" points="3872,2056.3906,3876,2066.3906,3880,2056.3906,3876,2060.3906" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3876" x2="3876" y1="2100.5234" y2="2128.0234"/><polygon fill="#A80036" points="3872,2118.0234,3876,2128.0234,3880,2118.0234,3876,2122.0234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3876" x2="3876" y1="2162.1563" y2="2185.4004"/><polygon fill="#A80036" points="3872,2175.4004,3876,2185.4004,3880,2175.4004,3876,2179.4004" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3876" x2="3876" y1="2219.5332" y2="2242.7773"/><polygon fill="#A80036" points="3872,2232.7773,3876,2242.7773,3880,2232.7773,3876,2236.7773" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3876" x2="3876" y1="1934.8809" y2="1954.8809"/><polygon fill="#A80036" points="3872,1944.8809,3876,1954.8809,3880,1944.8809,3876,1948.8809" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3939" x2="4384" y1="2308.9102" y2="2308.9102"/><polygon fill="#A80036" points="4380,2120.5234,4384,2110.5234,4388,2120.5234,4384,2116.5234" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4384" x2="4384" y1="1922.8809" y2="2308.9102"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4384" x2="3888" y1="1922.8809" y2="1922.8809"/><polygon fill="#A80036" points="3898,1918.8809,3888,1922.8809,3898,1926.8809,3894,1922.8809" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3876" x2="3876" y1="2276.9102" y2="2296.9102"/><polygon fill="#A80036" points="3872,2286.9102,3876,2296.9102,3880,2286.9102,3876,2290.9102" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3876" x2="3876" y1="1890.8809" y2="1910.8809"/><polygon fill="#A80036" points="3872,1900.8809,3876,1910.8809,3880,1900.8809,3876,1904.8809" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3876" x2="3876" y1="2320.9102" y2="2362.1855"/><polygon fill="#A80036" points="3872,2352.1855,3876,2362.1855,3880,2352.1855,3876,2356.1855" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="3880" y="2342.3652">no</text><line style="stroke:#A80036;stroke-width:1.5;" x1="4595" x2="4595" y1="2721.6162" y2="2775.1709"/><polygon fill="#A80036" points="4591,2765.1709,4595,2775.1709,4599,2765.1709,4595,2769.1709" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4595" x2="4595" y1="2809.3037" y2="2866.0137"/><polygon fill="#A80036" points="4591,2856.0137,4595,2866.0137,4599,2856.0137,4595,2860.0137" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4595" x2="4595" y1="2900.1465" y2="2938.3018"/><polygon fill="#A80036" points="4591,2928.3018,4595,2938.3018,4599,2928.3018,4595,2932.3018" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4595" x2="4595" y1="2972.4346" y2="3007.4346"/><polygon fill="#A80036" points="4591,2997.4346,4595,3007.4346,4599,2997.4346,4595,3001.4346" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5046" x2="5046" y1="2676.1504" y2="2717.6387"/><polygon fill="#A80036" points="5042,2707.6387,5046,2717.6387,5050,2707.6387,5046,2711.6387" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5046" x2="5046" y1="2751.7715" y2="2816.2256"/><polygon fill="#A80036" points="5042,2806.2256,5046,2816.2256,5050,2806.2256,5046,2810.2256" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5046" x2="5046" y1="2850.3584" y2="2914.7236"/><polygon fill="#A80036" points="5042,2904.7236,5046,2914.7236,5050,2904.7236,5046,2908.7236" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5046" x2="5046" y1="2948.8564" y2="2987.0117"/><polygon fill="#A80036" points="5042,2977.0117,5046,2987.0117,5050,2977.0117,5046,2981.0117" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5046" x2="5046" y1="3021.1445" y2="3056.1445"/><polygon fill="#A80036" points="5042,3046.1445,5046,3056.1445,5050,3046.1445,5046,3050.1445" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5676" x2="5676" y1="2518.1836" y2="2541.4277"/><polygon fill="#A80036" points="5672,2531.4277,5676,2541.4277,5680,2531.4277,5676,2535.4277" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5676" x2="5676" y1="2575.5605" y2="2598.8047"/><polygon fill="#A80036" points="5672,2588.8047,5676,2598.8047,5680,2588.8047,5676,2592.8047" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5676" x2="5676" y1="2777.3145" y2="2812.3145"/><polygon fill="#A80036" points="5672,2802.3145,5676,2812.3145,5680,2802.3145,5676,2806.3145" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5505.5" x2="5505.5" y1="2949.5801" y2="2984.5801"/><polygon fill="#A80036" points="5501.5,2974.5801,5505.5,2984.5801,5509.5,2974.5801,5505.5,2978.5801" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5515.5" x2="5505.5" y1="2893.4473" y2="2893.4473"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5505.5" x2="5505.5" y1="2893.4473" y2="2915.4473"/><polygon fill="#A80036" points="5501.5,2905.4473,5505.5,2915.4473,5509.5,2905.4473,5505.5,2909.4473" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5836.5" x2="5846.5" y1="2893.4473" y2="2893.4473"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5846.5" x2="5846.5" y1="2893.4473" y2="2915.4473"/><polygon fill="#A80036" points="5842.5,2905.4473,5846.5,2915.4473,5850.5,2905.4473,5846.5,2909.4473" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5505.5" x2="5505.5" y1="3018.7129" y2="3036.7129"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5505.5" x2="5664" y1="3036.7129" y2="3036.7129"/><polygon fill="#A80036" points="5654,3032.7129,5664,3036.7129,5654,3040.7129,5658,3036.7129" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5846.5" x2="5846.5" y1="2949.5801" y2="3036.7129"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5846.5" x2="5688" y1="3036.7129" y2="3036.7129"/><polygon fill="#A80036" points="5698,3032.7129,5688,3036.7129,5698,3040.7129,5694,3036.7129" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5676" x2="5676" y1="2846.4473" y2="2881.4473"/><polygon fill="#A80036" points="5672,2871.4473,5676,2881.4473,5680,2871.4473,5676,2875.4473" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5676" x2="5676" y1="2695.1816" y2="2743.1816"/><polygon fill="#A80036" points="5672,2733.1816,5676,2743.1816,5680,2733.1816,5676,2737.1816" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5777" x2="6127" y1="3108.7129" y2="3108.7129"/><polygon fill="#A80036" points="6123,2905.9473,6127,2895.9473,6131,2905.9473,6127,2901.9473" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6127" x2="6127" y1="2683.1816" y2="3108.7129"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6127" x2="5688" y1="2683.1816" y2="2683.1816"/><polygon fill="#A80036" points="5698,2679.1816,5688,2683.1816,5698,2687.1816,5694,2683.1816" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5676" x2="5676" y1="3048.7129" y2="3096.7129"/><polygon fill="#A80036" points="5672,3086.7129,5676,3096.7129,5680,3086.7129,5676,3090.7129" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5676" x2="5676" y1="2632.9375" y2="2671.1816"/><polygon fill="#A80036" points="5672,2661.1816,5676,2671.1816,5680,2661.1816,5676,2665.1816" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5676" x2="5676" y1="3120.7129" y2="3166.8101"/><polygon fill="#A80036" points="5672,3156.8101,5676,3166.8101,5680,3156.8101,5676,3160.8101" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="5680" y="3145.4121">no</text><line style="stroke:#A80036;stroke-width:1.5;" x1="5676" x2="5676" y1="3200.9429" y2="3227.3423"/><polygon fill="#A80036" points="5672,3217.3423,5676,3227.3423,5680,3217.3423,5676,3221.3423" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6468" x2="6468" y1="2514.9395" y2="2541.4277"/><polygon fill="#A80036" points="6464,2531.4277,6468,2541.4277,6472,2531.4277,6468,2535.4277" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6468" x2="6468" y1="2575.5605" y2="2602.0488"/><polygon fill="#A80036" points="6464,2592.0488,6468,2602.0488,6472,2592.0488,6468,2596.0488" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6468" x2="6468" y1="2780.5586" y2="2815.5586"/><polygon fill="#A80036" points="6464,2805.5586,6468,2815.5586,6472,2805.5586,6468,2809.5586" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6310" x2="6310" y1="2952.8242" y2="2987.8242"/><polygon fill="#A80036" points="6306,2977.8242,6310,2987.8242,6314,2977.8242,6310,2981.8242" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6320" x2="6310" y1="2896.6914" y2="2896.6914"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6310" x2="6310" y1="2896.6914" y2="2918.6914"/><polygon fill="#A80036" points="6306,2908.6914,6310,2918.6914,6314,2908.6914,6310,2912.6914" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6616" x2="6626" y1="2896.6914" y2="2896.6914"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6626" x2="6626" y1="2896.6914" y2="2918.6914"/><polygon fill="#A80036" points="6622,2908.6914,6626,2918.6914,6630,2908.6914,6626,2912.6914" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6310" x2="6310" y1="3021.957" y2="3039.957"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6310" x2="6456" y1="3039.957" y2="3039.957"/><polygon fill="#A80036" points="6446,3035.957,6456,3039.957,6446,3043.957,6450,3039.957" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6626" x2="6626" y1="2952.8242" y2="3039.957"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6626" x2="6480" y1="3039.957" y2="3039.957"/><polygon fill="#A80036" points="6490,3035.957,6480,3039.957,6490,3043.957,6486,3039.957" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6468" x2="6468" y1="2849.6914" y2="2884.6914"/><polygon fill="#A80036" points="6464,2874.6914,6468,2884.6914,6472,2874.6914,6468,2878.6914" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6468" x2="6468" y1="2698.4258" y2="2746.4258"/><polygon fill="#A80036" points="6464,2736.4258,6468,2746.4258,6472,2736.4258,6468,2740.4258" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6574.5" x2="6912" y1="3111.957" y2="3111.957"/><polygon fill="#A80036" points="6908,2909.1914,6912,2899.1914,6916,2909.1914,6912,2905.1914" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6912" x2="6912" y1="2686.4258" y2="3111.957"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6912" x2="6480" y1="2686.4258" y2="2686.4258"/><polygon fill="#A80036" points="6490,2682.4258,6480,2686.4258,6490,2690.4258,6486,2686.4258" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6468" x2="6468" y1="3051.957" y2="3099.957"/><polygon fill="#A80036" points="6464,3089.957,6468,3099.957,6472,3089.957,6468,3093.957" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6468" x2="6468" y1="2636.1816" y2="2674.4258"/><polygon fill="#A80036" points="6464,2664.4258,6468,2674.4258,6472,2664.4258,6468,2668.4258" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6468" x2="6468" y1="3123.957" y2="3170.0542"/><polygon fill="#A80036" points="6464,3160.0542,6468,3170.0542,6472,3160.0542,6468,3164.0542" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="6472" y="3148.6563">no</text><line style="stroke:#A80036;stroke-width:1.5;" x1="6468" x2="6468" y1="3204.187" y2="3230.5864"/><polygon fill="#A80036" points="6464,3220.5864,6468,3230.5864,6472,3220.5864,6468,3224.5864" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7797.5" x2="7797.5" y1="2776.6484" y2="2818.1367"/><polygon fill="#A80036" points="7793.5,2808.1367,7797.5,2818.1367,7801.5,2808.1367,7797.5,2812.1367" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7797.5" x2="7797.5" y1="2852.2695" y2="2890.5137"/><polygon fill="#A80036" points="7793.5,2880.5137,7797.5,2890.5137,7801.5,2880.5137,7797.5,2884.5137" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7797.5" x2="7797.5" y1="2924.6465" y2="2959.6465"/><polygon fill="#A80036" points="7793.5,2949.6465,7797.5,2959.6465,7801.5,2949.6465,7797.5,2953.6465" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7980" x2="7797.5" y1="2717.2715" y2="2717.2715"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7797.5" x2="7797.5" y1="2717.2715" y2="2742.5156"/><polygon fill="#A80036" points="7793.5,2732.5156,7797.5,2742.5156,7801.5,2732.5156,7797.5,2736.5156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8115" x2="8287.5" y1="2717.2715" y2="2717.2715"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8287.5" x2="8287.5" y1="2717.2715" y2="2739.2715"/><polygon fill="#A80036" points="8283.5,2729.2715,8287.5,2739.2715,8291.5,2729.2715,8287.5,2733.2715" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7797.5" x2="7797.5" y1="2993.7793" y2="3011.7793"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7797.5" x2="8035.5" y1="3011.7793" y2="3011.7793"/><polygon fill="#A80036" points="8025.5,3007.7793,8035.5,3011.7793,8025.5,3015.7793,8029.5,3011.7793" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8287.5" x2="8287.5" y1="2773.4043" y2="3011.7793"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8287.5" x2="8059.5" y1="3011.7793" y2="3011.7793"/><polygon fill="#A80036" points="8069.5,3007.7793,8059.5,3011.7793,8069.5,3015.7793,8065.5,3011.7793" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8047.5" x2="8047.5" y1="3023.7793" y2="3284.7192"/><polygon fill="#A80036" points="8043.5,3274.7192,8047.5,3284.7192,8051.5,3274.7192,8047.5,3278.7192" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7318" x2="7318" y1="3290.7192" y2="3403.4819"/><polygon fill="#A80036" points="7314,3393.4819,7318,3403.4819,7322,3393.4819,7318,3397.4819" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7318" x2="7318" y1="3437.6147" y2="3560.3774"/><polygon fill="#A80036" points="7314,3550.3774,7318,3560.3774,7322,3550.3774,7318,3554.3774" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7105" x2="7105" y1="3685.8872" y2="3709.1313"/><polygon fill="#A80036" points="7101,3699.1313,7105,3709.1313,7109,3699.1313,7105,3703.1313" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7207" x2="7105" y1="3626.5103" y2="3626.5103"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7105" x2="7105" y1="3626.5103" y2="3651.7544"/><polygon fill="#A80036" points="7101,3641.7544,7105,3651.7544,7109,3641.7544,7105,3645.7544" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7429" x2="7531" y1="3626.5103" y2="3626.5103"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7531" x2="7531" y1="3626.5103" y2="3648.5103"/><polygon fill="#A80036" points="7527,3638.5103,7531,3648.5103,7535,3638.5103,7531,3642.5103" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7105" x2="7105" y1="3743.2642" y2="3761.2642"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7105" x2="7306" y1="3761.2642" y2="3761.2642"/><polygon fill="#A80036" points="7296,3757.2642,7306,3761.2642,7296,3765.2642,7300,3761.2642" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7531" x2="7531" y1="3682.6431" y2="3761.2642"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7531" x2="7330" y1="3761.2642" y2="3761.2642"/><polygon fill="#A80036" points="7340,3757.2642,7330,3761.2642,7340,3765.2642,7336,3761.2642" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7318" x2="7318" y1="3594.5103" y2="3614.5103"/><polygon fill="#A80036" points="7314,3604.5103,7318,3614.5103,7322,3604.5103,7318,3608.5103" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7318" x2="7318" y1="3773.2642" y2="3809.4741"/><polygon fill="#A80036" points="7314,3799.4741,7318,3809.4741,7322,3799.4741,7318,3803.4741" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8498" x2="8498" y1="4219.5669" y2="4239.5669"/><polygon fill="#A80036" points="8494,4229.5669,8498,4239.5669,8502,4229.5669,8498,4233.5669" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8498" x2="8498" y1="4273.6997" y2="4296.9438"/><polygon fill="#A80036" points="8494,4286.9438,8498,4296.9438,8502,4286.9438,8498,4290.9438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8498" x2="8498" y1="4155.3013" y2="4185.4341"/><polygon fill="#A80036" points="8494,4175.4341,8498,4185.4341,8502,4175.4341,8498,4179.4341" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8545.5" x2="8722" y1="4363.0767" y2="4363.0767"/><polygon fill="#A80036" points="8718,4266.6333,8722,4256.6333,8726,4266.6333,8722,4262.6333" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8722" x2="8722" y1="4143.3013" y2="4363.0767"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8722" x2="8510" y1="4143.3013" y2="4143.3013"/><polygon fill="#A80036" points="8520,4139.3013,8510,4143.3013,8520,4147.3013,8516,4143.3013" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8498" x2="8498" y1="4331.0767" y2="4351.0767"/><polygon fill="#A80036" points="8494,4341.0767,8498,4351.0767,8502,4341.0767,8498,4345.0767" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8498" x2="8498" y1="4111.3013" y2="4131.3013"/><polygon fill="#A80036" points="8494,4121.3013,8498,4131.3013,8502,4121.3013,8498,4125.3013" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8843" x2="8843" y1="4111.3013" y2="4131.3013"/><polygon fill="#A80036" points="8839,4121.3013,8843,4131.3013,8847,4121.3013,8843,4125.3013" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8606.5" x2="8498" y1="4055.1685" y2="4055.1685"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8498" x2="8498" y1="4055.1685" y2="4077.1685"/><polygon fill="#A80036" points="8494,4067.1685,8498,4077.1685,8502,4067.1685,8498,4071.1685" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8734.5" x2="8843" y1="4055.1685" y2="4055.1685"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8843" x2="8843" y1="4055.1685" y2="4077.1685"/><polygon fill="#A80036" points="8839,4067.1685,8843,4077.1685,8847,4067.1685,8843,4071.1685" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8498" x2="8498" y1="4375.0767" y2="4393.0767"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8498" x2="8658.5" y1="4393.0767" y2="4393.0767"/><polygon fill="#A80036" points="8648.5,4389.0767,8658.5,4393.0767,8648.5,4397.0767,8652.5,4393.0767" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8843" x2="8843" y1="4165.4341" y2="4393.0767"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8843" x2="8682.5" y1="4393.0767" y2="4393.0767"/><polygon fill="#A80036" points="8692.5,4389.0767,8682.5,4393.0767,8692.5,4397.0767,8688.5,4393.0767" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8670.5" x2="8670.5" y1="3989.3032" y2="4043.1685"/><polygon fill="#A80036" points="8666.5,4033.1685,8670.5,4043.1685,8674.5,4033.1685,8670.5,4037.1685" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8670.5" x2="8670.5" y1="4405.0767" y2="4433.6313"/><polygon fill="#A80036" points="8666.5,4423.6313,8670.5,4433.6313,8674.5,4423.6313,8670.5,4427.6313" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="9161.5" x2="9161.5" y1="4644.0815" y2="4736.2231"/><polygon fill="#A80036" points="9157.5,4726.2231,9161.5,4736.2231,9165.5,4726.2231,9161.5,4730.2231" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="256.5" x2="256.5" y1="327.9258" y2="332.9258"/><line style="stroke:#A80036;stroke-width:1.5;" x1="256.5" x2="1073.5" y1="332.9258" y2="332.9258"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1073.5" x2="1073.5" y1="332.9258" y2="347.9258"/><polygon fill="#A80036" points="1069.5,337.9258,1073.5,347.9258,1077.5,337.9258,1073.5,341.9258" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1073.5" x2="1073.5" y1="662.5898" y2="667.5898"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1073.5" x2="1800.5" y1="667.5898" y2="667.5898"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1800.5" x2="1800.5" y1="667.5898" y2="682.5898"/><polygon fill="#A80036" points="1796.5,672.5898,1800.5,682.5898,1804.5,672.5898,1800.5,676.5898" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1800.5" x2="1800.5" y1="1160.835" y2="1185.7847"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1800.5" x2="2668.75" y1="1185.7847" y2="1185.7847"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2668.75" x2="2668.75" y1="1185.7847" y2="1203.7344"/><polygon fill="#A80036" points="2664.75,1193.7344,2668.75,1203.7344,2672.75,1193.7344,2668.75,1197.7344" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2668.75" x2="2668.75" y1="1362.4883" y2="1373.2324"/><line style="stroke:#A80036;stroke-width:1.5;" x1="2668.75" x2="3175" y1="1373.2324" y2="1373.2324"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3175" x2="3175" y1="1373.2324" y2="1408.9766"/><polygon fill="#A80036" points="3171,1398.9766,3175,1408.9766,3179,1398.9766,3175,1402.9766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3175" x2="3175" y1="1798.2598" y2="1815.2598"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3175" x2="3876" y1="1815.2598" y2="1815.2598"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3876" x2="3876" y1="1815.2598" y2="1856.748"/><polygon fill="#A80036" points="3872,1846.748,3876,1856.748,3880,1846.748,3876,1850.748" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4433" x2="4433" y1="2460.8066" y2="2464.8066"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4433" x2="4595" y1="2464.8066" y2="2464.8066"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4595" x2="4595" y1="2464.8066" y2="2687.4834"/><polygon fill="#A80036" points="4591,2677.4834,4595,2687.4834,4599,2677.4834,4595,2681.4834" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4444" x2="4444" y1="2460.8066" y2="2464.8066"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4444" x2="5046" y1="2464.8066" y2="2464.8066"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5046" x2="5046" y1="2464.8066" y2="2642.0176"/><polygon fill="#A80036" points="5042,2632.0176,5046,2642.0176,5050,2632.0176,5046,2636.0176" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4444" x2="4444" y1="2460.8066" y2="2464.8066"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4444" x2="5676" y1="2464.8066" y2="2464.8066"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5676" x2="5676" y1="2464.8066" y2="2484.0508"/><polygon fill="#A80036" points="5672,2474.0508,5676,2484.0508,5680,2474.0508,5676,2478.0508" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4462" x2="4462" y1="2460.8066" y2="2464.8066"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4462" x2="6468" y1="2464.8066" y2="2464.8066"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6468" x2="6468" y1="2464.8066" y2="2480.8066"/><polygon fill="#A80036" points="6464,2470.8066,6468,2480.8066,6472,2470.8066,6468,2474.8066" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4462" x2="4462" y1="2460.8066" y2="2464.8066"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4462" x2="8047.5" y1="2464.8066" y2="2464.8066"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8047.5" x2="8047.5" y1="2464.8066" y2="2705.2715"/><polygon fill="#A80036" points="8043.5,2695.2715,8047.5,2705.2715,8051.5,2695.2715,8047.5,2699.2715" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4595" x2="4595" y1="3041.5674" y2="3270.7192"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4595" x2="6990" y1="3270.7192" y2="3270.7192"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6990" x2="6990" y1="3270.7192" y2="3284.7192"/><polygon fill="#A80036" points="6986,3274.7192,6990,3284.7192,6994,3274.7192,6990,3278.7192" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5046" x2="5046" y1="3090.2773" y2="3270.7192"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5046" x2="7001" y1="3270.7192" y2="3270.7192"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7001" x2="7001" y1="3270.7192" y2="3284.7192"/><polygon fill="#A80036" points="6997,3274.7192,7001,3284.7192,7005,3274.7192,7001,3278.7192" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5676" x2="5676" y1="3261.4751" y2="3270.7192"/><line style="stroke:#A80036;stroke-width:1.5;" x1="5676" x2="7001" y1="3270.7192" y2="3270.7192"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7001" x2="7001" y1="3270.7192" y2="3284.7192"/><polygon fill="#A80036" points="6997,3274.7192,7001,3284.7192,7005,3274.7192,7001,3278.7192" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6468" x2="6468" y1="3264.7192" y2="3270.7192"/><line style="stroke:#A80036;stroke-width:1.5;" x1="6468" x2="7678" y1="3270.7192" y2="3270.7192"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7678" x2="7678" y1="3270.7192" y2="3284.7192"/><polygon fill="#A80036" points="7674,3274.7192,7678,3284.7192,7682,3274.7192,7678,3278.7192" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3876" x2="3876" y1="2396.3184" y2="2413.3184"/><line style="stroke:#A80036;stroke-width:1.5;" x1="3876" x2="4453" y1="2413.3184" y2="2413.3184"/><line style="stroke:#A80036;stroke-width:1.5;" x1="4453" x2="4453" y1="2413.3184" y2="2454.8066"/><polygon fill="#A80036" points="4449,2444.8066,4453,2454.8066,4457,2444.8066,4453,2448.8066" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7318" x2="7318" y1="3843.6069" y2="3886.8169"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7318" x2="8670.5" y1="3886.8169" y2="3886.8169"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8670.5" x2="8670.5" y1="3886.8169" y2="3955.1704"/><polygon fill="#A80036" points="8666.5,3945.1704,8670.5,3955.1704,8674.5,3945.1704,8670.5,3949.1704" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8670.5" x2="8670.5" y1="4467.7642" y2="4525.8564"/><line style="stroke:#A80036;stroke-width:1.5;" x1="8670.5" x2="9161.5" y1="4525.8564" y2="4525.8564"/><line style="stroke:#A80036;stroke-width:1.5;" x1="9161.5" x2="9161.5" y1="4525.8564" y2="4609.9487"/><polygon fill="#A80036" points="9157.5,4599.9487,9161.5,4609.9487,9165.5,4599.9487,9161.5,4603.9487" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="9161.5" x2="9161.5" y1="4770.356" y2="4787.356"/><line style="stroke:#A80036;stroke-width:1.5;" x1="9161.5" x2="256.5" y1="4787.356" y2="4787.356"/><line style="stroke:#A80036;stroke-width:1.5;" x1="256.5" x2="256.5" y1="4787.356" y2="4802.356"/><polygon fill="#A80036" points="252.5,4792.356,256.5,4802.356,260.5,4792.356,256.5,4796.356" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="79" x="214.5" y="50.8984">CLI Layer</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="115" x="1018" y="50.8984">Data Loading</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="107" x="1935.75" y="50.8984">Initialization</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="142" x="2580.5" y="50.8984">Query Execution</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="209" x="3240.75" y="50.8984">Phase 1: Entity Mapping</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="215" x="3951.5" y="50.8984">Phase 2: Graph Traversal</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="223" x="4338" y="50.8984">Phase 3: Context Building</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="124" x="4638" y="50.8984">Entity Context</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="181" x="5065.5" y="50.8984">Relationship Context</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="175" x="5714.5" y="50.8984">Community Context</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="155" x="6507.5" y="50.8984">Text Unit Context</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="232" x="7563.75" y="50.8984">Covariate Context (Claims)</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="243" x="8596.5" y="50.8984">Phase 4: Answer Generation</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="141" x="9250.75" y="50.8984">Result Assembly</text><!--MD5=[9616964e76daf30cf4a3f86c7ed92f7a]
@startuml Local Search Activity Diagram
title GraphRAG Local Search - Detailed Activity Flow

|#AntiqueWhite|CLI Layer|
start
:User executes query\n""graphrag query 'How is X related to Y?' - -method local"";

:Parse CLI arguments;
note right
  - query string
  - root directory
  - data directory
  - community_level
  - response_type
  - streaming flag
end note

:Load configuration\n(settings.yaml);

|#LightBlue|Data Loading|
:Read Parquet files from output/;
fork
  :Load entities.parquet;
fork again
  :Load relationships.parquet;
fork again
  :Load communities.parquet;
fork again
  :Load community_reports.parquet;
fork again
  :Load text_units.parquet;
fork again
  :Load covariates.parquet\n(optional);
end fork

:Load embedding vector stores;
fork
  :Load entity_description embeddings;
fork again
  :Load text_unit_text embeddings;
end fork

|#LightGreen|Initialization|
:Create LocalSearch engine via factory;

partition "Factory Setup" {
  :Create completion model\n(LiteLLM);
  :Create embedding model\n(for query embedding);
  :Load local search prompt\n(system prompt);
  :Create LocalSearchMixedContext builder;
  note right
    Configured with:
    - entities DataFrame
    - relationships DataFrame
    - communities DataFrame
    - community_reports DataFrame
    - text_units DataFrame
    - covariates DataFrame
    - token encoder
    - embedding vectorstore
  end note
  :Set token budgets;
  note right
    text_unit_budget = max_context_tokens × text_unit_prop
    community_budget = max_context_tokens × community_prop
    (default: 12000 tokens total, 0.5/0.5 split)
  end note
}

|#LightYellow|Query Execution|
:Start LocalSearch.search(query);

if (Conversation history exists?) then (yes)
  :Add conversation history to context;
  note right
    conversation_history_max_turns
    (default: 5)
  end note
else (no)
  :Skip conversation context;
endif

|#LightCoral|Phase 1: Entity Mapping|
partition "Entity Extraction & Mapping" {
  :Embed query using text embedding model;
  note right
    query_embedding = embedding_model.encode(query)
  end note

  :Vector similarity search on entity_description embeddings;
  note right
    Search parameters:
    - k = top_k_entities × oversample_scaler
    - default: 10 × 2 = 20 entities
    - embedding_vectorstore_key: ID or TITLE
  end note

  :Retrieve similar entity descriptions;

  :Filter excluded entities;

  :Sort by similarity score (rank);

  :Select top-k entities;
  note right
    top_k_mapped_entities
    (default: 10)
  end note

  :Store selected entities as **seed_entities**;
}

|#LightSteelBlue|Phase 2: Graph Traversal|
partition "Neighborhood Expansion" {
  :Initialize entity_set with seed_entities;

  repeat
    :For each seed entity;

    :Find relationships where entity is source or target;
    note right
      Query relationships DataFrame:
      - df[(df.source == entity) | (df.target == entity)]
    end note

    :Extract connected entities (neighbors);

    :Rank neighbors by entity.rank attribute;
    note right
      Entity rank = importance score
      from indexing phase
    end note

    :Select top-k neighbors per entity;
    note right
      top_k_relationships
      (default: 10)
    end note

    :Add neighbors to entity_set;

  repeat while (More seed entities?) is (yes)
  -> no;

  :Final entity_set = seed_entities + neighbors;
}

|#Lavender|Phase 3: Context Building|
partition "Multi-Source Context Assembly" {
  fork
    |#Lavender|Entity Context|
    :Filter entities by entity_set;

    :Select entity fields;
    note right
      - id
      - entity (name)
      - description
      - rank
    end note

    :Format as CSV table;
    note right
      ""id,entity,description""
      Ordered by rank (descending)
    end note

    :Count entity context tokens;

    :Store as **entity_context**;

  fork again
    |#Lavender|Relationship Context|
    :Get in-network relationships;
    note right
      Relationships between entities
      in entity_set
    end note

    :Apply relationship count limit;
    note right
      top_k_relationships
      (default: 10)
    end note

    :Select relationship fields;
    note right
      - id
      - source
      - target
      - description
      - rank
    end note

    :Format as CSV table;
    note right
      ""id,source,target,description""
      Ordered by rank (descending)
    end note

    :Count relationship context tokens;

    :Store as **relationship_context**;

  fork again
    |#Lavender|Community Context|
    :Filter communities by entity_set membership;
    note right
      Communities containing
      any of the selected entities
    end note

    :Get community reports for filtered communities;

    :Apply token budget;
    note right
      community_budget = max_context_tokens × community_prop
      (default: 12000 × 0.5 = 6000 tokens)
    end note

    repeat
      :Select next community report;

      :Count tokens in report summary;

      if (current_tokens + report_tokens ≤ community_budget?) then (yes)
        :Add report to context;
        :Update current_tokens;
      else (no)
        :Stop adding reports;
        note right: Token budget exceeded
      endif

    repeat while (More reports AND within budget?) is (yes)
    -> no;

    :Format as CSV table;
    note right
      ""id,community,summary""
      Ordered by community size (descending)
    end note

    :Store as **community_context**;

  fork again
    |#Lavender|Text Unit Context|
    :Filter text units by entity_set;
    note right
      Text units that mention
      any entity in entity_set
    end note

    :Apply token budget;
    note right
      text_unit_budget = max_context_tokens × text_unit_prop
      (default: 12000 × 0.5 = 6000 tokens)
    end note

    :Sort by relevance;
    note right
      Primary: entity rank
      Secondary: text order
    end note

    repeat
      :Select next text unit;

      :Count tokens in text unit;

      if (current_tokens + unit_tokens ≤ text_unit_budget?) then (yes)
        :Add text unit to context;
        :Update current_tokens;
      else (no)
        :Stop adding text units;
        note right: Token budget exceeded
      endif

    repeat while (More text units AND within budget?) is (yes)
    -> no;

    :Format as CSV table;
    note right
      ""id,text""
      Maintains original order
    end note

    :Store as **text_unit_context**;

  fork again
    |#Lavender|Covariate Context (Claims)|
    if (Covariates available?) then (yes)
      :Filter covariates by entity_set;
      note right
        Claims mentioning
        entities in entity_set
      end note

      :Apply token budget;
      note right
        Remaining tokens after
        other contexts
      end note

      :Format as structured records;
      note right
        ""id,subject,object,type,description""
      end note

      :Store as **covariate_context**;
    else (no)
      :Skip covariate context;
    endif
  end fork

  :Combine all contexts into single context string;
  note right
    Format:
    - - - - -Entities- - - - -
    [entity_context]

    - - - - -Relationships- - - - -
    [relationship_context]

    - - - - -Reports- - - - -
    [community_context]

    - - - - -Sources- - - - -
    [text_unit_context]

    - - - - -Claims- - - - -
    [covariate_context]
  end note

  :Calculate total context tokens;

  if (total_tokens > max_context_tokens?) then (yes)
    :Warning: Context exceeds limit;
    note right
      This should not happen if
      budgets are correctly enforced
    end note
    :Truncate context to fit limit;
  else (no)
    :Context within limits ✓;
  endif

  :Create ContextBuilderResult;
  note right
    Contains:
    - context_chunks: formatted string
    - context_records: raw DataFrames
    - llm_calls: 0 (no LLM used)
    - prompt_tokens: context token count
  end note
}

|#LightGoldenRodYellow|Phase 4: Answer Generation|
partition "LLM Generation" {
  :Build completion messages;
  note right
    System Message:
    - LOCAL_SEARCH_SYSTEM_PROMPT
    - Formatted context

    User Message:
    - User query
  end note

  if (Streaming enabled?) then (yes)
    :Call LLM with stream=True;

    repeat
      :Receive token chunk;

      :Yield token to CLI;
      note right
        Real-time display
        in terminal
      end note

      :Append to full_response;

    repeat while (More tokens?) is (yes)
    -> no;

  else (no)
    :Call LLM non-streaming;

    :Receive complete response;
  endif

  :Track LLM call metadata;
  note right
    - prompt_tokens (input)
    - output_tokens (generated)
    - completion_time
    - llm_calls: 1
  end note
}

|#PaleGreen|Result Assembly|
partition "Create SearchResult" {
  :Assemble SearchResult object;
  note right
    SearchResult contains:
    - response: LLM answer (string)
    - context_data: raw DataFrames (dict)
    - context_text: formatted context (string)
    - completion_time: duration (float)
    - llm_calls: 1
    - prompt_tokens: context + system + query
    - output_tokens: answer length
    - llm_calls_categories: {"search": 1}
    - prompt_tokens_categories: {"search": N}
    - output_tokens_categories: {"search": M}
  end note

  :Return SearchResult to API layer;
}

|#AntiqueWhite|CLI Layer|
:Display answer to user;

if (Verbose flag?) then (yes)
  :Display statistics;
  note right
    - LLM calls: 1
    - Prompt tokens: X
    - Output tokens: Y
    - Total tokens: X + Y
    - Completion time: Z seconds
  end note
else (no)
  :Skip statistics;
endif

:Exit with success;
stop







@enduml

PlantUML version 1.2021.00(Sun Jan 10 18:25:05 SGT 2021)
(MIT source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: SG
--></g></svg>